LX51 LINKER/LOCATER V4.66.66.0                                                          10/31/2016  00:36:39  PAGE 1





ASSEMBLER CODE PACKING OF MODULE:  ..\build\obj\silabs_c2adapter (THREAD_PKT)


----- FUNCTION _thread_pkt_Dump (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  100: static void _thread_pkt_Dump(IN BOOL bRx)
  101: {
  102:   #if PKT_DEBUG_SUPPORT
  103: 
  104:     UINT16 vLoop;
  105: 
  106:   #if DRV_WATCHDOG_SUPPORT
  107:     DRV_WATCHDOG_Kick();
  108:   #endif
  109: 
  110:     printf("USB-%s-PKT: (magic=%.4hX,rev=%.4hX,len=%04hX,CRC=%04hX)",
  111:            (bRx?"RX":"TX"),
  112:            vFrame.vMagicNo, vFrame.vVersion, vFrame.vLen, vFrame.vCRC);
  113:     for (vLoop = 0; vLoop < vFrame.vLen; vLoop++)
  114:     {
  115:         if ((vLoop%16) == 0)
  116:         {
  117:             printf("\n");
  118:         }
  119:         else if ((vLoop%8) == 0)
  120:         {
  121:             printf(" -");
  122:         }
  123: 
  124:         printf(" %02bX", vFrame.vContent.buf[vLoop]);
  125:     }
  126:     printf("\n");
  127: 
  128:   #if DRV_WATCHDOG_SUPPORT
  129:     DRV_WATCHDOG_Kick();
  130:   #endif
  131: 
  132:   #else
  133:     NO_WARNING(bRx);
  134:   #endif
  135: }
00002A 22                RET      
----- FUNCTION _thread_pkt_Dump (END) -------


00002B 022E5D            LJMP     02E5DH
000083 022E94            LJMP     02E94H
----- FUNCTION CFG_Init (BEGIN) -----
 FILE: '..\cfg\cfg.c'
   48: void CFG_Init(void)
   49: {
   50:     CFG_DB_Init();
   51:     CFG_PWD_Init();
0001DD 0225FA            LJMP     CFG_PWD_Init
----- FUNCTION CFG_Init (END) -------


----- FUNCTION _thread_pkt_CalcCRC (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
   50: static UINT16 _thread_pkt_CalcCRC(void)
   51: {
   52:     /* CRC16-CCITT: X16+X15+X2+1 */
   53:     static SEG_CODE UINT16 aCRC16[256] =
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 2


   54:     {
   55:         0x0000, 0x1189, 0x2312, 0x329B, 0x4624, 0x57AD, 0x6536, 0x74BF,
   56:         0x8C48, 0x9DC1, 0xAF5A, 0xBED3, 0xCA6C, 0xDBE5, 0xE97E, 0xF8F7,
   57:         0x0919, 0x1890, 0x2A0B, 0x3B82, 0x4F3D, 0x5EB4, 0x6C2F, 0x7DA6,
   58:         0x8551, 0x94D8, 0xA643, 0xB7CA, 0xC375, 0xD2FC, 0xE067, 0xF1EE,
   59:         0x1232, 0x03BB, 0x3120, 0x20A9, 0x5416, 0x459F, 0x7704, 0x668D,
   60:         0x9E7A, 0x8FF3, 0xBD68, 0xACE1, 0xD85E, 0xC9D7, 0xFB4C, 0xEAC5,
   61:         0x1B2B, 0x0AA2, 0x3839, 0x29B0, 0x5D0F, 0x4C86, 0x7E1D, 0x6F94,
   62:         0x9763, 0x86EA, 0xB471, 0xA5F8, 0xD147, 0xC0CE, 0xF255, 0xE3DC,
   63:         0x2464, 0x35ED, 0x0776, 0x16FF, 0x6240, 0x73C9, 0x4152, 0x50DB,
   64:         0xA82C, 0xB9A5, 0x8B3E, 0x9AB7, 0xEE08, 0xFF81, 0xCD1A, 0xDC93,
   65:         0x2D7D, 0x3CF4, 0x0E6F, 0x1FE6, 0x6B59, 0x7AD0, 0x484B, 0x59C2,
   66:         0xA135, 0xB0BC, 0x8227, 0x93AE, 0xE711, 0xF698, 0xC403, 0xD58A,
   67:         0x3656, 0x27DF, 0x1544, 0x04CD, 0x7072, 0x61FB, 0x5360, 0x42E9,
   68:         0xBA1E, 0xAB97, 0x990C, 0x8885, 0xFC3A, 0xEDB3, 0xDF28, 0xCEA1,
   69:         0x3F4F, 0x2EC6, 0x1C5D, 0x0DD4, 0x796B, 0x68E2, 0x5A79, 0x4BF0,
   70:         0xB307, 0xA28E, 0x9015, 0x819C, 0xF523, 0xE4AA, 0xD631, 0xC7B8,
   71:         0x48C8, 0x5941, 0x6BDA, 0x7A53, 0x0EEC, 0x1F65, 0x2DFE, 0x3C77,
   72:         0xC480, 0xD509, 0xE792, 0xF61B, 0x82A4, 0x932D, 0xA1B6, 0xB03F,
   73:         0x41D1, 0x5058, 0x62C3, 0x734A, 0x07F5, 0x167C, 0x24E7, 0x356E,
   74:         0xCD99, 0xDC10, 0xEE8B, 0xFF02, 0x8BBD, 0x9A34, 0xA8AF, 0xB926,
   75:         0x5AFA, 0x4B73, 0x79E8, 0x6861, 0x1CDE, 0x0D57, 0x3FCC, 0x2E45,
   76:         0xD6B2, 0xC73B, 0xF5A0, 0xE429, 0x9096, 0x811F, 0xB384, 0xA20D,
   77:         0x53E3, 0x426A, 0x70F1, 0x6178, 0x15C7, 0x044E, 0x36D5, 0x275C,
   78:         0xDFAB, 0xCE22, 0xFCB9, 0xED30, 0x998F, 0x8806, 0xBA9D, 0xAB14,
   79:         0x6CAC, 0x7D25, 0x4FBE, 0x5E37, 0x2A88, 0x3B01, 0x099A, 0x1813,
   80:         0xE0E4, 0xF16D, 0xC3F6, 0xD27F, 0xA6C0, 0xB749, 0x85D2, 0x945B,
   81:         0x65B5, 0x743C, 0x46A7, 0x572E, 0x2391, 0x3218, 0x0083, 0x110A,
   82:         0xE9FD, 0xF874, 0xCAEF, 0xDB66, 0xAFD9, 0xBE50, 0x8CCB, 0x9D42,
   83:         0x7E9E, 0x6F17, 0x5D8C, 0x4C05, 0x38BA, 0x2933, 0x1BA8, 0x0A21,
   84:         0xF2D6, 0xE35F, 0xD1C4, 0xC04D, 0xB4F2, 0xA57B, 0x97E0, 0x8669,
   85:         0x7787, 0x660E, 0x5495, 0x451C, 0x31A3, 0x202A, 0x12B1, 0x0338,
   86:         0xFBCF, 0xEA46, 0xD8DD, 0xC954, 0xBDEB, 0xAC62, 0x9EF9, 0x8F70,
   87:     };
   88: 
   89:     UINT16  vCRC = 0xFFFF;
00163C 74FF              MOV      A,#0FFH
00163E F531              MOV      vCRC,A
001640 F532              MOV      vCRC+01H,A
   90:     UINT16  vLoop;
   91: 
   92:     for (vLoop = 0; vLoop < vFrame.vLen; vLoop++)
;---- Variable 'vLoop' assigned to Register 'R4/R5' ----
001642 E4                CLR      A
001643 FD                MOV      R5,A
001644 FC                MOV      R4,A
001645         ?C0001?THREAD_PKT:
001645 D3                SETB     C
001646 900045            MOV      DPTR,#vFrame+05H
001649 E0                MOVX     A,@DPTR
00164A 9D                SUBB     A,R5
00164B 900044            MOV      DPTR,#vFrame+04H
00164E E0                MOVX     A,@DPTR
00164F 9C                SUBB     A,R4
001650 4031              JC       ?C0002?THREAD_PKT
   93:     {
   94:         vCRC = (vCRC<<8) ^ aCRC16[(UINT8)(vCRC>>8)^(vFrame.vContent.buf[vLoop])];
001652 E531              MOV      A,vCRC
001654 FF                MOV      R7,A
001655 7448              MOV      A,#LOW vFrame+08H
001657 2D                ADD      A,R5
001658 F582              MOV      DPL,A
00165A 7400              MOV      A,#HIGH vFrame+08H
00165C 3C                ADDC     A,R4
00165D F583              MOV      DPH,A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 3


00165F E0                MOVX     A,@DPTR
001660 6F                XRL      A,R7
001661 75F002            MOV      B,#02H
001664 A4                MUL      AB
001665 241C              ADD      A,#LOW aCRC16
001667 F582              MOV      DPL,A
001669 E5F0              MOV      A,B
00166B 3414              ADDC     A,#HIGH aCRC16
00166D F583              MOV      DPH,A
00166F E532              MOV      A,vCRC+01H
001671 FE                MOV      R6,A
001672 E4                CLR      A
001673 93                MOVC     A,@A+DPTR
001674 6E                XRL      A,R6
001675 F531              MOV      vCRC,A
001677 7401              MOV      A,#01H
001679 93                MOVC     A,@A+DPTR
00167A F532              MOV      vCRC+01H,A
   95:     }
00167C 0D                INC      R5
00167D BD0001            CJNE     R5,#00H,?C0066?THREAD_PKT
001680 0C                INC      R4
001681         ?C0066?THREAD_PKT:
001681 80C2              SJMP     ?C0001?THREAD_PKT
001683         ?C0002?THREAD_PKT:
   96: 
   97:     return vCRC;
001683 AE31              MOV      R6,vCRC
001685 AF32              MOV      R7,vCRC+01H
   98: }
001687 22                RET      
----- FUNCTION _thread_pkt_CalcCRC (END) -------


----- FUNCTION _thread_pkt_Transmit (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  248: static void _thread_pkt_Transmit(void)
  249: {
  250:     if (bFlushFIFO)
  251:     {
001688 304709            JNB      bFlushFIFO,?C0042?THREAD_PKT
  252:         /* flush FIFO */
  253:         memset(&vFrame, 0x00, sizeof(vFrame));
00168B 12344B            LCALL    ?L?COM0034
00168E 1207F3            LCALL    ?C?MEMSET
  254:         bFlushFIFO = FALSE;
001691 C247              CLR      bFlushFIFO
  255:     }
001693 22                RET      
001694         ?C0042?THREAD_PKT:
  256:     else
  257:     {
  258:         /* update content length, and re-calculate CRC value */
  259:         vFrame.vLen = 4+PKT_GetPayloadSize();
001694 90004B            MOV      DPTR,#vFrame+0BH
001697 E0                MOVX     A,@DPTR
001698 2404              ADD      A,#04H
00169A FE                MOV      R6,A
00169B 90004A            MOV      DPTR,#vFrame+0AH
00169E E0                MOVX     A,@DPTR
00169F 3400              ADDC     A,#00H
0016A1 900044            MOV      DPTR,#vFrame+04H
0016A4 F0                MOVX     @DPTR,A
0016A5 A3                INC      DPTR
0016A6 CE                XCH      A,R6
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 4


0016A7 F0                MOVX     @DPTR,A
  260:         vFrame.vCRC = _thread_pkt_CalcCRC();
0016A8 D13C              ACALL    _thread_pkt_CalcCRC
0016AA 900046            MOV      DPTR,#vFrame+06H
0016AD EE                MOV      A,R6
0016AE F0                MOVX     @DPTR,A
0016AF A3                INC      DPTR
0016B0 EF                MOV      A,R7
0016B1 F0                MOVX     @DPTR,A
  261: 
  262:         /* dump tx frame */
  263:         _thread_pkt_Dump(FALSE);
0016B2 C238              CLR      ?_thread_pkt_Dump?BIT
0016B4 12002A            LCALL    _thread_pkt_Dump
  264: 
  265:         /* emit frame */
  266:     	DRV_USB_WriteBlock((UINT8 *)&vFrame, PKT_HEADER_LEN+vFrame.vLen);
0016B7 123451            LCALL    ?L?COM0035
0016BA 900045            MOV      DPTR,#vFrame+05H
0016BD E0                MOVX     A,@DPTR
0016BE 2408              ADD      A,#08H
0016C0 FD                MOV      R5,A
0016C1 900044            MOV      DPTR,#vFrame+04H
0016C4 E0                MOVX     A,@DPTR
0016C5 3400              ADDC     A,#00H
0016C7 FC                MOV      R4,A
0016C8 020086            LJMP     _Block_Write
  267:     }
----- FUNCTION _thread_pkt_Transmit (END) -------


----- FUNCTION _thread_pkt_Receive (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  137: static BOOL _thread_pkt_Receive(void)
  138: {
  139:     UINT16  vRxTotalLen;
  140:     UINT8   vBlockLen;
  141:     UINT16  vElaspedTime;
  142: 
  143:   #if 1
  144:     /* receive frame:
  145:      *  -> 1st block: pkt_header + pkt_content
  146:      *  -> 2nd block: pkt_content
  147:      *  -> 3rd block: pkt_content
  148:      *  -> ...
  149:      */
  150: 
  151:     /* receive 1st block */
  152:     memset(&vFrame, 0x00, sizeof(vFrame));
0016CB 12344B            LCALL    ?L?COM0034
0016CE 1207F3            LCALL    ?C?MEMSET
  153:     vBlockLen = DRV_USB_ReadBlock((UINT8 *)&vFrame, DRV_USB_BLOCK_MAX_LEN);
0016D1 123451            LCALL    ?L?COM0035
0016D4 123597            LCALL    ?L?COM0064
  154:     if (bFlushFIFO)
0016D7 30470B            JNB      bFlushFIFO,?C0010?THREAD_PKT
  155:     {
  156:         /* flush FIFO */
  157:         printf("flush FIFO!\n");
0016DA 7BFF              MOV      R3,#0FFH
0016DC 7A13              MOV      R2,#HIGH 01001349H
0016DE 7949              MOV      R1,#LOW 01001349H
0016E0 120262            LCALL    _printf
  158:         return FALSE;
0016E3 C3                CLR      C
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 5


0016E4 22                RET      
  159:     }
0016E5         ?C0010?THREAD_PKT:
  160:     if ((vBlockLen < PKT_HEADER_LEN) || (vFrame.vMagicNo != vMagicNo))
0016E5 C3                CLR      C
0016E6 E52E              MOV      A,vBlockLen
0016E8 9408              SUBB     A,#08H
0016EA E4                CLR      A
0016EB 9400              SUBB     A,#00H
0016ED 400E              JC       ?C0013?THREAD_PKT
0016EF 900040            MOV      DPTR,#vFrame
0016F2 E0                MOVX     A,@DPTR
0016F3 6508              XRL      A,vMagicNo
0016F5 7004              JNZ      ?C0067?THREAD_PKT
0016F7 A3                INC      DPTR
0016F8 E0                MOVX     A,@DPTR
0016F9 6509              XRL      A,vMagicNo+01H
0016FB         ?C0067?THREAD_PKT:
0016FB 601A              JZ       ?C0012?THREAD_PKT
0016FD         ?C0013?THREAD_PKT:
  161:     {
  162:         /* invalid frame, force flush FIFO, w/o responding */
  163:         printf("invalid frame! (blockLen=%.2bX, magicNo=%.4hX)\n", vBlockLen, vFrame.vMagicNo);
0016FD 7BFF              MOV      R3,#0FFH
0016FF 7A13              MOV      R2,#HIGH 01001356H
001701 7956              MOV      R1,#LOW 01001356H
001703 852E34            MOV      ?_printf?BYTE+03H,vBlockLen
001706 900040            MOV      DPTR,#vFrame
001709 E0                MOVX     A,@DPTR
00170A F535              MOV      ?_printf?BYTE+04H,A
00170C A3                INC      DPTR
00170D E0                MOVX     A,@DPTR
00170E F536              MOV      ?_printf?BYTE+05H,A
001710 120262            LCALL    _printf
  164:         bFlushFIFO = TRUE;
001713 D247              SETB     bFlushFIFO
  165:         return FALSE;
001715 C3                CLR      C
001716 22                RET      
  166:     }
001717         ?C0012?THREAD_PKT:
  167:     if (vFrame.vVersion != PKT_VERSION)
001717 900042            MOV      DPTR,#vFrame+02H
00171A E0                MOVX     A,@DPTR
00171B 7004              JNZ      ?C0068?THREAD_PKT
00171D A3                INC      DPTR
00171E E0                MOVX     A,@DPTR
00171F 6401              XRL      A,#01H
001721         ?C0068?THREAD_PKT:
001721 6013              JZ       ?C0014?THREAD_PKT
  168:     {
  169:         /* invalid frame version, return supported version to host */
  170:         printf("invalid frame version!\n");
001723 7BFF              MOV      R3,#0FFH
001725 7A13              MOV      R2,#HIGH 01001386H
001727 7986              MOV      R1,#LOW 01001386H
001729 120262            LCALL    _printf
  171:         vFrame.vVersion = PKT_VERSION;
00172C 900042            MOV      DPTR,#vFrame+02H
00172F E4                CLR      A
001730 F0                MOVX     @DPTR,A
001731 A3                INC      DPTR
001732 04                INC      A
001733 F0                MOVX     @DPTR,A
  172:         return FALSE;
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 6


001734 C3                CLR      C
001735 22                RET      
  173:     }
001736         ?C0014?THREAD_PKT:
  174:     vRxTotalLen = vBlockLen-PKT_HEADER_LEN;
001736 E52E              MOV      A,vBlockLen
001738 24F8              ADD      A,#0F8H
00173A F52D              MOV      vRxTotalLen+01H,A
00173C E4                CLR      A
00173D 34FF              ADDC     A,#0FFH
00173F F52C              MOV      vRxTotalLen,A
  175: 
  176:     /* receive remaining blocks */
  177:     vElaspedTime = 0;
001741 E4                CLR      A
001742 F52F              MOV      vElaspedTime,A
001744 F530              MOV      vElaspedTime+01H,A
001746         ?C0015?THREAD_PKT:
  178:     while (vRxTotalLen < vFrame.vLen)
001746 D3                SETB     C
001747 900045            MOV      DPTR,#vFrame+05H
00174A E0                MOVX     A,@DPTR
00174B 952D              SUBB     A,vRxTotalLen+01H
00174D 900044            MOV      DPTR,#vFrame+04H
001750 E0                MOVX     A,@DPTR
001751 952C              SUBB     A,vRxTotalLen
001753 4048              JC       ?C0016?THREAD_PKT
  179:     {
  180:         vBlockLen = DRV_USB_ReadBlock(vFrame.vContent.buf+vRxTotalLen,
001755 7448              MOV      A,#LOW vFrame+08H
001757 252D              ADD      A,vRxTotalLen+01H
001759 F9                MOV      R1,A
00175A 7400              MOV      A,#HIGH vFrame+08H
00175C 352C              ADDC     A,vRxTotalLen
00175E FA                MOV      R2,A
00175F 7B01              MOV      R3,#01H
001761 123597            LCALL    ?L?COM0064
  181:                                       DRV_USB_BLOCK_MAX_LEN);
  182: 
  183:         if (vBlockLen == 0)
001764 E52E              MOV      A,vBlockLen
001766 7028              JNZ      ?C0017?THREAD_PKT
  184:         {
  185:             /* next block is still not ready */
  186: 
  187:             DRV_CPU_DelayUs(1);
001768 7F01              MOV      R7,#01H
00176A FE                MOV      R6,A
00176B 121C26            LCALL    _DRV_CPU_DelayUs
  188:             if (++vElaspedTime >= 50000)
00176E 0530              INC      vElaspedTime+01H
001770 E530              MOV      A,vElaspedTime+01H
001772 7002              JNZ      ?C0069?THREAD_PKT
001774 052F              INC      vElaspedTime
001776         ?C0069?THREAD_PKT:
001776 FF                MOV      R7,A
001777 AE2F              MOV      R6,vElaspedTime
001779 E4                CLR      A
00177A FC                MOV      R4,A
00177B FD                MOV      R5,A
00177C 7B50              MOV      R3,#050H
00177E 7AC3              MOV      R2,#0C3H
001780 F9                MOV      R1,A
001781 F8                MOV      R0,A
001782 D3                SETB     C
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 7


001783 120607            LCALL    ?C?SLCMP
001786 50BE              JNC      ?C0015?THREAD_PKT
  189:             {
  190:                 /* timeout: 50ms */
  191:                 printf("rx packet timeout!\n");
001788 7BFF              MOV      R3,#0FFH
00178A 7A13              MOV      R2,#HIGH 0100139EH
00178C 799E              MOV      R1,#LOW 0100139EH
  192:                 PKT_SetReply(PKT_REPLY_Fail_InvalidContent);
  193:                 return FALSE;
00178E 8021              SJMP     ?C0076?THREAD_PKT
  194:             }
  195: 
  196:             continue;
  197:         }
001790         ?C0017?THREAD_PKT:
  198: 
  199:         vRxTotalLen += vBlockLen;
001790 E52E              MOV      A,vBlockLen
001792 252D              ADD      A,vRxTotalLen+01H
001794 F52D              MOV      vRxTotalLen+01H,A
001796 E4                CLR      A
001797 352C              ADDC     A,vRxTotalLen
001799 F52C              MOV      vRxTotalLen,A
  200:     }
00179B 80A9              SJMP     ?C0015?THREAD_PKT
00179D         ?C0016?THREAD_PKT:
  201: 
  202:     if (vRxTotalLen != vFrame.vLen)
00179D 900044            MOV      DPTR,#vFrame+04H
0017A0 E0                MOVX     A,@DPTR
0017A1 652C              XRL      A,vRxTotalLen
0017A3 7004              JNZ      ?C0070?THREAD_PKT
0017A5 A3                INC      DPTR
0017A6 E0                MOVX     A,@DPTR
0017A7 652D              XRL      A,vRxTotalLen+01H
0017A9         ?C0070?THREAD_PKT:
0017A9 600E              JZ       ?C0022?THREAD_PKT
  203:     {
  204:         printf("invalid packet length!\n");
0017AB 7BFF              MOV      R3,#0FFH
0017AD 7A13              MOV      R2,#HIGH 010013B2H
0017AF 79B2              MOV      R1,#LOW 010013B2H
0017B1         
0017B1 123540            LCALL    ?L?COM004F
0017B4 7401              MOV      A,#01H
0017B6 F0                MOVX     @DPTR,A
  205:         PKT_SetReply(PKT_REPLY_Fail_InvalidContent);
  206:         return FALSE;
0017B7 C3                CLR      C
0017B8 22                RET      
  207:     }
0017B9         ?C0022?THREAD_PKT:
  208:   #endif
  209: 
  210: 	/* dump rx frame */
  211:     _thread_pkt_Dump(TRUE);
0017B9 D238              SETB     ?_thread_pkt_Dump?BIT
0017BB 12002A            LCALL    _thread_pkt_Dump
  212: 
  213:     /* frame verify: CRC */
  214:     if (vFrame.vCRC != _thread_pkt_CalcCRC())
0017BE D13C              ACALL    _thread_pkt_CalcCRC
0017C0 900046            MOV      DPTR,#vFrame+06H
0017C3 E0                MOVX     A,@DPTR
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 8


0017C4 6E                XRL      A,R6
0017C5 7003              JNZ      ?C0071?THREAD_PKT
0017C7 A3                INC      DPTR
0017C8 E0                MOVX     A,@DPTR
0017C9 6F                XRL      A,R7
0017CA         ?C0071?THREAD_PKT:
0017CA 600D              JZ       ?C0026?THREAD_PKT
  215:     {
  216:         printf("invalid CRC!\n");
0017CC 7BFF              MOV      R3,#0FFH
0017CE 7A13              MOV      R2,#HIGH 010013CAH
0017D0 79CA              MOV      R1,#LOW 010013CAH
0017D2 123540            LCALL    ?L?COM004F
0017D5 14                DEC      A
0017D6 F0                MOVX     @DPTR,A
  217:         PKT_SetReply(PKT_REPLY_Fail_InvalidCRC);
  218:         return FALSE;
0017D7 C3                CLR      C
0017D8 22                RET      
  219:     }
0017D9         ?C0026?THREAD_PKT:
  220: 
  221:     return TRUE;
0017D9 D3                SETB     C
  222: }
0017DA 22                RET      
----- FUNCTION _thread_pkt_Receive (END) -------


----- FUNCTION _thread_Pkt_Notify (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  291: void thread_Pkt_Notify(IN UINT8 vEvent)
  292: {
;---- Variable 'vEvent' assigned to Register 'R7' ----
  293: 	if (vEvent & RX_COMPLETE)
  294: 	{
0017DB EF                MOV      A,R7
0017DC 30E208            JNB      ACC.2,?C0045?THREAD_PKT
  295: 		/* notify packet has been received */
  296: 		PT_SEM_SIGNAL(NULL, &vSCB_RxPkt);
0017DF 050B              INC      vSCB_RxPkt+01H
0017E1 E50B              MOV      A,vSCB_RxPkt+01H
0017E3 7002              JNZ      ?C0073?THREAD_PKT
0017E5 050A              INC      vSCB_RxPkt
0017E7         ?C0073?THREAD_PKT:
  297: 	}
0017E7         ?C0045?THREAD_PKT:
  298: 
  299: 	if (vEvent & FIFO_PURGE)
0017E7 EF                MOV      A,R7
0017E8 30E30A            JNB      ACC.3,?C0047?THREAD_PKT
  300: 	{
  301:         /* notify the FIFO needs to be flushed */
  302: 		PT_SEM_SIGNAL(NULL, &vSCB_RxPkt);
0017EB 050B              INC      vSCB_RxPkt+01H
0017ED E50B              MOV      A,vSCB_RxPkt+01H
0017EF 7002              JNZ      ?C0074?THREAD_PKT
0017F1 050A              INC      vSCB_RxPkt
0017F3         ?C0074?THREAD_PKT:
  303:         bFlushFIFO = TRUE;
0017F3 D247              SETB     bFlushFIFO
  304: 	}
  305: }
0017F5         ?C0047?THREAD_PKT:
0017F5 22                RET      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 9


----- FUNCTION _thread_Pkt_Notify (END) -------


----- FUNCTION _CFG_RAM_GET16 (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   84:                 break;
   85:         }
;---- Variable 'vAddr' assigned to Register 'R6/R7' ----
0017F6 A807              MOV      R0,AR7
0017F8 E2                MOVX     A,@R0
0017F9 FE                MOV      R6,A
0017FA 08                INC      R0
0017FB E2                MOVX     A,@R0
0017FC FF                MOV      R7,A
0017FD 22                RET      
----- FUNCTION _CFG_RAM_GET16 (END) -------


----- FUNCTION _thread_pkt_Handle (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  224: static void _thread_pkt_Handle(void)
  225: {
  226: 	UINT16  vCmd;
  227: 	UINT16  vReply;
  228: 	UINT8   vLoop;
  229: 
  230:     vCmd = PKT_GetCmd();
001800 900048            MOV      DPTR,#vFrame+08H
001803 E0                MOVX     A,@DPTR
001804 F52C              MOV      vCmd,A
001806 A3                INC      DPTR
001807 E0                MOVX     A,@DPTR
001808 F52D              MOV      vCmd+01H,A
  231: 	vReply = PKT_REPLY_Fail_InvalidCmd;
;---- Variable 'vReply' assigned to Register 'R6/R7' ----
00180A 7403              MOV      A,#03H
00180C FF                MOV      R7,A
00180D FE                MOV      R6,A
  232: 	for (vLoop = 0; vLoop < COUNT_OF(aCmdTable); vLoop++)
00180E E4                CLR      A
00180F F52E              MOV      vLoop,A
001811         ?C0030?THREAD_PKT:
  233: 	{
  234: 		if (aCmdTable[vLoop].vCmd == vCmd)
001811 E52E              MOV      A,vLoop
001813 25E0              ADD      A,ACC
001815 25E0              ADD      A,ACC
001817 24D8              ADD      A,#LOW aCmdTable
001819 F582              MOV      DPL,A
00181B E4                CLR      A
00181C 3413              ADDC     A,#HIGH aCmdTable
00181E F583              MOV      DPH,A
001820 7401              MOV      A,#01H
001822 93                MOVC     A,@A+DPTR
001823 B52D22            CJNE     A,vCmd+01H,?C0032?THREAD_PKT
001826 E4                CLR      A
001827 93                MOVC     A,@A+DPTR
001828 B52C1D            CJNE     A,vCmd,?C0032?THREAD_PKT
  235: 		{
  236: 			vReply = aCmdTable[vLoop].pExec();
00182B E52E              MOV      A,vLoop
00182D 25E0              ADD      A,ACC
00182F 25E0              ADD      A,ACC
001831 24DA              ADD      A,#LOW aCmdTable+02H
001833 F582              MOV      DPL,A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 10


001835 E4                CLR      A
001836 3413              ADDC     A,#HIGH aCmdTable+02H
001838 F583              MOV      DPH,A
00183A E4                CLR      A
00183B 93                MOVC     A,@A+DPTR
00183C FE                MOV      R6,A
00183D 7401              MOV      A,#01H
00183F 93                MOVC     A,@A+DPTR
001840 AA06              MOV      R2,AR6
001842 F9                MOV      R1,A
001843 120704            LCALL    ?C?ICALL
  237: 			break;
001846 8009              SJMP     ?C0036?THREAD_PKT
  238: 		}
  239: 	}
001848         ?C0032?THREAD_PKT:
001848 052E              INC      vLoop
00184A E52E              MOV      A,vLoop
00184C C3                CLR      C
00184D 9411              SUBB     A,#011H
00184F 40C0              JC       ?C0030?THREAD_PKT
001851         ?C0036?THREAD_PKT:
  240: 
  241: 	PKT_SetReply(vReply);
001851 900048            MOV      DPTR,#vFrame+08H
001854 EE                MOV      A,R6
001855 F0                MOVX     @DPTR,A
001856 A3                INC      DPTR
001857 EF                MOV      A,R7
001858 F0                MOVX     @DPTR,A
  242:     if (PKT_GetReplyState(vReply) == PKT_ReplyState_Fail)
001859 EE                MOV      A,R6
00185A 6403              XRL      A,#03H
00185C 7004              JNZ      ?C0041?THREAD_PKT
  243:     {
  244:         PKT_SetPayloadSize(0x00);
00185E A3                INC      DPTR
00185F F0                MOVX     @DPTR,A
001860 A3                INC      DPTR
001861 F0                MOVX     @DPTR,A
  245:     }
  246: }
001862         ?C0041?THREAD_PKT:
001862 22                RET      
----- FUNCTION _thread_pkt_Handle (END) -------


----- FUNCTION thread_PKT_Entry (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  322: OS_HANDLE thread_PKT_Entry(void)
  323: {
  324:     PT_BEGIN(&vTCB_Pkt);
  325: 
001863 752B01            MOV      PT_YIELD_FLAG,#01H
001866         ?C0048?THREAD_PKT:
001866 E50D              MOV      A,vTCB_Pkt+01H
001868 850CF0            MOV      B,vTCB_Pkt
00186B 12069D            LCALL    ?C?ICASE
00186E 187A              DW       ?C0058?THREAD_PKT
001870 0000              DW       00H
001872 1880              DW       ?C0059?THREAD_PKT
001874 0149              DW       0149H
001876 0000              DW       00H
001878 18AF              DW       ?C0049?THREAD_PKT
  326:     for (;;)
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 11


  327:     {
  328:         /* wait for packet */
  329:         PT_SEM_WAIT(&vTCB_Pkt, &vSCB_RxPkt);
00187A         ?C0058?THREAD_PKT:
00187A 750C01            MOV      vTCB_Pkt,#01H
00187D 750D49            MOV      vTCB_Pkt+01H,#049H
001880         ?C0059?THREAD_PKT:
001880 AE0A              MOV      R6,vSCB_RxPkt
001882 AF0B              MOV      R7,vSCB_RxPkt+01H
001884 D3                SETB     C
001885 EF                MOV      A,R7
001886 9400              SUBB     A,#00H
001888 EE                MOV      A,R6
001889 9400              SUBB     A,#00H
00188B 4003              JC       ?C0061?THREAD_PKT
00188D D3                SETB     C
00188E 8001              SJMP     ?C0062?THREAD_PKT
001890         ?C0061?THREAD_PKT:
001890 C3                CLR      C
001891         ?C0062?THREAD_PKT:
001891 4003              JC       ?C0057?THREAD_PKT
001893 7F00              MOV      R7,#00H
001895 22                RET      
001896         ?C0057?THREAD_PKT:
001896 E50B              MOV      A,vSCB_RxPkt+01H
001898 150B              DEC      vSCB_RxPkt+01H
00189A 7002              JNZ      ?C0075?THREAD_PKT
00189C 150A              DEC      vSCB_RxPkt
00189E         ?C0075?THREAD_PKT:
  330: 
  331:         if (_thread_pkt_Receive())
00189E 1216CB            LCALL    _thread_pkt_Receive
0018A1 5002              JNC      ?C0064?THREAD_PKT
  332:         {
  333:             _thread_pkt_Handle();
0018A3 1100              ACALL    _thread_pkt_Handle
  334:         }
0018A5         ?C0064?THREAD_PKT:
  335:         _thread_pkt_Transmit();
0018A5 121688            LCALL    _thread_pkt_Transmit
  336: 
  337:         /* reset packet counter */
  338:         PT_SEM_INIT(&vSCB_RxPkt, 0);
0018A8 E4                CLR      A
0018A9 F50A              MOV      vSCB_RxPkt,A
0018AB F50B              MOV      vSCB_RxPkt+01H,A
  339:     }
0018AD 80CB              SJMP     ?C0058?THREAD_PKT
  340: 
  341:     PT_END(&vTCB_Pkt);
0018AF         ?C0049?THREAD_PKT:
0018AF E4                CLR      A
0018B0 F52B              MOV      PT_YIELD_FLAG,A
0018B2 F50C              MOV      vTCB_Pkt,A
0018B4 F50D              MOV      vTCB_Pkt+01H,A
0018B6 7F03              MOV      R7,#03H
  342: }
0018B8 22                RET      
----- FUNCTION thread_PKT_Entry (END) -------


----- FUNCTION thread_PKT_Init (BEGIN) -----
 FILE: '..\pkt\thread_pkt.c'
  359: void thread_PKT_Init(void)
  360: {
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 12


  361:     PT_INIT(&vTCB_Pkt);
  362:     PT_SEM_INIT(&vSCB_RxPkt, 0);
0018B9 E4                CLR      A
0018BA F50C              MOV      vTCB_Pkt,A
0018BC F50D              MOV      vTCB_Pkt+01H,A
  363: 
0018BE F50A              MOV      vSCB_RxPkt,A
0018C0 F50B              MOV      vSCB_RxPkt+01H,A
  364:     vMagicNo = CFG_GET(Vendor_PKT_MagicNo);
0018C2 7F76              MOV      R7,#076H
0018C4 7E38              MOV      R6,#038H
0018C6 11CD              ACALL    _CFG_ROM_GET16
0018C8 8E08              MOV      vMagicNo,R6
0018CA 8F09              MOV      vMagicNo+01H,R7
  365: }
0018CC 22                RET      
----- FUNCTION thread_PKT_Init (END) -------


----- FUNCTION _CFG_ROM_GET16 (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   85:         }
   86:     }
;---- Variable 'vAddr' assigned to Register 'DPTR' ----
0018CD 8F82              MOV      DPL,R7
0018CF 8E83              MOV      DPH,R6
0018D1 E4                CLR      A
0018D2 93                MOVC     A,@A+DPTR
0018D3 FE                MOV      R6,A
0018D4 7401              MOV      A,#01H
0018D6 93                MOVC     A,@A+DPTR
0018D7 FF                MOV      R7,A
0018D8 22                RET      
----- FUNCTION _CFG_ROM_GET16 (END) -------


----- FUNCTION APL_Entry (BEGIN) -----
 FILE: '..\apl\apl.c'
  120: void APL_Entry(void)
  121: {
  122:     /* PWM_VBUF */
  123:     DRV_PCA_Write(PCA(PWM_VBUF), CFG_GET(RT_EVB_CTRL_PWM_VBUF));
0018D9 7818              MOV      R0,#018H
0018DB E2                MOVX     A,@R0
0018DC FF                MOV      R7,A
0018DD 8FFC              MOV      PCA0CPH0,R7
0018DF         ?C0163?APL:
  124: 
  125: 	/* DDM */
  126: 	CFG_SET_DDM(DDM_EVB_TEMP, apl_ddm_GetEVBTemp());
0018DF 122F21            LCALL    apl_ddm_GetEVBTemp
0018E2 AC06              MOV      R4,AR6
0018E4 AD07              MOV      R5,AR7
0018E6 E4                CLR      A
0018E7 FF                MOV      R7,A
0018E8 FE                MOV      R6,A
0018E9 F1EF              ACALL    _CFG_RAM_SET16
0018EB         ?C0170?APL:
  127: 	CFG_SET_DDM(DDM_EVB_VCC,  apl_ddm_GetEVBVCC());
0018EB 123089            LCALL    apl_ddm_GetEVBVCC
0018EE AC06              MOV      R4,AR6
0018F0 AD07              MOV      R5,AR7
0018F2 7F02              MOV      R7,#02H
0018F4 7E00              MOV      R6,#00H
0018F6 F1EF              ACALL    _CFG_RAM_SET16
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 13


0018F8         ?C0177?APL:
  128: 	CFG_SET_DDM(DDM_EVB_VBUF, apl_ddm_GetEVBVBUF());
0018F8 1230A0            LCALL    apl_ddm_GetEVBVBUF
0018FB AC06              MOV      R4,AR6
0018FD AD07              MOV      R5,AR7
0018FF 7F04              MOV      R7,#04H
001901 7E00              MOV      R6,#00H
001903 F1EF              ACALL    _CFG_RAM_SET16
001905         ?C0176?APL:
  129: 
  130:     /* RT_EVB_STAT */
  131:   #if 1
  132:     /* EVB Temperature */
  133:     if (((SINT16)CFG_GET(DDM_EVB_TEMP) > (SINT16)CFG_GET(DDM_EVB_TEMP_Max)) ||
  134:         ((SINT16)CFG_GET(DDM_EVB_TEMP) < (SINT16)CFG_GET(DDM_EVB_TEMP_Min)))
001905 7F40              MOV      R7,#040H
001907 12343B            LCALL    ?L?COM0031
00190A C006              PUSH     AR6
00190C C007              PUSH     AR7
00190E FF                MOV      R7,A
00190F 1233C7            LCALL    ?L?COM0022
001912 D007              POP      AR7
001914 D006              POP      AR6
001916 D3                SETB     C
001917 123522            LCALL    ?L?COM004B
00191A 5017              JNC      ?C0219?APL
00191C 7F42              MOV      R7,#042H
00191E 12343B            LCALL    ?L?COM0031
001921 C006              PUSH     AR6
001923 C007              PUSH     AR7
001925 FF                MOV      R7,A
001926 1233C7            LCALL    ?L?COM0022
001929 D007              POP      AR7
00192B D006              POP      AR6
00192D C3                CLR      C
00192E 123522            LCALL    ?L?COM004B
001931 500D              JNC      ?C0267?APL
  135:     {
  136:         CFG_SET(RT_EVB_STAT_EVB_TEMP_Ready, LOW);
001933         ?C0219?APL:
001933 E4                CLR      A
001934 F52C              MOV      _v,A
001936 7819              MOV      R0,#019H
001938 E2                MOVX     A,@R0
001939 123277            LCALL    ?L?COM0008
00193C 6020              JZ       ?C0231?APL
00193E 800B              SJMP     ?C0626?APL
  137:     }
  138:     else
  139:     {
  140:         CFG_SET(RT_EVB_STAT_EVB_TEMP_Ready, HIGH);
001940         ?C0267?APL:
001940 752C01            MOV      _v,#01H
001943 7819              MOV      R0,#019H
001945 E2                MOVX     A,@R0
001946 123277            LCALL    ?L?COM0008
001949 6013              JZ       ?C0231?APL
00194B         
00194B 7819              MOV      R0,#019H
00194D E2                MOVX     A,@R0
00194E FF                MOV      R7,A
00194F EF                MOV      A,R7
001950 54FE              ANL      A,#0FEH
001952 FB                MOV      R3,A
001953 E52C              MOV      A,_v
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 14


001955 5401              ANL      A,#01H
001957 FF                MOV      R7,A
001958 EF                MOV      A,R7
001959 4B                ORL      A,R3
00195A FF                MOV      R7,A
00195B E4                CLR      A
00195C EF                MOV      A,R7
00195D F2                MOVX     @R0,A
  141:     }
00195E         ?C0231?APL:
  142: 
  143:     /* EVB VCC */
  144:     if (((UINT16)CFG_GET(DDM_EVB_VCC) > (UINT16)CFG_GET(DDM_EVB_VCC_Max)) ||
  145:         ((UINT16)CFG_GET(DDM_EVB_VCC) < (UINT16)CFG_GET(DDM_EVB_VCC_Min)))
00195E 7F44              MOV      R7,#044H
001960 12343B            LCALL    ?L?COM0031
001963 C006              PUSH     AR6
001965 C007              PUSH     AR7
001967 7F02              MOV      R7,#02H
001969 1233C7            LCALL    ?L?COM0022
00196C D007              POP      AR7
00196E D006              POP      AR6
001970 D3                SETB     C
001971 ED                MOV      A,R5
001972 9F                SUBB     A,R7
001973 EC                MOV      A,R4
001974 9E                SUBB     A,R6
001975 5019              JNC      ?C0316?APL
001977 7F46              MOV      R7,#046H
001979 12343B            LCALL    ?L?COM0031
00197C C006              PUSH     AR6
00197E C007              PUSH     AR7
001980 7F02              MOV      R7,#02H
001982 1233C7            LCALL    ?L?COM0022
001985 D007              POP      AR7
001987 D006              POP      AR6
001989 C3                CLR      C
00198A ED                MOV      A,R5
00198B 9F                SUBB     A,R7
00198C EC                MOV      A,R4
00198D 9E                SUBB     A,R6
00198E 500F              JNC      ?C0364?APL
  146:     {
  147:         CFG_SET(RT_EVB_STAT_EVB_VCC_Ready, LOW);
001990         ?C0316?APL:
001990 E4                CLR      A
001991 F52C              MOV      _v,A
001993 7819              MOV      R0,#019H
001995 E2                MOVX     A,@R0
001996 C3                CLR      C
001997 13                RRC      A
001998 123277            LCALL    ?L?COM0008
00199B 6033              JZ       ?C0328?APL
00199D 800D              SJMP     ?C0627?APL
  148:     }
  149:     else
  150:     {
  151:         CFG_SET(RT_EVB_STAT_EVB_VCC_Ready, HIGH);
00199F         ?C0364?APL:
00199F 752C01            MOV      _v,#01H
0019A2 7819              MOV      R0,#019H
0019A4 E2                MOVX     A,@R0
0019A5 C3                CLR      C
0019A6 13                RRC      A
0019A7 123277            LCALL    ?L?COM0008
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 15


0019AA 6024              JZ       ?C0328?APL
0019AC         
0019AC 1233BB            LCALL    ?L?COM001F
0019AF 54FD              ANL      A,#0FDH
0019B1 FF                MOV      R7,A
0019B2 C004              PUSH     AR4
0019B4 C005              PUSH     AR5
0019B6 C006              PUSH     AR6
0019B8 C007              PUSH     AR7
0019BA E52C              MOV      A,_v
0019BC 5401              ANL      A,#01H
0019BE FF                MOV      R7,A
0019BF E4                CLR      A
0019C0 7801              MOV      R0,#01H
0019C2 120642            LCALL    ?C?LSHL
0019C5 D003              POP      AR3
0019C7 D002              POP      AR2
0019C9 D001              POP      AR1
0019CB D000              POP      AR0
0019CD 1233E0            LCALL    ?L?COM0028
  152:     }
0019D0         ?C0328?APL:
  153: 
  154:     /* EVB VBUF */
  155:     if (((UINT16)CFG_GET(DDM_EVB_VBUF) > (UINT16)CFG_GET(DDM_EVB_VBUF_Max)) ||
  156:         ((UINT16)CFG_GET(DDM_EVB_VBUF) < (UINT16)CFG_GET(DDM_EVB_VBUF_Min)))
0019D0 7F48              MOV      R7,#048H
0019D2 12343B            LCALL    ?L?COM0031
0019D5 C006              PUSH     AR6
0019D7 C007              PUSH     AR7
0019D9 1233C5            LCALL    ?L?COM0021
0019DC D007              POP      AR7
0019DE D006              POP      AR6
0019E0 D3                SETB     C
0019E1 ED                MOV      A,R5
0019E2 9F                SUBB     A,R7
0019E3 EC                MOV      A,R4
0019E4 9E                SUBB     A,R6
0019E5 5017              JNC      ?C0413?APL
0019E7 7F4A              MOV      R7,#04AH
0019E9 12343B            LCALL    ?L?COM0031
0019EC C006              PUSH     AR6
0019EE C007              PUSH     AR7
0019F0 1233C5            LCALL    ?L?COM0021
0019F3 D007              POP      AR7
0019F5 D006              POP      AR6
0019F7 C3                CLR      C
0019F8 ED                MOV      A,R5
0019F9 9F                SUBB     A,R7
0019FA EC                MOV      A,R4
0019FB 9E                SUBB     A,R6
0019FC 500D              JNC      ?C0461?APL
  157:     {
  158:         CFG_SET(RT_EVB_STAT_EVB_VBUF_Ready, LOW);
0019FE         ?C0413?APL:
0019FE E4                CLR      A
0019FF F52C              MOV      _v,A
001A01 1234FE            LCALL    ?L?COM0045
001A04 123277            LCALL    ?L?COM0008
001A07 6031              JZ       ?C0425?APL
001A09 800B              SJMP     ?C0628?APL
  159:     }
  160:     else
  161:     {
  162:         CFG_SET(RT_EVB_STAT_EVB_VBUF_Ready, HIGH);
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 16


001A0B         ?C0461?APL:
001A0B 752C01            MOV      _v,#01H
001A0E 1234FE            LCALL    ?L?COM0045
001A11 123277            LCALL    ?L?COM0008
001A14 6024              JZ       ?C0425?APL
001A16         
001A16 1233BB            LCALL    ?L?COM001F
001A19 54FB              ANL      A,#0FBH
001A1B FF                MOV      R7,A
001A1C C004              PUSH     AR4
001A1E C005              PUSH     AR5
001A20 C006              PUSH     AR6
001A22 C007              PUSH     AR7
001A24 E52C              MOV      A,_v
001A26 5401              ANL      A,#01H
001A28 FF                MOV      R7,A
001A29 E4                CLR      A
001A2A 7802              MOV      R0,#02H
001A2C 120642            LCALL    ?C?LSHL
001A2F D003              POP      AR3
001A31 D002              POP      AR2
001A33 D001              POP      AR1
001A35 D000              POP      AR0
001A37 1233E0            LCALL    ?L?COM0028
  163:     }
001A3A         ?C0425?APL:
  164: 
  165:     /* EVB Global Ready */
  166:     if ((CFG_GET(RT_EVB_STAT_EVB_TEMP_Ready) == HIGH) &&
  167:         (CFG_GET(RT_EVB_STAT_EVB_VCC_Ready)  == HIGH) &&
  168:         (CFG_GET(RT_EVB_STAT_EVB_VBUF_Ready) == HIGH))
001A3A 1233BB            LCALL    ?L?COM001F
001A3D 1234BE            LCALL    ?L?COM003F
001A40 702E              JNZ      ?C0557?APL
001A42 7819              MOV      R0,#019H
001A44 E2                MOVX     A,@R0
001A45 C3                CLR      C
001A46 13                RRC      A
001A47 1233BE            LCALL    ?L?COM0020
001A4A 5401              ANL      A,#01H
001A4C FF                MOV      R7,A
001A4D E4                CLR      A
001A4E F8                MOV      R0,A
001A4F C3                CLR      C
001A50 12061D            LCALL    ?C?ULCMP
001A53 701B              JNZ      ?C0557?APL
001A55 1234FE            LCALL    ?L?COM0045
001A58 1233BE            LCALL    ?L?COM0020
001A5B 5401              ANL      A,#01H
001A5D FF                MOV      R7,A
001A5E E4                CLR      A
001A5F F8                MOV      R0,A
001A60 C3                CLR      C
001A61 12061D            LCALL    ?C?ULCMP
001A64 700A              JNZ      ?C0557?APL
  169:     {
  170:         CFG_SET(RT_EVB_STAT_Global_Ready, HIGH);
001A66         ?C0509?APL:
001A66 752C01            MOV      _v,#01H
001A69 12326E            LCALL    ?L?COM0007
001A6C 602E              JZ       ?C0569?APL
001A6E 8008              SJMP     ?C0629?APL
  171:     }
  172:     else
  173:     {
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 17


  174:         CFG_SET(RT_EVB_STAT_Global_Ready, LOW);
001A70         ?C0557?APL:
001A70 E4                CLR      A
001A71 F52C              MOV      _v,A
001A73 12326E            LCALL    ?L?COM0007
001A76 6024              JZ       ?C0569?APL
001A78         
001A78 1233BB            LCALL    ?L?COM001F
001A7B 547F              ANL      A,#07FH
001A7D FF                MOV      R7,A
001A7E C004              PUSH     AR4
001A80 C005              PUSH     AR5
001A82 C006              PUSH     AR6
001A84 C007              PUSH     AR7
001A86 E52C              MOV      A,_v
001A88 5401              ANL      A,#01H
001A8A FF                MOV      R7,A
001A8B E4                CLR      A
001A8C 7807              MOV      R0,#07H
001A8E 120642            LCALL    ?C?LSHL
001A91 D003              POP      AR3
001A93 D002              POP      AR2
001A95 D001              POP      AR1
001A97 D000              POP      AR0
001A99 1233E0            LCALL    ?L?COM0028
  175:     }
  176:   #endif
  177: }
001A9C         ?C0569?APL:
001A9C 22                RET      
----- FUNCTION APL_Entry (END) -------


----- FUNCTION __pkt_i2cm_TxByte (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  126: static BOOL _pkt_i2cm_TxByte(UINT8 vData)
  127: {
001A9D 8F3F              MOV      vData,R7
  128:     UINT8   vLoop;
  129:     BOOL    vAck;
  130: 
  131:     for (vLoop = 8; vLoop != 0; vLoop--)
001A9F 754008            MOV      vLoop,#08H
001AA2         ?C0001?PKT_I2CM:
  132:     {
  133:         /* transmitting data, MSB first, LSB last */
  134:         CROL(vData, 1);
001AA2 AF3F              MOV      R7,vData
001AA4 7801              MOV      R0,#01H
001AA6 EF                MOV      A,R7
001AA7 08                INC      R0
001AA8 8001              SJMP     ?C0371?PKT_I2CM
001AAA         ?C0370?PKT_I2CM:
001AAA 23                RL       A
001AAB         ?C0371?PKT_I2CM:
001AAB D8FD              DJNZ     R0,?C0370?PKT_I2CM
001AAD F53F              MOV      vData,A
  135:         PKT_I2CM_SET_SDA(vData & 0x1);
001AAF 13                RRC      A
001AB0 9292              MOV      IO_DUT_I2CM_SDA,C
  136: 
  137:         PKT_I2CM_SET_SCL(HIGH);
001AB2 123292            LCALL    ?L?COM000B
001AB5 123432            LCALL    ?L?COM0030
001AB8         ?C0020?PKT_I2CM:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 18


001AB8 20820E            JB       IO_DUT_I2CM_SCL,?C0027?PKT_I2CM
001ABB 1234F7            LCALL    ?L?COM0044
001ABE 7002              JNZ      ?C0372?PKT_I2CM
001AC0 1541              DEC      _loop
001AC2         ?C0372?PKT_I2CM:
001AC2 4E                ORL      A,R6
001AC3 6004              JZ       ?C0027?PKT_I2CM
001AC5 9122              ACALL    ?L?COM0006
001AC7 80EF              SJMP     ?C0020?PKT_I2CM
  138:         PKT_I2CM_SET_SCL(LOW);
001AC9         ?C0027?PKT_I2CM:
001AC9 123292            LCALL    ?L?COM000B
001ACC C282              CLR      IO_DUT_I2CM_SCL
001ACE 8000              SJMP     ?C0003?PKT_I2CM
  139:     }
001AD0         ?C0003?PKT_I2CM:
001AD0 D540CF            DJNZ     vLoop,?C0001?PKT_I2CM
001AD3         ?C0036?PKT_I2CM:
  140: 
  141:     /* release SDA */
  142:     PKT_I2CM_SET_SDA(HIGH);
001AD3 D292              SETB     IO_DUT_I2CM_SDA
  143: 
  144:     /* check ACK */
  145:     PKT_I2CM_SET_SCL(HIGH);
001AD5 123292            LCALL    ?L?COM000B
001AD8 123432            LCALL    ?L?COM0030
001ADB         ?C0047?PKT_I2CM:
001ADB 20820E            JB       IO_DUT_I2CM_SCL,?C0038?PKT_I2CM
001ADE 1234F7            LCALL    ?L?COM0044
001AE1 7002              JNZ      ?C0374?PKT_I2CM
001AE3 1541              DEC      _loop
001AE5         ?C0374?PKT_I2CM:
001AE5 4E                ORL      A,R6
001AE6 6004              JZ       ?C0038?PKT_I2CM
001AE8 9122              ACALL    ?L?COM0006
001AEA 80EF              SJMP     ?C0047?PKT_I2CM
001AEC         ?C0038?PKT_I2CM:
  146:     vAck = PKT_I2CM_GET_SDA();
001AEC A292              MOV      C,IO_DUT_I2CM_SDA
001AEE 923A              MOV      vAck,C
  147:     PKT_I2CM_SET_SCL(LOW);
001AF0 123292            LCALL    ?L?COM000B
001AF3 C282              CLR      IO_DUT_I2CM_SCL
001AF5 8000              SJMP     ?C0050?PKT_I2CM
001AF7         ?C0050?PKT_I2CM:
  148: 
  149:     return !vAck;
001AF7 A23A              MOV      C,vAck
001AF9 B3                CPL      C
  150: }
001AFA 22                RET      
----- FUNCTION __pkt_i2cm_TxByte (END) -------


----- FUNCTION _pkt_i2cm_Stream (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  221: static BOOL pkt_i2cm_Stream(IN OUT PKT_I2CM_STREAM_T SEG_XDATA *pPayload)
  222: {
001AFB 123566            LCALL    ?L?COM005E
001AFE A3                INC      DPTR
001AFF 12330C            LCALL    ?L?COM0011
  223:     UINT16  vWriteLen = pPayload->vWriteLen;
  224:     UINT16  vReadLen  = pPayload->vReadLen;
001B02 123482            LCALL    ?L?COM003B
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 19


  225:     BOOL    bIntState;
  226:     BOOL    bDone = FALSE;
001B05 C239              CLR      bDone
  227:     UINT16  vLoop;
  228: 
  229:     /* make sure the I2C is ready */
  230:     if (!_pkt_i2cm_CheckReady())
001B07 9146              ACALL    _pkt_i2cm_CheckReady
001B09 4003              JC       ?C0213?PKT_I2CM
  231:     {
  232:         return bDone;
001B0B A239              MOV      C,bDone
001B0D 22                RET      
  233:     }
001B0E         ?C0213?PKT_I2CM:
  234: 
  235:     /* lock globally interrupt */
  236:     bIntState = DRV_INT_LockGlobalInterrupt();
001B0E 30AF05            JNB      EA,?C0215?PKT_I2CM
001B11 C2AF              CLR      EA
001B13 D3                SETB     C
001B14 8001              SJMP     ?C0216?PKT_I2CM
001B16         ?C0215?PKT_I2CM:
001B16 C3                CLR      C
001B17         ?C0216?PKT_I2CM:
001B17 9238              MOV      bIntState,C
  237: 
  238:     /* send write stream */
  239:     if ((vWriteLen != 0)
001B19 E538              MOV      A,vWriteLen+01H
001B1B 4537              ORL      A,vWriteLen
001B1D 700C              JNZ      ?C0224?PKT_I2CM
001B1F E538              MOV      A,vWriteLen+01H
001B21 4537              ORL      A,vWriteLen
001B23 706C              JNZ      ?C0217?PKT_I2CM
001B25 E53A              MOV      A,vReadLen+01H
001B27 4539              ORL      A,vReadLen
001B29 7066              JNZ      ?C0217?PKT_I2CM
  240:         || ((vWriteLen == 0) && (vReadLen == 0)))
  241:     {
  242:         /* send I2C start */
  243:         _pkt_i2cm_Start();
001B2B         ?C0224?PKT_I2CM:
001B2B D292              SETB     IO_DUT_I2CM_SDA
001B2D 123292            LCALL    ?L?COM000B
001B30 1234D4            LCALL    ?L?COM0041
001B33         ?C0235?PKT_I2CM:
001B33 208211            JB       IO_DUT_I2CM_SCL,?C0239?PKT_I2CM
001B36 E53E              MOV      A,_loop+01H
001B38 153E              DEC      _loop+01H
001B3A AE3D              MOV      R6,_loop
001B3C 7002              JNZ      ?C0385?PKT_I2CM
001B3E 153D              DEC      _loop
001B40         ?C0385?PKT_I2CM:
001B40 4E                ORL      A,R6
001B41 6004              JZ       ?C0239?PKT_I2CM
001B43 9122              ACALL    ?L?COM0006
001B45 80EC              SJMP     ?C0235?PKT_I2CM
001B47         ?C0239?PKT_I2CM:
001B47 123289            LCALL    ?L?COM0009
001B4A C282              CLR      IO_DUT_I2CM_SCL
001B4C 8000              SJMP     ?C0220?PKT_I2CM
001B4E         ?C0220?PKT_I2CM:
  244: 
  245:         /* send I2C slave address + write */
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 20


  246:         if (!_pkt_i2cm_TxByte(pPayload->vI2cAddr&0xFE))
001B4E 12358F            LCALL    ?L?COM0063
001B51 54FE              ANL      A,#0FEH
001B53 FF                MOV      R7,A
001B54 519D              ACALL    __pkt_i2cm_TxByte
001B56 4002              JC       $ + 4H
001B58 61F6              AJMP     ?C0309?PKT_I2CM
  247:         {
  248:             goto _exit;
  249:         }
001B5A         ?C0255?PKT_I2CM:
  250: 
  251:         /* send write buffer */
  252:         for (vLoop = 0; vLoop < vWriteLen; vLoop++)
001B5A E4                CLR      A
001B5B F53B              MOV      vLoop,A
001B5D F53C              MOV      vLoop+01H,A
001B5F         ?C0257?PKT_I2CM:
001B5F C3                CLR      C
001B60 E53C              MOV      A,vLoop+01H
001B62 9538              SUBB     A,vWriteLen+01H
001B64 E53B              MOV      A,vLoop
001B66 9537              SUBB     A,vWriteLen
001B68 5027              JNC      ?C0217?PKT_I2CM
  253:         {
  254:             if (!_pkt_i2cm_TxByte(pPayload->aBuf[vLoop]))
001B6A E536              MOV      A,pPayload+01H
001B6C 2405              ADD      A,#05H
001B6E F582              MOV      DPL,A
001B70 E4                CLR      A
001B71 3535              ADDC     A,pPayload
001B73 F583              MOV      DPH,A
001B75 E582              MOV      A,DPL
001B77 253C              ADD      A,vLoop+01H
001B79 F582              MOV      DPL,A
001B7B E583              MOV      A,DPH
001B7D 353B              ADDC     A,vLoop
001B7F F583              MOV      DPH,A
001B81 E0                MOVX     A,@DPTR
001B82 FF                MOV      R7,A
001B83 519D              ACALL    __pkt_i2cm_TxByte
001B85 506F              JNC      ?C0309?PKT_I2CM
  255:             {
  256:                 goto _exit;
  257:             }
001B87         ?C0260?PKT_I2CM:
  258:         }
001B87         ?C0259?PKT_I2CM:
001B87 053C              INC      vLoop+01H
001B89 E53C              MOV      A,vLoop+01H
001B8B 7002              JNZ      ?C0387?PKT_I2CM
001B8D 053B              INC      vLoop
001B8F         ?C0387?PKT_I2CM:
001B8F 80CE              SJMP     ?C0257?PKT_I2CM
  259:     }
001B91         ?C0217?PKT_I2CM:
  260: 
  261:     /* send read stream */
  262:     if (vReadLen != 0)
001B91 E53A              MOV      A,vReadLen+01H
001B93 4539              ORL      A,vReadLen
001B95 605D              JZ       ?C0261?PKT_I2CM
  263:     {
  264:         /* send I2C start/restart */
  265:         _pkt_i2cm_Start();
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 21


001B97 D292              SETB     IO_DUT_I2CM_SDA
001B99 123292            LCALL    ?L?COM000B
001B9C 1234D4            LCALL    ?L?COM0041
001B9F         ?C0278?PKT_I2CM:
001B9F 208211            JB       IO_DUT_I2CM_SCL,?C0282?PKT_I2CM
001BA2 E53E              MOV      A,_loop+01H
001BA4 153E              DEC      _loop+01H
001BA6 AE3D              MOV      R6,_loop
001BA8 7002              JNZ      ?C0388?PKT_I2CM
001BAA 153D              DEC      _loop
001BAC         ?C0388?PKT_I2CM:
001BAC 4E                ORL      A,R6
001BAD 6004              JZ       ?C0282?PKT_I2CM
001BAF 9122              ACALL    ?L?COM0006
001BB1 80EC              SJMP     ?C0278?PKT_I2CM
001BB3         ?C0282?PKT_I2CM:
001BB3 123289            LCALL    ?L?COM0009
001BB6 C282              CLR      IO_DUT_I2CM_SCL
001BB8 8000              SJMP     ?C0263?PKT_I2CM
001BBA         ?C0263?PKT_I2CM:
  266: 
  267:         /* send I2C slave address + read */
  268:         if (!_pkt_i2cm_TxByte(pPayload->vI2cAddr|0x01))
001BBA 12358F            LCALL    ?L?COM0063
001BBD 4401              ORL      A,#01H
001BBF FF                MOV      R7,A
001BC0 519D              ACALL    __pkt_i2cm_TxByte
001BC2 5032              JNC      ?C0309?PKT_I2CM
  269:         {
  270:             goto _exit;
  271:         }
001BC4         ?C0298?PKT_I2CM:
  272: 
  273:         /* read data */
  274:         for (vLoop = 0; vLoop < vReadLen; vLoop++)
001BC4 E4                CLR      A
001BC5 F53B              MOV      vLoop,A
001BC7 F53C              MOV      vLoop+01H,A
001BC9         ?C0299?PKT_I2CM:
001BC9 123587            LCALL    ?L?COM0062
001BCC 9539              SUBB     A,vReadLen
001BCE 5024              JNC      ?C0261?PKT_I2CM
  275:         {
  276:             pPayload->aBuf[vWriteLen+vLoop] =
001BD0 E53A              MOV      A,vReadLen+01H
001BD2 24FF              ADD      A,#0FFH
001BD4 FF                MOV      R7,A
001BD5 E539              MOV      A,vReadLen
001BD7 34FF              ADDC     A,#0FFH
001BD9 FE                MOV      R6,A
001BDA EF                MOV      A,R7
001BDB B53C07            CJNE     A,vLoop+01H,?C0302?PKT_I2CM
001BDE EE                MOV      A,R6
001BDF B53B03            CJNE     A,vLoop,?C0302?PKT_I2CM
001BE2 D3                SETB     C
001BE3 8001              SJMP     ?C0303?PKT_I2CM
001BE5         ?C0302?PKT_I2CM:
001BE5 C3                CLR      C
001BE6         ?C0303?PKT_I2CM:
001BE6 923A              MOV      ?_pkt_i2cm_RxByte?BIT,C
001BE8 1221C0            LCALL    _pkt_i2cm_RxByte
001BEB 12334E            LCALL    ?L?COM001A
001BEE 7002              JNZ      ?C0391?PKT_I2CM
001BF0 053B              INC      vLoop
001BF2         ?C0391?PKT_I2CM:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 22


001BF2 80D5              SJMP     ?C0299?PKT_I2CM
  277:                 _pkt_i2cm_RxByte(vLoop==(vReadLen-1));
  278:         }
  279:     }
001BF4         ?C0261?PKT_I2CM:
  280: 
  281:     /* I2C stream done */
  282:     bDone = TRUE;
001BF4 D239              SETB     bDone
  283: 
  284: _exit:
001BF6         _exit:
  285:     /* send I2C stop */
  286:     _pkt_i2cm_Stop();
001BF6         ?C0309?PKT_I2CM:
001BF6 123290            LCALL    ?L?COM000A
001BF9 1234D4            LCALL    ?L?COM0041
001BFC         ?C0320?PKT_I2CM:
001BFC 208211            JB       IO_DUT_I2CM_SCL,?C0324?PKT_I2CM
001BFF E53E              MOV      A,_loop+01H
001C01 153E              DEC      _loop+01H
001C03 AE3D              MOV      R6,_loop
001C05 7002              JNZ      ?C0392?PKT_I2CM
001C07 153D              DEC      _loop
001C09         ?C0392?PKT_I2CM:
001C09 4E                ORL      A,R6
001C0A 6004              JZ       ?C0324?PKT_I2CM
001C0C 9122              ACALL    ?L?COM0006
001C0E 80EC              SJMP     ?C0320?PKT_I2CM
001C10         ?C0324?PKT_I2CM:
001C10 123292            LCALL    ?L?COM000B
001C13 D292              SETB     IO_DUT_I2CM_SDA
  287: 
  288:     /* unlock globally interrupt */
  289:     DRV_INT_UnlockGlobalInterrupt(bIntState);
001C15 A238              MOV      C,bIntState
001C17 92AF              MOV      EA,C
  290: 
  291:     return bDone;
001C19 A239              MOV      C,bDone
  292: }
001C1B 22                RET      
----- FUNCTION _pkt_i2cm_Stream (END) -------


----- FUNCTION ?L?COM0005 (BEGIN) -----
001C1C A2A0              MOV      C,IO_DUT_C2M_SDA
001C1E D297              SETB     IO_DUT_C2M_SCL
001C20 9230              MOV      bC2Bit0,C
001C22         ?L?COM0006:
001C22 7F01              MOV      R7,#01H
001C24 7E00              MOV      R6,#00H
----- FUNCTION _DRV_CPU_DelayUs (BEGIN) -----
 FILE: '..\drv\drv_cpu.c'
   46: void DRV_CPU_DelayUs(UINT16 vUsec)
   47: {
;---- Variable 'vUsec' assigned to Register 'R6/R7' ----
   48:     NOP(); NOP(); NOP();
   49: 
001C26 8018              SJMP     ?C0013?DRV_CPU
001C28         ?C0001?DRV_CPU:
   50:     while (--vUsec)
001C28 EF                MOV      A,R7
001C29 1F                DEC      R7
001C2A 7001              JNZ      ?C0011?DRV_CPU
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 23


001C2C 1E                DEC      R6
001C2D         ?C0011?DRV_CPU:
001C2D 14                DEC      A
001C2E 4E                ORL      A,R6
001C2F 6014              JZ       ?C0003?DRV_CPU
   51:     {
   52:       #if (CORE_CLOCK == 24000000UL)
   53: 		NOP(); NOP(); NOP(); NOP(); NOP();
001C31 00                NOP      
001C32 00                NOP      
001C33 00                NOP      
001C34 00                NOP      
001C35 00                NOP      
   54: 		NOP(); NOP(); NOP(); NOP(); NOP();
001C36 00                NOP      
001C37 00                NOP      
001C38 00                NOP      
001C39 00                NOP      
001C3A 00                NOP      
   55: 		NOP(); NOP(); NOP(); NOP(); NOP();
001C3B 00                NOP      
001C3C 00                NOP      
001C3D 00                NOP      
001C3E 00                NOP      
001C3F 00                NOP      
   56: 		NOP(); NOP(); NOP();
001C40         
001C40 00                NOP      
001C41 00                NOP      
001C42 00                NOP      
   57:       #else
   58:         #error "Unsupported Core Clock!"
   59:       #endif
   60:     }
001C43 80E3              SJMP     ?C0001?DRV_CPU
   61: }
001C45         ?C0003?DRV_CPU:
001C45 22                RET      
----- FUNCTION _DRV_CPU_DelayUs (END) -------


----- FUNCTION _pkt_i2cm_CheckReady (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  175: static BOOL _pkt_i2cm_CheckReady(void)
  176: {
  177:     if ((PKT_I2CM_GET_SCL() == HIGH)
  178:         && (PKT_I2CM_GET_SDA() == HIGH))
001C46 308205            JNB      IO_DUT_I2CM_SCL,?C0120?PKT_I2CM
001C49 309202            JNB      IO_DUT_I2CM_SDA,?C0120?PKT_I2CM
  179:     {
  180:         /* the I2C only can be started, while SCL/SDA is at high level */
  181:         return TRUE;
001C4C D3                SETB     C
001C4D 22                RET      
  182:     }
001C4E         ?C0120?PKT_I2CM:
  183:     else if ((PKT_I2CM_GET_SCL() == HIGH)
001C4E 308268            JNB      IO_DUT_I2CM_SCL,?C0122?PKT_I2CM
001C51 209265            JB       IO_DUT_I2CM_SDA,?C0122?PKT_I2CM
  184:              && (PKT_I2CM_GET_SDA() == LOW))
  185:     {
  186:         /* SCL line is OK, but SDA line has been stretched by I2C slave,
  187:          *  we should attempt to reset the I2C bus,
  188:          *  to recover the SDA to idle state.
  189:          *
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 24


  190:          * Memory (Management Interface) Reset:
  191:          *  1) Clock up to 9 cycles.
  192:          *  2) Look for SDA high in each cycle while SCL is high.
  193:          *  3) Create a START condition as SDA is high.
  194:          */
  195: 
  196:         UINT8   vLoop;
  197: 
  198:         for (vLoop = 9; vLoop != 0; vLoop--)
001C54 753F09            MOV      vLoop,#09H
001C57         ?C0124?PKT_I2CM:
  199:         {
  200:             PKT_I2CM_SET_SCL(LOW);
001C57 123292            LCALL    ?L?COM000B
001C5A C282              CLR      IO_DUT_I2CM_SCL
001C5C 8000              SJMP     ?C0144?PKT_I2CM
  201:             PKT_I2CM_SET_SCL(HIGH);
001C5E         ?C0144?PKT_I2CM:
001C5E 123292            LCALL    ?L?COM000B
001C61 1234CB            LCALL    ?L?COM0040
001C64         ?C0149?PKT_I2CM:
001C64 20820E            JB       IO_DUT_I2CM_SCL,?C0126?PKT_I2CM
001C67 12347B            LCALL    ?L?COM0039
001C6A 7002              JNZ      ?C0381?PKT_I2CM
001C6C 1540              DEC      _loop
001C6E         ?C0381?PKT_I2CM:
001C6E 4E                ORL      A,R6
001C6F 6004              JZ       ?C0126?PKT_I2CM
001C71 9122              ACALL    ?L?COM0006
001C73 80EF              SJMP     ?C0149?PKT_I2CM
  202:         }
001C75         ?C0126?PKT_I2CM:
001C75 D53FDF            DJNZ     vLoop,?C0124?PKT_I2CM
001C78         ?C0125?PKT_I2CM:
  203: 
  204:         if (PKT_I2CM_GET_SDA() == HIGH)
001C78 30923E            JNB      IO_DUT_I2CM_SDA,?C0122?PKT_I2CM
  205:         {
  206:             _pkt_i2cm_Start();
001C7B D292              SETB     IO_DUT_I2CM_SDA
001C7D 123292            LCALL    ?L?COM000B
001C80 1234CB            LCALL    ?L?COM0040
001C83         ?C0168?PKT_I2CM:
001C83 20820E            JB       IO_DUT_I2CM_SCL,?C0172?PKT_I2CM
001C86 12347B            LCALL    ?L?COM0039
001C89 7002              JNZ      ?C0382?PKT_I2CM
001C8B 1540              DEC      _loop
001C8D         ?C0382?PKT_I2CM:
001C8D 4E                ORL      A,R6
001C8E 6004              JZ       ?C0172?PKT_I2CM
001C90 9122              ACALL    ?L?COM0006
001C92 80EF              SJMP     ?C0168?PKT_I2CM
001C94         ?C0172?PKT_I2CM:
001C94 123289            LCALL    ?L?COM0009
001C97 C282              CLR      IO_DUT_I2CM_SCL
001C99 8000              SJMP     ?C0193?PKT_I2CM
  207:             _pkt_i2cm_Stop();
001C9B         ?C0193?PKT_I2CM:
001C9B 123290            LCALL    ?L?COM000A
001C9E 1234CB            LCALL    ?L?COM0040
001CA1         ?C0204?PKT_I2CM:
001CA1 20820E            JB       IO_DUT_I2CM_SCL,?C0208?PKT_I2CM
001CA4 12347B            LCALL    ?L?COM0039
001CA7 7002              JNZ      ?C0384?PKT_I2CM
001CA9 1540              DEC      _loop
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 25


001CAB         ?C0384?PKT_I2CM:
001CAB 4E                ORL      A,R6
001CAC 6004              JZ       ?C0208?PKT_I2CM
001CAE 9122              ACALL    ?L?COM0006
001CB0 80EF              SJMP     ?C0204?PKT_I2CM
001CB2         ?C0208?PKT_I2CM:
001CB2 123292            LCALL    ?L?COM000B
001CB5 D292              SETB     IO_DUT_I2CM_SDA
  208: 
  209:             /* we have successfully recovered the SDA line to idle state */
  210:             return TRUE;
001CB7 D3                SETB     C
001CB8 22                RET      
  211:         }
  212:     }
  213:     else
  214:     {
  215:         /* unsupported stretching on SCL/SDA line, operation fail */
  216:     }
001CB9         ?C0122?PKT_I2CM:
  217: 
  218:     return FALSE;
001CB9 C3                CLR      C
  219: }
001CBA 22                RET      
----- FUNCTION _pkt_i2cm_CheckReady (END) -------


----- FUNCTION _DRV_C2M_FlashWrite (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  650: BOOL DRV_C2M_FlashWrite
  651: (
001CBB 1234DD            LCALL    ?L?COM0042
001CBE 7005              JNZ      ?C0962?DRV_C2M
001CC0 7E01              MOV      R6,#01H
001CC2 FF                MOV      R7,A
001CC3 8004              SJMP     ?C0963?DRV_C2M
001CC5         ?C0962?DRV_C2M:
001CC5 AF3F              MOV      R7,vCount
001CC7 7E00              MOV      R6,#00H
001CC9         ?C0963?DRV_C2M:
001CC9 8E40              MOV      vLen,R6
001CCB 8F41              MOV      vLen+01H,R7
  652:     IN       UINT16           vAddr,
  653:     IN const UINT8 SEG_XDATA *pBuf,
  654:     IN       UINT8            vCount
  655: )
  656: {
  657:     UINT16  vLen = ((vCount==0)?256:vCount);
  658:     BOOL    bDone = FALSE;
001CCD C238              CLR      bDone
  659: 
  660:     if (!drv_c2m_IsReady())
001CCF 309777            JNB      IO_DUT_C2M_SCL,_exit?DRV_C2M
001CD2 30A074            JNB      IO_DUT_C2M_SDA,_exit?DRV_C2M
  661:     {
  662:         /* C2 bus is not ready */
  663:         goto _exit;
  664:     }
001CD5         ?C0964?DRV_C2M:
  665: 
  666:     c2m_WriteAR(vFPDAT);
001CD5 AF18              MOV      R7,vFPDAT
001CD7 F10B              ACALL    _c2m_WriteAR
  667:     drv_c2m_WriteData(C2_FPDAT_BLOCK_WRITE);
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 26


001CD9 7F07              MOV      R7,#07H
001CDB 123319            LCALL    ?L?COM0015
001CDE         ?C0973?DRV_C2M:
001CDE B1DC              ACALL    c2m_ReadAR
001CE0 EF                MOV      A,R7
001CE1 20E009            JB       ACC.0,?C0971?DRV_C2M
001CE4 123299            LCALL    ?L?COM000C
001CE7 6004              JZ       ?C0971?DRV_C2M
001CE9 9122              ACALL    ?L?COM0006
001CEB 80F1              SJMP     ?C0973?DRV_C2M
001CED         ?C0971?DRV_C2M:
001CED 1233F9            LCALL    ?L?COM002B
001CF0 7057              JNZ      _exit?DRV_C2M
001CF2         ?C0975?DRV_C2M:
001CF2         ?C0968?DRV_C2M:
  668:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  669:     drv_c2m_WriteData(vAddr>>8);    /* MSB of address */
001CF2 E53B              MOV      A,vAddr
001CF4 FF                MOV      R7,A
001CF5 B14C              ACALL    _drv_c2m_WriteData
  670:     drv_c2m_WriteData(vAddr&0xFF);  /* LSB of address */
001CF7 AF3C              MOV      R7,vAddr+01H
001CF9 123314            LCALL    ?L?COM0014
001CFC         ?C0982?DRV_C2M:
001CFC B1DC              ACALL    c2m_ReadAR
001CFE EF                MOV      A,R7
001CFF 20E009            JB       ACC.0,?C0980?DRV_C2M
001D02 123299            LCALL    ?L?COM000C
001D05 6004              JZ       ?C0980?DRV_C2M
001D07 9122              ACALL    ?L?COM0006
001D09 80F1              SJMP     ?C0982?DRV_C2M
001D0B         ?C0980?DRV_C2M:
001D0B 1233F9            LCALL    ?L?COM002B
001D0E 7039              JNZ      _exit?DRV_C2M
001D10         ?C0984?DRV_C2M:
001D10         ?C0985?DRV_C2M:
  671:     drv_c2m_WriteData(vCount);      /* write length   */
  672:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  673:     while (vLen--)
001D10 12347B            LCALL    ?L?COM0039
001D13 7002              JNZ      ?C1018?DRV_C2M
001D15 1540              DEC      vLen
001D17         ?C1018?DRV_C2M:
001D17 4E                ORL      A,R6
001D18 6015              JZ       ?C0992?DRV_C2M
  674:     {
  675:         /* write data into flash */
  676:         drv_c2m_WriteData(*pBuf++);
001D1A 053E              INC      pBuf+01H
001D1C E53E              MOV      A,pBuf+01H
001D1E AE3D              MOV      R6,pBuf
001D20 7002              JNZ      ?C1019?DRV_C2M
001D22 053D              INC      pBuf
001D24         ?C1019?DRV_C2M:
001D24 14                DEC      A
001D25 F582              MOV      DPL,A
001D27 8E83              MOV      DPH,R6
001D29 E0                MOVX     A,@DPTR
001D2A FF                MOV      R7,A
001D2B B14C              ACALL    _drv_c2m_WriteData
  677:     }
001D2D 80E1              SJMP     ?C0985?DRV_C2M
  678:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
001D2F         ?C0992?DRV_C2M:
001D2F 12331C            LCALL    ?L?COM0016
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 27


001D32         ?C0993?DRV_C2M:
001D32 B1DC              ACALL    c2m_ReadAR
001D34 EF                MOV      A,R7
001D35 20E009            JB       ACC.0,?C0991?DRV_C2M
001D38 123299            LCALL    ?L?COM000C
001D3B 6004              JZ       ?C0991?DRV_C2M
001D3D 9122              ACALL    ?L?COM0006
001D3F 80F1              SJMP     ?C0993?DRV_C2M
001D41         ?C0991?DRV_C2M:
001D41 122000            LCALL    c2m_ReadDR
001D44 BF0D02            CJNE     R7,#0DH,_exit?DRV_C2M
001D47         ?C0995?DRV_C2M:
001D47         ?C0988?DRV_C2M:
  679:     bDone = TRUE;
001D47 D238              SETB     bDone
  680: 
  681: _exit:
001D49         _exit:
  682:     return bDone;
001D49 A238              MOV      C,bDone
  683: }
001D4B 22                RET      
----- FUNCTION _DRV_C2M_FlashWrite (END) -------


----- FUNCTION _drv_c2m_WriteData (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  368: static void drv_c2m_WriteData(UINT8 vCmd)
  369: {
;---- Variable 'vCmd' assigned to Register 'R7' ----
  370:     c2m_WriteDR(vCmd);
  371:     drv_c2m_PollInBusy(C2_TIMEOUT_VAL);
001D4C 123000            LCALL    _c2m_WriteDR
  372: }
001D4F 754627            MOV      _timeout,#027H
001D52 754710            MOV      _timeout+01H,#010H
001D55         ?C0788?DRV_C2M:
001D55 B1DC              ACALL    c2m_ReadAR
001D57 EF                MOV      A,R7
001D58 30E111            JNB      ACC.1,?C0790?DRV_C2M
001D5B E547              MOV      A,_timeout+01H
001D5D 1547              DEC      _timeout+01H
001D5F AE46              MOV      R6,_timeout
001D61 7002              JNZ      ?C1015?DRV_C2M
001D63 1546              DEC      _timeout
001D65         ?C1015?DRV_C2M:
001D65 4E                ORL      A,R6
001D66 6004              JZ       ?C0790?DRV_C2M
001D68 9122              ACALL    ?L?COM0006
001D6A 80E9              SJMP     ?C0788?DRV_C2M
  373: 
001D6C         ?C0790?DRV_C2M:
001D6C 22                RET      
----- FUNCTION _drv_c2m_WriteData (END) -------


----- FUNCTION _DRV_C2M_PageErase (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  557: BOOL DRV_C2M_PageErase(UINT8 vPageNo)
  558: {
001D6D 8F33              MOV      vPageNo,R7
  559:     BOOL    bDone = FALSE;
  560: 
001D6F C238              CLR      bDone
  561:     if (!drv_c2m_IsReady())
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 28


001D71 309765            JNB      IO_DUT_C2M_SCL,_exit?DRV_C2M
001D74 30A062            JNB      IO_DUT_C2M_SDA,_exit?DRV_C2M
  562:     {
  563:         /* C2 bus is not ready */
  564:         goto _exit;
  565:     }
001D77         ?C0905?DRV_C2M:
  566: 
  567:     c2m_WriteAR(vFPDAT);
001D77 AF18              MOV      R7,vFPDAT
001D79 F10B              ACALL    _c2m_WriteAR
  568:     drv_c2m_WriteData(C2_FPDAT_PAGE_ERASE);
001D7B 7F08              MOV      R7,#08H
001D7D 123491            LCALL    ?L?COM003C
001D80         ?C0914?DRV_C2M:
001D80 B1DC              ACALL    c2m_ReadAR
001D82 EF                MOV      A,R7
001D83 20E00B            JB       ACC.0,?C0912?DRV_C2M
001D86 7834              MOV      R0,#LOW _timeout
001D88 12329B            LCALL    ?L?COM000D
001D8B 6004              JZ       ?C0912?DRV_C2M
001D8D 9122              ACALL    ?L?COM0006
001D8F 80EF              SJMP     ?C0914?DRV_C2M
001D91         ?C0912?DRV_C2M:
001D91 1233F9            LCALL    ?L?COM002B
001D94 7043              JNZ      _exit?DRV_C2M
001D96         ?C0916?DRV_C2M:
001D96         ?C0909?DRV_C2M:
  569:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  570:     drv_c2m_WriteData(vPageNo); /* send page number */
001D96 AF33              MOV      R7,vPageNo
001D98 123491            LCALL    ?L?COM003C
001D9B         ?C0923?DRV_C2M:
001D9B B1DC              ACALL    c2m_ReadAR
001D9D EF                MOV      A,R7
001D9E 20E00B            JB       ACC.0,?C0921?DRV_C2M
001DA1 7834              MOV      R0,#LOW _timeout
001DA3 12329B            LCALL    ?L?COM000D
001DA6 6004              JZ       ?C0921?DRV_C2M
001DA8 9122              ACALL    ?L?COM0006
001DAA 80EF              SJMP     ?C0923?DRV_C2M
001DAC         ?C0921?DRV_C2M:
001DAC 1233F9            LCALL    ?L?COM002B
001DAF 7028              JNZ      _exit?DRV_C2M
001DB1         ?C0925?DRV_C2M:
001DB1         ?C0918?DRV_C2M:
  571:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  572:     drv_c2m_WriteData(0x00);    /* initiate erase   */
001DB1 E4                CLR      A
001DB2 FF                MOV      R7,A
001DB3 B14C              ACALL    _drv_c2m_WriteData
  573:     drv_c2m_CheckResponse(C2_PAGE_ERASE_TIMEOUT_VAL);
001DB5 E4                CLR      A
001DB6 753740            MOV      _timeout+03H,#040H
001DB9 75369C            MOV      _timeout+02H,#09CH
001DBC F535              MOV      _timeout+01H,A
001DBE F534              MOV      _timeout,A
001DC0         ?C0932?DRV_C2M:
001DC0 B1DC              ACALL    c2m_ReadAR
001DC2 EF                MOV      A,R7
001DC3 20E00B            JB       ACC.0,?C0930?DRV_C2M
001DC6 7834              MOV      R0,#LOW _timeout
001DC8 12329B            LCALL    ?L?COM000D
001DCB 6004              JZ       ?C0930?DRV_C2M
001DCD 9122              ACALL    ?L?COM0006
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 29


001DCF 80EF              SJMP     ?C0932?DRV_C2M
001DD1         ?C0930?DRV_C2M:
001DD1 122000            LCALL    c2m_ReadDR
001DD4 BF0D02            CJNE     R7,#0DH,_exit?DRV_C2M
001DD7         ?C0934?DRV_C2M:
001DD7         ?C0927?DRV_C2M:
  574:     bDone = TRUE;
001DD7 D238              SETB     bDone
  575: 
  576: _exit:
001DD9         _exit:
  577:     return bDone;
001DD9 A238              MOV      C,bDone
  578: }
001DDB 22                RET      
----- FUNCTION _DRV_C2M_PageErase (END) -------


----- FUNCTION c2m_ReadAR (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  215: static UINT8 c2m_ReadAR(void)
  216: {
  217:     BOOL    bIntState;
  218: 
  219:     c2m_SetIns(0x2);    /* instruction: read address */
001DDC C243              CLR      bIns0
001DDE D244              SETB     bIns1
  220: 
  221:     /* lock globally interrupt */
  222:     bIntState = DRV_INT_LockGlobalInterrupt();
001DE0 30AF05            JNB      EA,?C0190?DRV_C2M
001DE3 C2AF              CLR      EA
001DE5 D3                SETB     C
001DE6 8001              SJMP     ?C0191?DRV_C2M
001DE8         ?C0190?DRV_C2M:
001DE8 C3                CLR      C
001DE9         ?C0191?DRV_C2M:
001DE9 1231D5            LCALL    ?L?COM0017
001DEC 00                NOP      
001DED 00                NOP      
001DEE 00                NOP      
001DEF 00                NOP      
001DF0 123251            LCALL    ?L?COM0026
001DF3 00                NOP      
001DF4 00                NOP      
001DF5 00                NOP      
001DF6 00                NOP      
001DF7 1231E4            LCALL    ?L?COM0033
001DFA 00                NOP      
001DFB 00                NOP      
001DFC 00                NOP      
001DFD 00                NOP      
001DFE 123247            LCALL    ?L?COM003A
001E01 00                NOP      
001E02 D297              SETB     IO_DUT_C2M_SCL
001E04 00                NOP      
001E05 00                NOP      
  223: 
  224:     c2m_TxStart();      /* tx frame start */
  225:     c2m_TxIns();        /* tx instruction */
  226:     c2m_TxTurnAround(); /* tx turn-around */
  227:     c2m_RxByte();       /* rx address */
001E06 00                NOP      
001E07 00                NOP      
001E08 C297              CLR      IO_DUT_C2M_SCL
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 30


001E0A 00                NOP      
001E0B 00                NOP      
001E0C A2A0              MOV      C,IO_DUT_C2M_SDA
001E0E D297              SETB     IO_DUT_C2M_SCL
001E10 9230              MOV      bC2Bit0,C
001E12 00                NOP      
001E13 00                NOP      
001E14 C297              CLR      IO_DUT_C2M_SCL
001E16 00                NOP      
001E17 00                NOP      
001E18 A2A0              MOV      C,IO_DUT_C2M_SDA
001E1A D297              SETB     IO_DUT_C2M_SCL
001E1C 9231              MOV      bC2Bit1,C
001E1E 00                NOP      
001E1F 00                NOP      
001E20 C297              CLR      IO_DUT_C2M_SCL
001E22 00                NOP      
001E23 00                NOP      
001E24 A2A0              MOV      C,IO_DUT_C2M_SDA
001E26 D297              SETB     IO_DUT_C2M_SCL
001E28 9232              MOV      bC2Bit2,C
001E2A 00                NOP      
001E2B 00                NOP      
001E2C C297              CLR      IO_DUT_C2M_SCL
001E2E 00                NOP      
001E2F 00                NOP      
001E30 A2A0              MOV      C,IO_DUT_C2M_SDA
001E32 D297              SETB     IO_DUT_C2M_SCL
001E34 9233              MOV      bC2Bit3,C
001E36 00                NOP      
001E37 00                NOP      
001E38 C297              CLR      IO_DUT_C2M_SCL
001E3A 00                NOP      
001E3B 00                NOP      
001E3C A2A0              MOV      C,IO_DUT_C2M_SDA
001E3E D297              SETB     IO_DUT_C2M_SCL
001E40 9234              MOV      bC2Bit4,C
001E42 00                NOP      
001E43 00                NOP      
001E44 C297              CLR      IO_DUT_C2M_SCL
001E46 00                NOP      
001E47 00                NOP      
001E48 A2A0              MOV      C,IO_DUT_C2M_SDA
001E4A D297              SETB     IO_DUT_C2M_SCL
001E4C 9235              MOV      bC2Bit5,C
001E4E 00                NOP      
001E4F 00                NOP      
001E50 C297              CLR      IO_DUT_C2M_SCL
001E52 00                NOP      
001E53 00                NOP      
001E54 A2A0              MOV      C,IO_DUT_C2M_SDA
001E56 D297              SETB     IO_DUT_C2M_SCL
001E58 9236              MOV      bC2Bit6,C
001E5A 00                NOP      
001E5B 00                NOP      
001E5C C297              CLR      IO_DUT_C2M_SCL
001E5E 00                NOP      
001E5F 00                NOP      
001E60 12325D            LCALL    ?L?COM0023
  228:     c2m_RxStop();       /* rx frame stop */
  229: 
  230:     /* unlock globally interrupt */
  231:     DRV_INT_UnlockGlobalInterrupt(bIntState);
  232: 
  233:     return c2m_GetAddr();
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 31


001E63 AF26              MOV      R7,vC2Data
  234: }
001E65 22                RET      
----- FUNCTION c2m_ReadAR (END) -------


----- FUNCTION DRV_C2M_Probe (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  454: UINT32 DRV_C2M_Probe(void)
  455: {
  456:     UU32    vDevice;
  457: 
  458:     vDevice.U32 = 0xFFFFFFFFUL;
001E66 74FF              MOV      A,#0FFH
001E68 F536              MOV      vDevice+03H,A
001E6A F535              MOV      vDevice+02H,A
001E6C F534              MOV      vDevice+01H,A
001E6E F533              MOV      vDevice,A
  459: 
  460:     if (!drv_c2m_IsReady())
001E70 209702            JB       IO_DUT_C2M_SCL,$ + 5H
001E73 E102              AJMP     _exit?DRV_C2M
001E75 20A002            JB       IO_DUT_C2M_SDA,$ + 5H
001E78 E102              AJMP     _exit?DRV_C2M
  461:     {
  462:         /* C2 bus is not ready */
  463:         goto _exit;
  464:     }
  465: 
  466:     drv_c2m_Init();
001E7A         ?C0852?DRV_C2M:
001E7A 123400            LCALL    ?L?COM002C
001E7D 53A57F            ANL      P1MDOUT,#07FH
001E80 7F02              MOV      R7,#02H
001E82 F10B              ACALL    _c2m_WriteAR
001E84 123000            LCALL    _c2m_WriteDR
001E87 7F04              MOV      R7,#04H
001E89 123000            LCALL    _c2m_WriteDR
001E8C 7F01              MOV      R7,#01H
001E8E 123000            LCALL    _c2m_WriteDR
001E91 7F14              MOV      R7,#014H
001E93 7E00              MOV      R6,#00H
001E95 122CA8            LCALL    _DRV_CPU_DelayMs
  467: 
  468:     /* get C2 device id & revision id */
  469:     vDevice.U8[0] = drv_c2m_ReadSFR(C2_DEVICEID);
001E98 E4                CLR      A
001E99 FF                MOV      R7,A
001E9A F1DF              ACALL    _drv_c2m_ReadSFR
001E9C 8F33              MOV      vDevice,R7
  470:     vDevice.U8[1] = drv_c2m_ReadSFR(C2_REVID);
001E9E 7F01              MOV      R7,#01H
001EA0 F1DF              ACALL    _drv_c2m_ReadSFR
001EA2 8F34              MOV      vDevice+01H,R7
  471: 
  472:     if (vDevice.U8[0] == 0xFF)
001EA4 E533              MOV      A,vDevice
001EA6 F4                CPL      A
001EA7 6059              JZ       _exit?DRV_C2M
  473:     {
  474:         /* no device probed */
  475:         goto _exit;
  476:     }
001EA9         ?C0862?DRV_C2M:
  477: 
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 32


  478:     /* get C2 device derivative id */
  479:     vFPDAT = C2_FPDAT;
001EA9 7518B4            MOV      vFPDAT,#0B4H
  480:     c2m_WriteAR(vFPDAT);
001EAC 12357F            LCALL    ?L?COM0061
001EAF B14C              ACALL    _drv_c2m_WriteData
  481:     drv_c2m_WriteData(C2_FPDAT_GET_DERIVATIVE);
  482:     if (drv_c2m_ReadData() != C2_COMMAND_OK)
001EB1 1220BB            LCALL    drv_c2m_ReadData
001EB4 EF                MOV      A,R7
001EB5 640D              XRL      A,#0DH
001EB7 601F              JZ       ?C0863?DRV_C2M
  483:     {
  484:         /* the FPDAT address may be incorrect, try another FPDAT address */
  485:         vFPDAT = C2_FPDAT2;
001EB9 7518AD            MOV      vFPDAT,#0ADH
  486:         c2m_WriteAR(vFPDAT);
001EBC 12357F            LCALL    ?L?COM0061
001EBF 1234A0            LCALL    ?L?COM003D
001EC2         ?C0870?DRV_C2M:
001EC2 B1DC              ACALL    c2m_ReadAR
001EC4 EF                MOV      A,R7
001EC5 20E00B            JB       ACC.0,?C0868?DRV_C2M
001EC8 7837              MOV      R0,#LOW _timeout
001ECA 12329B            LCALL    ?L?COM000D
001ECD 6004              JZ       ?C0868?DRV_C2M
001ECF 9122              ACALL    ?L?COM0006
001ED1 80EF              SJMP     ?C0870?DRV_C2M
001ED3         ?C0868?DRV_C2M:
001ED3 1233F9            LCALL    ?L?COM002B
001ED6 702A              JNZ      _exit?DRV_C2M
001ED8         ?C0872?DRV_C2M:
  487:         drv_c2m_WriteData(C2_FPDAT_GET_DERIVATIVE);
  488:         drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  489:     }
001ED8         ?C0863?DRV_C2M:
  490:     vDevice.U8[2] = drv_c2m_ReadData();
001ED8 1220BB            LCALL    drv_c2m_ReadData
001EDB 8F35              MOV      vDevice+02H,R7
  491: 
  492:     /* get C2 device derivative version */
  493:     c2m_WriteAR(vFPDAT);
001EDD AF18              MOV      R7,vFPDAT
001EDF F10B              ACALL    _c2m_WriteAR
  494:     drv_c2m_WriteData(C2_FPDAT_GET_VERSION);
001EE1 7F01              MOV      R7,#01H
001EE3 1234A0            LCALL    ?L?COM003D
001EE6         ?C0879?DRV_C2M:
001EE6 B1DC              ACALL    c2m_ReadAR
001EE8 EF                MOV      A,R7
001EE9 20E00B            JB       ACC.0,?C0877?DRV_C2M
001EEC 7837              MOV      R0,#LOW _timeout
001EEE 12329B            LCALL    ?L?COM000D
001EF1 6004              JZ       ?C0877?DRV_C2M
001EF3 9122              ACALL    ?L?COM0006
001EF5 80EF              SJMP     ?C0879?DRV_C2M
001EF7         ?C0877?DRV_C2M:
001EF7 122000            LCALL    c2m_ReadDR
001EFA BF0D05            CJNE     R7,#0DH,_exit?DRV_C2M
001EFD         ?C0881?DRV_C2M:
001EFD         ?C0874?DRV_C2M:
  495:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  496:     vDevice.U8[3] = drv_c2m_ReadData();
001EFD 1220BB            LCALL    drv_c2m_ReadData
001F00 8F36              MOV      vDevice+03H,R7
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 33


  497: 
  498: _exit:
001F02         _exit:
  499:     return vDevice.U32;
001F02 AF36              MOV      R7,vDevice+03H
001F04 AE35              MOV      R6,vDevice+02H
001F06 AD34              MOV      R5,vDevice+01H
001F08 AC33              MOV      R4,vDevice
  500: }
001F0A 22                RET      
----- FUNCTION DRV_C2M_Probe (END) -------


----- FUNCTION _c2m_WriteAR (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  195: static void c2m_WriteAR(UINT8 vAddr)
  196: {
;---- Variable 'vAddr' assigned to Register 'R7' ----
  197:     BOOL    bIntState;
  198: 
  199:     c2m_SetIns(0x3);    /* instruction: write address */
001F0B D243              SETB     bIns0
001F0D D244              SETB     bIns1
  200:     c2m_SetAddr(vAddr);
001F0F 8F26              MOV      vC2Data,R7
  201: 
  202:     /* lock globally interrupt */
  203:     bIntState = DRV_INT_LockGlobalInterrupt();
001F11 30AF05            JNB      EA,?C0007?DRV_C2M
001F14 C2AF              CLR      EA
001F16 D3                SETB     C
001F17 8001              SJMP     ?C0008?DRV_C2M
001F19         ?C0007?DRV_C2M:
001F19 C3                CLR      C
001F1A         ?C0008?DRV_C2M:
001F1A 1231D5            LCALL    ?L?COM0017
001F1D 00                NOP      
001F1E 00                NOP      
001F1F 00                NOP      
001F20 00                NOP      
001F21 123251            LCALL    ?L?COM0026
001F24 00                NOP      
001F25 00                NOP      
001F26 00                NOP      
001F27 00                NOP      
001F28 1231E4            LCALL    ?L?COM0033
001F2B 00                NOP      
001F2C 00                NOP      
001F2D 00                NOP      
001F2E 00                NOP      
001F2F 12323E            LCALL    ?L?COM005A
001F32 00                NOP      
001F33 00                NOP      
001F34 00                NOP      
001F35 00                NOP      
001F36 123235            LCALL    ?L?COM0059
001F39 00                NOP      
001F3A 00                NOP      
001F3B 00                NOP      
001F3C 00                NOP      
001F3D 12322C            LCALL    ?L?COM0058
001F40 00                NOP      
001F41 00                NOP      
001F42 00                NOP      
001F43 00                NOP      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 34


001F44 123223            LCALL    ?L?COM0057
001F47 00                NOP      
001F48 00                NOP      
001F49 00                NOP      
001F4A 00                NOP      
001F4B 12321A            LCALL    ?L?COM0056
001F4E 00                NOP      
001F4F 00                NOP      
001F50 00                NOP      
001F51 00                NOP      
001F52 123211            LCALL    ?L?COM0055
001F55 00                NOP      
001F56 00                NOP      
001F57 00                NOP      
001F58 00                NOP      
001F59 123208            LCALL    ?L?COM0054
001F5C 00                NOP      
001F5D 00                NOP      
001F5E 00                NOP      
001F5F 00                NOP      
001F60 1231FF            LCALL    ?L?COM0053
001F63 00                NOP      
001F64 00                NOP      
001F65 00                NOP      
001F66 00                NOP      
001F67 D297              SETB     IO_DUT_C2M_SCL
  204: 
  205:     c2m_TxStart();      /* tx frame start */
  206:     c2m_TxIns();        /* tx instruction */
  207:     c2m_TxByte();       /* tx address */
  208:     c2m_TxStop();       /* tx frame stop */
001F69 D2A0              SETB     IO_DUT_C2M_SDA
001F6B 53A6FE            ANL      P2MDOUT,#0FEH
001F6E 1231DD            LCALL    ?L?COM0018
001F71 00                NOP      
001F72 00                NOP      
001F73 00                NOP      
001F74 00                NOP      
001F75 D297              SETB     IO_DUT_C2M_SCL
001F77 023266            LJMP     ?L?COM0025
  209: 
  210:     /* unlock globally interrupt */
  211:     DRV_INT_UnlockGlobalInterrupt(bIntState);
----- FUNCTION _c2m_WriteAR (END) -------


----- FUNCTION DRV_C2M_ChipErase (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  518: BOOL DRV_C2M_ChipErase(void)
  519: {
  520:     BOOL    bDone = FALSE;
  521: 
001F7A C238              CLR      bDone
  522:     if (!drv_c2m_IsReady())
001F7C 30975D            JNB      IO_DUT_C2M_SCL,_exit?DRV_C2M
001F7F 30A05A            JNB      IO_DUT_C2M_SDA,_exit?DRV_C2M
  523:     {
  524:         /* C2 bus is not ready */
  525:         goto _exit;
  526:     }
001F82         ?C0883?DRV_C2M:
  527: 
  528:     c2m_WriteAR(vFPDAT);
001F82 AF18              MOV      R7,vFPDAT
001F84 F10B              ACALL    _c2m_WriteAR
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 35


  529:     drv_c2m_WriteData(C2_FPDAT_DEVICE_ERASE);
001F86 7F03              MOV      R7,#03H
001F88 B14C              ACALL    _drv_c2m_WriteData
  530:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
001F8A E4                CLR      A
001F8B 753610            MOV      _timeout+03H,#010H
001F8E 753527            MOV      _timeout+02H,#027H
001F91 F534              MOV      _timeout+01H,A
001F93 F533              MOV      _timeout,A
001F95         ?C0892?DRV_C2M:
001F95 B1DC              ACALL    c2m_ReadAR
001F97 EF                MOV      A,R7
001F98 20E00B            JB       ACC.0,?C0890?DRV_C2M
001F9B 7833              MOV      R0,#LOW _timeout
001F9D 12329B            LCALL    ?L?COM000D
001FA0 6004              JZ       ?C0890?DRV_C2M
001FA2 9122              ACALL    ?L?COM0006
001FA4 80EF              SJMP     ?C0892?DRV_C2M
001FA6         ?C0890?DRV_C2M:
001FA6 1233F9            LCALL    ?L?COM002B
001FA9 7031              JNZ      _exit?DRV_C2M
001FAB         ?C0894?DRV_C2M:
001FAB         ?C0887?DRV_C2M:
  531:     drv_c2m_WriteData(0xDE);     /* send sequence #1 */
001FAB 7FDE              MOV      R7,#0DEH
001FAD B14C              ACALL    _drv_c2m_WriteData
  532:     drv_c2m_WriteData(0xAD);     /* send sequence #2 */
001FAF 7FAD              MOV      R7,#0ADH
001FB1 B14C              ACALL    _drv_c2m_WriteData
  533:     drv_c2m_WriteData(0xA5);     /* send sequence #3 */
001FB3 7FA5              MOV      R7,#0A5H
001FB5 B14C              ACALL    _drv_c2m_WriteData
  534:     drv_c2m_CheckResponse(C2_CHIP_ERASE_TIMEOUT_VAL);
001FB7 753600            MOV      _timeout+03H,#00H
001FBA 75352D            MOV      _timeout+02H,#02DH
001FBD 753431            MOV      _timeout+01H,#031H
001FC0 753301            MOV      _timeout,#01H
001FC3         ?C0901?DRV_C2M:
001FC3 B1DC              ACALL    c2m_ReadAR
001FC5 EF                MOV      A,R7
001FC6 20E00B            JB       ACC.0,?C0899?DRV_C2M
001FC9 7833              MOV      R0,#LOW _timeout
001FCB 12329B            LCALL    ?L?COM000D
001FCE 6004              JZ       ?C0899?DRV_C2M
001FD0 9122              ACALL    ?L?COM0006
001FD2 80EF              SJMP     ?C0901?DRV_C2M
001FD4         ?C0899?DRV_C2M:
001FD4 122000            LCALL    c2m_ReadDR
001FD7 BF0D02            CJNE     R7,#0DH,_exit?DRV_C2M
001FDA         ?C0903?DRV_C2M:
001FDA         ?C0896?DRV_C2M:
  535:     bDone = TRUE;
001FDA D238              SETB     bDone
  536: 
  537: _exit:
001FDC         _exit:
  538:     return bDone;
001FDC A238              MOV      C,bDone
  539: }
001FDE 22                RET      
----- FUNCTION DRV_C2M_ChipErase (END) -------


----- FUNCTION _drv_c2m_ReadSFR (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 36


  362: static UINT8 drv_c2m_ReadSFR(UINT8 vAddr)
  363: {
;---- Variable 'vAddr' assigned to Register 'R7' ----
  364:     c2m_WriteAR(vAddr);
  365:     return c2m_ReadDR();
001FDF F10B              ACALL    _c2m_WriteAR
  366: }
001FE1 801D              SJMP     c2m_ReadDR
----- FUNCTION _drv_c2m_ReadSFR (END) -------


----- FUNCTION ?L?COM0050 (BEGIN) -----
001FE3 FF                MOV      R7,A
001FE4 E4                CLR      A
001FE5 3438              ADDC     A,#038H
001FE7 FE                MOV      R6,A
----- FUNCTION _CFG_ROM_GET32 (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   88:     return MEMPAGE_PID_INVALID;
   89: }
;---- Variable 'vAddr' assigned to Register 'DPTR' ----
001FE8 8F82              MOV      DPL,R7
001FEA 8E83              MOV      DPH,R6
001FEC 020655            LJMP     ?C?LLDCODE
----- FUNCTION _CFG_ROM_GET32 (END) -------


----- FUNCTION _CFG_RAM_SET16 (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   86:     }
   87: 
;---- Variable 'vData' assigned to Register 'R4/R5' ----
;---- Variable 'vAddr' assigned to Register 'R6/R7' ----
001FEF A807              MOV      R0,AR7
001FF1 EC                MOV      A,R4
001FF2 F2                MOVX     @R0,A
001FF3 08                INC      R0
001FF4 ED                MOV      A,R5
001FF5 F2                MOVX     @R0,A
001FF6 22                RET      
----- FUNCTION _CFG_RAM_SET16 (END) -------


----- FUNCTION PKT_MDIOM_Inspect (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
   38: UINT16 PKT_MDIOM_Inspect(void)
   39: {
   40:     PKT_SetPayloadSize(0x00);
   41:     return PKT_REPLY_Done_ExecNoError;
001FF7 12342A            LCALL    ?L?COM002F
   42: }
001FFA 7E01              MOV      R6,#01H
001FFC 7F40              MOV      R7,#040H
   43: 
001FFE 22                RET      
----- FUNCTION PKT_MDIOM_Inspect (END) -------


----- FUNCTION c2m_ReadDR (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  261: static UINT8 c2m_ReadDR(void)
  262: {
  263:     BOOL    bIntState;
  264: 
  265:     c2m_SetIns(0x0);    /* instruction: read data */
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 37


002000 C243              CLR      bIns0
002002 C244              CLR      bIns1
  266:     c2m_SetLength(0x1); /* length: 1 byte */
002004 C245              CLR      bLength0
002006 C246              CLR      bLength1
  267: 
  268:     /* lock globally interrupt */
  269:     bIntState = DRV_INT_LockGlobalInterrupt();
002008 30AF05            JNB      EA,?C0584?DRV_C2M
00200B C2AF              CLR      EA
00200D D3                SETB     C
00200E 8001              SJMP     ?C0585?DRV_C2M
002010         ?C0584?DRV_C2M:
002010 C3                CLR      C
002011         ?C0585?DRV_C2M:
002011 1231D5            LCALL    ?L?COM0017
002014 00                NOP      
002015 00                NOP      
002016 00                NOP      
002017 00                NOP      
002018 123251            LCALL    ?L?COM0026
00201B 00                NOP      
00201C 00                NOP      
00201D 00                NOP      
00201E 00                NOP      
00201F 1231E4            LCALL    ?L?COM0033
002022 00                NOP      
002023 00                NOP      
002024 00                NOP      
002025 00                NOP      
002026 1231F6            LCALL    ?L?COM0052
002029 00                NOP      
00202A 00                NOP      
00202B 00                NOP      
00202C 00                NOP      
00202D 1231ED            LCALL    ?L?COM0051
002030 00                NOP      
002031 00                NOP      
002032 00                NOP      
002033 00                NOP      
002034 123247            LCALL    ?L?COM003A
002037 00                NOP      
002038 D297              SETB     IO_DUT_C2M_SCL
00203A 00                NOP      
00203B 00                NOP      
  270: 
  271:     c2m_TxStart();      /* tx frame start */
  272:     c2m_TxIns();        /* tx instruction */
  273:     c2m_TxLength();     /* tx length */
  274:     c2m_TxTurnAround(); /* tx turn-around */
  275:     c2m_Wait();         /* wait for target device ready */
00203C 754A27            MOV      _timeout,#027H
00203F 754B10            MOV      _timeout+01H,#010H
002042         ?C0687?DRV_C2M:
002042 00                NOP      
002043 00                NOP      
002044 C297              CLR      IO_DUT_C2M_SCL
002046 00                NOP      
002047 00                NOP      
002048 121C1C            LCALL    ?L?COM0005
00204B 20300D            JB       bC2Bit0,?C0700?DRV_C2M
00204E E54B              MOV      A,_timeout+01H
002050 154B              DEC      _timeout+01H
002052 AE4A              MOV      R6,_timeout
002054 7002              JNZ      ?C1014?DRV_C2M
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 38


002056 154A              DEC      _timeout
002058         ?C1014?DRV_C2M:
002058 4E                ORL      A,R6
002059 70E7              JNZ      ?C0687?DRV_C2M
  276:     c2m_RxByte();       /* rx data */
00205B         ?C0700?DRV_C2M:
00205B 00                NOP      
00205C 00                NOP      
00205D C297              CLR      IO_DUT_C2M_SCL
00205F 00                NOP      
002060 00                NOP      
002061 A2A0              MOV      C,IO_DUT_C2M_SDA
002063 D297              SETB     IO_DUT_C2M_SCL
002065 9230              MOV      bC2Bit0,C
002067 00                NOP      
002068 00                NOP      
002069 C297              CLR      IO_DUT_C2M_SCL
00206B 00                NOP      
00206C 00                NOP      
00206D A2A0              MOV      C,IO_DUT_C2M_SDA
00206F D297              SETB     IO_DUT_C2M_SCL
002071 9231              MOV      bC2Bit1,C
002073 00                NOP      
002074 00                NOP      
002075 C297              CLR      IO_DUT_C2M_SCL
002077 00                NOP      
002078 00                NOP      
002079 A2A0              MOV      C,IO_DUT_C2M_SDA
00207B D297              SETB     IO_DUT_C2M_SCL
00207D 9232              MOV      bC2Bit2,C
00207F 00                NOP      
002080 00                NOP      
002081 C297              CLR      IO_DUT_C2M_SCL
002083 00                NOP      
002084 00                NOP      
002085 A2A0              MOV      C,IO_DUT_C2M_SDA
002087 D297              SETB     IO_DUT_C2M_SCL
002089 9233              MOV      bC2Bit3,C
00208B 00                NOP      
00208C 00                NOP      
00208D C297              CLR      IO_DUT_C2M_SCL
00208F 00                NOP      
002090 00                NOP      
002091 A2A0              MOV      C,IO_DUT_C2M_SDA
002093 D297              SETB     IO_DUT_C2M_SCL
002095 9234              MOV      bC2Bit4,C
002097 00                NOP      
002098 00                NOP      
002099 C297              CLR      IO_DUT_C2M_SCL
00209B 00                NOP      
00209C 00                NOP      
00209D A2A0              MOV      C,IO_DUT_C2M_SDA
00209F D297              SETB     IO_DUT_C2M_SCL
0020A1 9235              MOV      bC2Bit5,C
0020A3 00                NOP      
0020A4 00                NOP      
0020A5 C297              CLR      IO_DUT_C2M_SCL
0020A7 00                NOP      
0020A8 00                NOP      
0020A9 A2A0              MOV      C,IO_DUT_C2M_SDA
0020AB D297              SETB     IO_DUT_C2M_SCL
0020AD 9236              MOV      bC2Bit6,C
0020AF 00                NOP      
0020B0 00                NOP      
0020B1 C297              CLR      IO_DUT_C2M_SCL
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 39


0020B3 00                NOP      
0020B4 00                NOP      
0020B5 12325D            LCALL    ?L?COM0023
  277:     c2m_RxStop();       /* rx frame stop */
  278: 
  279:     /* unlock globally interrupt */
  280:     DRV_INT_UnlockGlobalInterrupt(bIntState);
  281: 
  282:     return c2m_GetData();
0020B8 AF26              MOV      R7,vC2Data
  283: }
0020BA 22                RET      
----- FUNCTION c2m_ReadDR (END) -------


----- FUNCTION drv_c2m_ReadData (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  374: static UINT8 drv_c2m_ReadData(void)
  375: {
  376:     drv_c2m_PollOutBusy(C2_TIMEOUT_VAL);
  377:     return c2m_ReadDR();
0020BB E4                CLR      A
0020BC 754910            MOV      _timeout+03H,#010H
0020BF 754827            MOV      _timeout+02H,#027H
0020C2 F547              MOV      _timeout+01H,A
0020C4 F546              MOV      _timeout,A
0020C6         ?C0794?DRV_C2M:
0020C6 121DDC            LCALL    c2m_ReadAR
0020C9 EF                MOV      A,R7
0020CA 20E00C            JB       ACC.0,?C0792?DRV_C2M
0020CD 7846              MOV      R0,#LOW _timeout
0020CF 12329B            LCALL    ?L?COM000D
0020D2 6005              JZ       ?C0792?DRV_C2M
0020D4 121C22            LCALL    ?L?COM0006
0020D7 80ED              SJMP     ?C0794?DRV_C2M
0020D9         ?C0792?DRV_C2M:
  378: }
0020D9 0100              AJMP     c2m_ReadDR
----- FUNCTION drv_c2m_ReadData (END) -------


----- FUNCTION _DRV_C2M_FlashRead (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  598: BOOL DRV_C2M_FlashRead
  599: (
0020DB 1234DD            LCALL    ?L?COM0042
0020DE 7005              JNZ      ?C0936?DRV_C2M
0020E0 7E01              MOV      R6,#01H
0020E2 FF                MOV      R7,A
0020E3 8004              SJMP     ?C0937?DRV_C2M
0020E5         ?C0936?DRV_C2M:
0020E5 AF3F              MOV      R7,vCount
0020E7 7E00              MOV      R6,#00H
0020E9         ?C0937?DRV_C2M:
0020E9 8E40              MOV      vLen,R6
0020EB 8F41              MOV      vLen+01H,R7
  600:     OUT UINT8 SEG_XDATA *pBuf,
  601:     IN  UINT16           vAddr,
  602:     IN  UINT8            vCount
  603: )
  604: {
  605:     UINT16  vLen = ((vCount==0)?256:vCount);
  606:     BOOL    bDone = FALSE;
0020ED C238              CLR      bDone
  607: 
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 40


  608:     if (!drv_c2m_IsReady())
0020EF 309765            JNB      IO_DUT_C2M_SCL,_exit?DRV_C2M
0020F2 30A062            JNB      IO_DUT_C2M_SDA,_exit?DRV_C2M
  609:     {
  610:         /* C2 bus is not ready */
  611:         goto _exit;
  612:     }
0020F5         ?C0938?DRV_C2M:
  613: 
  614:     c2m_WriteAR(vFPDAT);
0020F5 AF18              MOV      R7,vFPDAT
0020F7 121F0B            LCALL    _c2m_WriteAR
  615:     drv_c2m_WriteData(C2_FPDAT_BLOCK_READ);
0020FA 7F06              MOV      R7,#06H
0020FC 123319            LCALL    ?L?COM0015
0020FF         ?C0947?DRV_C2M:
0020FF 121DDC            LCALL    c2m_ReadAR
002102 EF                MOV      A,R7
002103 20E00A            JB       ACC.0,?C0945?DRV_C2M
002106 123299            LCALL    ?L?COM000C
002109 6005              JZ       ?C0945?DRV_C2M
00210B 121C22            LCALL    ?L?COM0006
00210E 80EF              SJMP     ?C0947?DRV_C2M
002110         ?C0945?DRV_C2M:
002110 1233F9            LCALL    ?L?COM002B
002113 7042              JNZ      _exit?DRV_C2M
002115         ?C0949?DRV_C2M:
002115         ?C0942?DRV_C2M:
  616:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  617:     drv_c2m_WriteData(vAddr>>8);    /* MSB of address */
002115 E53D              MOV      A,vAddr
002117 FF                MOV      R7,A
002118 121D4C            LCALL    _drv_c2m_WriteData
  618:     drv_c2m_WriteData(vAddr&0xFF);  /* LSB of address */
00211B AF3E              MOV      R7,vAddr+01H
00211D 123314            LCALL    ?L?COM0014
002120         ?C0956?DRV_C2M:
002120 121DDC            LCALL    c2m_ReadAR
002123 EF                MOV      A,R7
002124 20E00A            JB       ACC.0,?C0954?DRV_C2M
002127 123299            LCALL    ?L?COM000C
00212A 6005              JZ       ?C0954?DRV_C2M
00212C 121C22            LCALL    ?L?COM0006
00212F 80EF              SJMP     ?C0956?DRV_C2M
002131         ?C0954?DRV_C2M:
002131 1100              ACALL    c2m_ReadDR
002133 BF0D21            CJNE     R7,#0DH,_exit?DRV_C2M
002136         ?C0958?DRV_C2M:
002136         ?C0959?DRV_C2M:
  619:     drv_c2m_WriteData(vCount);      /* read length    */
  620:     drv_c2m_CheckResponse(C2_TIMEOUT_VAL);
  621:     while (vLen--)
002136 12347B            LCALL    ?L?COM0039
002139 7002              JNZ      ?C1016?DRV_C2M
00213B 1540              DEC      vLen
00213D         ?C1016?DRV_C2M:
00213D 4E                ORL      A,R6
00213E 6015              JZ       ?C0960?DRV_C2M
  622:     {
  623:         /* read flash data into buffer */
  624:         *pBuf++ = drv_c2m_ReadData();
002140 11BB              ACALL    drv_c2m_ReadData
002142 053C              INC      pBuf+01H
002144 E53C              MOV      A,pBuf+01H
002146 AC3B              MOV      R4,pBuf
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 41


002148 7002              JNZ      ?C1017?DRV_C2M
00214A 053B              INC      pBuf
00214C         ?C1017?DRV_C2M:
00214C 14                DEC      A
00214D F582              MOV      DPL,A
00214F 8C83              MOV      DPH,R4
002151 EF                MOV      A,R7
002152 F0                MOVX     @DPTR,A
  625:     }
002153 80E1              SJMP     ?C0959?DRV_C2M
002155         ?C0960?DRV_C2M:
  626:     bDone = TRUE;
002155 D238              SETB     bDone
  627: 
  628: _exit:
002157         _exit:
  629:     return bDone;
002157 A238              MOV      C,bDone
  630: }
002159 22                RET      
----- FUNCTION _DRV_C2M_FlashRead (END) -------


----- FUNCTION PKT_C2M_FlashRead (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
   79: UINT16 PKT_C2M_FlashRead(void)
   80: {
   81:     PKT_C2M_RW_T SEG_XDATA *pPayload = (PKT_C2M_RW_T SEG_XDATA *)PKT_GetPayload();
   82:     UINT8 SEG_XDATA *pBuf  = pPayload->aBuf;
;---- Variable 'pPayload' assigned to Register 'R2/R3' ----
00215A 1232E8            LCALL    ?L?COM0010
   83:     UINT16           vAddr = (UINT16)pPayload->vAddr;
   84:     UINT16           vLen  = pPayload->vDataLen;
   85: 
   86:     if ((PKT_GetPayloadSize() != PKT_C2M_RW_HEADER_LEN)
00215D 90004A            MOV      DPTR,#vFrame+0AH
002160 E0                MOVX     A,@DPTR
002161 7004              JNZ      ?C0044?PKT_C2M
002163 A3                INC      DPTR
002164 E0                MOVX     A,@DPTR
002165 6406              XRL      A,#06H
002167         ?C0044?PKT_C2M:
002167 700B              JNZ      ?C0026?PKT_C2M
002169 D3                SETB     C
00216A E538              MOV      A,vLen+01H
00216C 9432              SUBB     A,#032H
00216E E537              MOV      A,vLen
002170 9404              SUBB     A,#04H
002172 4005              JC       ?C0030?PKT_C2M
002174         ?C0026?PKT_C2M:
   87:         || (vLen > sizeof(pPayload->aBuf)))
   88:     {
   89:         return PKT_REPLY_Fail_InvalidLen;
002174 7E03              MOV      R6,#03H
002176 7F04              MOV      R7,#04H
002178 22                RET      
   90:     }
002179         ?C0030?PKT_C2M:
   91: 
   92:     /* split too long read data buffer into pieces to read */
   93:     PKT_SetPayloadSize(PKT_C2M_RW_HEADER_LEN+vLen);
002179 E538              MOV      A,vLen+01H
00217B 2406              ADD      A,#06H
00217D 90004B            MOV      DPTR,#vFrame+0BH
002180 F0                MOVX     @DPTR,A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 42


002181 E4                CLR      A
002182 3537              ADDC     A,vLen
002184 90004A            MOV      DPTR,#vFrame+0AH
002187 F0                MOVX     @DPTR,A
002188         ?C0031?PKT_C2M:
   94:     while (vLen != 0)
002188 E538              MOV      A,vLen+01H
00218A 4537              ORL      A,vLen
00218C 602D              JZ       ?C0032?PKT_C2M
   95:     {
   96:         UINT16 vReadLen = ((vLen<0x100)?vLen:0x100);
00218E C3                CLR      C
00218F E537              MOV      A,vLen
002191 9401              SUBB     A,#01H
002193 5006              JNC      ?C0033?PKT_C2M
002195 AE37              MOV      R6,vLen
002197 AF38              MOV      R7,vLen+01H
002199 8004              SJMP     ?C0034?PKT_C2M
00219B         ?C0033?PKT_C2M:
00219B 7E01              MOV      R6,#01H
00219D 7F00              MOV      R7,#00H
00219F         ?C0034?PKT_C2M:
00219F 8E39              MOV      vReadLen,R6
0021A1 8F3A              MOV      vReadLen+01H,R7
   97: 
   98:       #if DRV_WATCHDOG_SUPPORT
   99:         DRV_WATCHDOG_Kick();
  100:       #endif
  101: 
  102:         if (!DRV_C2M_FlashRead(pBuf, vAddr, (UINT8)vReadLen))
0021A3 AB3A              MOV      R3,vReadLen+01H
0021A5 AD36              MOV      R5,vAddr+01H
0021A7 AC35              MOV      R4,vAddr
0021A9 AF34              MOV      R7,pBuf+01H
0021AB AE33              MOV      R6,pBuf
0021AD 11DB              ACALL    _DRV_C2M_FlashRead
0021AF 4005              JC       ?C0035?PKT_C2M
  103:         {
  104:             return PKT_REPLY_Fail_ExecErrorCode0;
0021B1 7E03              MOV      R6,#03H
0021B3 7F40              MOV      R7,#040H
0021B5 22                RET      
  105:         }
0021B6         ?C0035?PKT_C2M:
  106: 
  107:         pBuf  += vReadLen;
0021B6 123328            LCALL    ?L?COM0019
  108:         vAddr += vReadLen;
  109:         vLen  -= vReadLen;
  110:     }
0021B9 80CD              SJMP     ?C0031?PKT_C2M
0021BB         ?C0032?PKT_C2M:
  111: 
  112:     return PKT_REPLY_Done_ExecNoError;
0021BB 7E01              MOV      R6,#01H
0021BD 7F40              MOV      R7,#040H
  113: }
0021BF 22                RET      
----- FUNCTION PKT_C2M_FlashRead (END) -------


----- FUNCTION _pkt_i2cm_RxByte (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  152: static UINT8 _pkt_i2cm_RxByte(BOOL bSendNAK)
  153: {
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 43


  154:     UINT8   vLoop;
  155:     UINT8   vData = 0;
0021C0 E4                CLR      A
0021C1 F540              MOV      vData,A
  156: 
  157:     for (vLoop = 8; vLoop != 0; vLoop--)
0021C3 753F08            MOV      vLoop,#08H
0021C6         ?C0062?PKT_I2CM:
  158:     {
  159:         PKT_I2CM_SET_SCL(HIGH);
0021C6 123292            LCALL    ?L?COM000B
0021C9 123432            LCALL    ?L?COM0030
0021CC         ?C0075?PKT_I2CM:
0021CC 20820F            JB       IO_DUT_I2CM_SCL,?C0066?PKT_I2CM
0021CF 1234F7            LCALL    ?L?COM0044
0021D2 7002              JNZ      ?C0376?PKT_I2CM
0021D4 1541              DEC      _loop
0021D6         ?C0376?PKT_I2CM:
0021D6 4E                ORL      A,R6
0021D7 6005              JZ       ?C0066?PKT_I2CM
0021D9 121C22            LCALL    ?L?COM0006
0021DC 80EE              SJMP     ?C0075?PKT_I2CM
0021DE         ?C0066?PKT_I2CM:
  160:         vData <<= 1;
0021DE E540              MOV      A,vData
0021E0 25E0              ADD      A,ACC
0021E2 F540              MOV      vData,A
  161:         vData |= PKT_I2CM_GET_SDA();
0021E4 A292              MOV      C,IO_DUT_I2CM_SDA
0021E6 E4                CLR      A
0021E7 33                RLC      A
0021E8 4240              ORL      vData,A
  162:         PKT_I2CM_SET_SCL(LOW);
0021EA 123292            LCALL    ?L?COM000B
0021ED C282              CLR      IO_DUT_I2CM_SCL
0021EF 8000              SJMP     ?C0064?PKT_I2CM
  163:     }
0021F1         ?C0064?PKT_I2CM:
0021F1 D53FD2            DJNZ     vLoop,?C0062?PKT_I2CM
0021F4         ?C0091?PKT_I2CM:
  164: 
  165:     /* send ACK/NAK */
  166:     PKT_I2CM_SET_SDA(bSendNAK);
0021F4 A23A              MOV      C,bSendNAK
0021F6 9292              MOV      IO_DUT_I2CM_SDA,C
  167:     PKT_I2CM_SET_SCL(HIGH);
0021F8 123292            LCALL    ?L?COM000B
0021FB 123432            LCALL    ?L?COM0030
0021FE         ?C0102?PKT_I2CM:
0021FE 20820F            JB       IO_DUT_I2CM_SCL,?C0109?PKT_I2CM
002201 1234F7            LCALL    ?L?COM0044
002204 7002              JNZ      ?C0378?PKT_I2CM
002206 1541              DEC      _loop
002208         ?C0378?PKT_I2CM:
002208 4E                ORL      A,R6
002209 6005              JZ       ?C0109?PKT_I2CM
00220B 121C22            LCALL    ?L?COM0006
00220E 80EE              SJMP     ?C0102?PKT_I2CM
  168:     PKT_I2CM_SET_SCL(LOW);
002210         ?C0109?PKT_I2CM:
002210 123292            LCALL    ?L?COM000B
002213 C282              CLR      IO_DUT_I2CM_SCL
002215 8000              SJMP     ?C0118?PKT_I2CM
002217         ?C0118?PKT_I2CM:
  169:     PKT_I2CM_SET_SDA(HIGH);
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 44


002217 D292              SETB     IO_DUT_I2CM_SDA
  170: 
  171:     return vData;
002219 AF40              MOV      R7,vData
  172: }
00221B 22                RET      
----- FUNCTION _pkt_i2cm_RxByte (END) -------


----- FUNCTION _pkt_i2cm_vs_Stream (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  298: static BOOL pkt_i2cm_vs_Stream(IN OUT PKT_I2CM_STREAM_T SEG_XDATA *pPayload)
  299: {
00221C 123566            LCALL    ?L?COM005E
00221F A3                INC      DPTR
002220 12330C            LCALL    ?L?COM0011
  300:     static UINT8 vRegOffset = 0x00;
  301:     UINT16  vWriteLen = pPayload->vWriteLen;
  302:     UINT16  vReadLen  = pPayload->vReadLen;
002223 123482            LCALL    ?L?COM003B
  303: 
  304:     /* send write stream */
  305:     if (vWriteLen != 0)
002226 E538              MOV      A,vWriteLen+01H
002228 4537              ORL      A,vWriteLen
00222A 6036              JZ       ?C0331?PKT_I2CM
  306:     {
  307:         /* 1st byte is always register offset */
  308:         vRegOffset = pPayload->aBuf[0];
00222C 8F82              MOV      DPL,R7
00222E 8E83              MOV      DPH,R6
002230 E582              MOV      A,DPL
002232 2405              ADD      A,#05H
002234 F582              MOV      DPL,A
002236 E4                CLR      A
002237 3583              ADDC     A,DPH
002239 F583              MOV      DPH,A
00223B E0                MOVX     A,@DPTR
00223C F516              MOV      vRegOffset,A
  309:         if (vWriteLen > 0x100)
00223E D3                SETB     C
00223F E538              MOV      A,vWriteLen+01H
002241 9400              SUBB     A,#00H
002243 E537              MOV      A,vWriteLen
002245 9401              SUBB     A,#01H
002247 4001              JC       ?C0332?PKT_I2CM
  310:         {
  311:             /* write length overflow */
  312:             return FALSE;
002249 22                RET      
  313:         }
00224A         ?C0332?PKT_I2CM:
  314: 
  315:         /* send write buffer */
  316:         CFG_DB_WriteFlush(vRegOffset, (UINT8)(vWriteLen-1), &(pPayload->aBuf[1]));
00224A E538              MOV      A,vWriteLen+01H
00224C 14                DEC      A
00224D FD                MOV      R5,A
00224E E536              MOV      A,pPayload+01H
002250 2406              ADD      A,#06H
002252 FB                MOV      R3,A
002253 E4                CLR      A
002254 3535              ADDC     A,pPayload
002256 FA                MOV      R2,A
002257 AF16              MOV      R7,vRegOffset
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 45


002259 710B              ACALL    _CFG_DB_WriteFlush
  317:         vRegOffset = (UINT8)(vRegOffset+vWriteLen-1);
00225B E516              MOV      A,vRegOffset
00225D 2538              ADD      A,vWriteLen+01H
00225F 14                DEC      A
002260 F516              MOV      vRegOffset,A
  318:     }
002262         ?C0331?PKT_I2CM:
  319: 
  320:     /* send read stream */
  321:     if (vReadLen != 0)
002262 E53A              MOV      A,vReadLen+01H
002264 4539              ORL      A,vReadLen
002266 601B              JZ       ?C0334?PKT_I2CM
  322:     {
  323:         UINT16  vLoop;
  324: 
  325:         /* read data */
  326:         for (vLoop = 0; vLoop < vReadLen; vLoop++)
002268 E4                CLR      A
002269 F53B              MOV      vLoop,A
00226B F53C              MOV      vLoop+01H,A
00226D         ?C0335?PKT_I2CM:
00226D 123587            LCALL    ?L?COM0062
002270 9539              SUBB     A,vReadLen
002272 500F              JNC      ?C0334?PKT_I2CM
  327:         {
  328:             pPayload->aBuf[vWriteLen+vLoop] = CFG_DB_ReadByte(vRegOffset++);
002274 AF16              MOV      R7,vRegOffset
002276 0516              INC      vRegOffset
002278 D10A              ACALL    _CFG_DB_ReadByte
00227A 12334E            LCALL    ?L?COM001A
00227D 7002              JNZ      ?C0393?PKT_I2CM
00227F 053B              INC      vLoop
002281         ?C0393?PKT_I2CM:
002281 80EA              SJMP     ?C0335?PKT_I2CM
  329:         }
  330:     }
002283         ?C0334?PKT_I2CM:
  331: 
  332:     return TRUE;
002283 D3                SETB     C
  333: }
002284 22                RET      
----- FUNCTION _pkt_i2cm_vs_Stream (END) -------


----- FUNCTION PKT_I2CM_Stream (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  347: UINT16 PKT_I2CM_Stream(void)
  348: {
  349:     PKT_I2CM_STREAM_T SEG_XDATA *pPayload =
  350:             (PKT_I2CM_STREAM_T SEG_XDATA *)PKT_GetPayload();
002285 753300            MOV      pPayload,#HIGH vFrame+0CH
002288 75344C            MOV      pPayload+01H,#LOW vFrame+0CH
  351: 
  352:     if ((PKT_GetPayloadSize() != (PKT_I2CM_STREAM_HEADER_LEN+pPayload->vWriteLen))
  353:         || (pPayload->vWriteLen+pPayload->vReadLen > COUNT_OF(pPayload->aBuf)))
00228B 123469            LCALL    ?L?COM0037
00228E E0                MOVX     A,@DPTR
00228F FE                MOV      R6,A
002290 A3                INC      DPTR
002291 E0                MOVX     A,@DPTR
002292 FF                MOV      R7,A
002293 2405              ADD      A,#05H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 46


002295 FD                MOV      R5,A
002296 E4                CLR      A
002297 3E                ADDC     A,R6
002298 FC                MOV      R4,A
002299 90004A            MOV      DPTR,#vFrame+0AH
00229C E0                MOVX     A,@DPTR
00229D B50424            CJNE     A,AR4,?C0361?PKT_I2CM
0022A0 A3                INC      DPTR
0022A1 E0                MOVX     A,@DPTR
0022A2 B5051F            CJNE     A,AR5,?C0361?PKT_I2CM
0022A5 123469            LCALL    ?L?COM0037
0022A8 A3                INC      DPTR
0022A9 A3                INC      DPTR
0022AA E0                MOVX     A,@DPTR
0022AB FC                MOV      R4,A
0022AC A3                INC      DPTR
0022AD E0                MOVX     A,@DPTR
0022AE FD                MOV      R5,A
0022AF EF                MOV      A,R7
0022B0 2D                ADD      A,R5
0022B1 FF                MOV      R7,A
0022B2 EE                MOV      A,R6
0022B3 3C                ADDC     A,R4
0022B4 FE                MOV      R6,A
0022B5 E4                CLR      A
0022B6 FC                MOV      R4,A
0022B7 FD                MOV      R5,A
0022B8 7B33              MOV      R3,#033H
0022BA 7A04              MOV      R2,#04H
0022BC F9                MOV      R1,A
0022BD F8                MOV      R0,A
0022BE C3                CLR      C
0022BF 120607            LCALL    ?C?SLCMP
0022C2 5005              JNC      ?C0360?PKT_I2CM
0022C4         ?C0361?PKT_I2CM:
  354:     {
  355:         return PKT_REPLY_Fail_InvalidLen;
0022C4 7E03              MOV      R6,#03H
0022C6 7F04              MOV      R7,#04H
0022C8 22                RET      
  356:     }
0022C9         ?C0360?PKT_I2CM:
  357: 
  358:   #if PKT_I2CM_VS_SUPPORT
  359:     if ((pPayload->vI2cAddr == PKT_I2CM_VS_ADDR) ?
0022C9 853482            MOV      DPL,pPayload+01H
0022CC 853383            MOV      DPH,pPayload
0022CF E0                MOVX     A,@DPTR
0022D0 AF34              MOV      R7,pPayload+01H
0022D2 AE33              MOV      R6,pPayload
0022D4 B4FE04            CJNE     A,#0FEH,?C0364?PKT_I2CM
0022D7 511C              ACALL    _pkt_i2cm_vs_Stream
0022D9 8003              SJMP     ?C0365?PKT_I2CM
0022DB         ?C0364?PKT_I2CM:
0022DB 121AFB            LCALL    _pkt_i2cm_Stream
0022DE         ?C0365?PKT_I2CM:
0022DE 5026              JNC      ?C0363?PKT_I2CM
  360:         pkt_i2cm_vs_Stream(pPayload) :
  361:         pkt_i2cm_Stream(pPayload))
  362:   #else
  363:     if (pkt_i2cm_Stream(pPayload))
  364:   #endif
  365:     {
  366:         PKT_SetPayloadSize(PKT_I2CM_STREAM_HEADER_LEN
  367:                            + pPayload->vWriteLen
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 47


  368:                            + pPayload->vReadLen);
0022E0 123469            LCALL    ?L?COM0037
0022E3 E0                MOVX     A,@DPTR
0022E4 FE                MOV      R6,A
0022E5 A3                INC      DPTR
0022E6 E0                MOVX     A,@DPTR
0022E7 2405              ADD      A,#05H
0022E9 FF                MOV      R7,A
0022EA E4                CLR      A
0022EB 3E                ADDC     A,R6
0022EC FE                MOV      R6,A
0022ED 123469            LCALL    ?L?COM0037
0022F0 A3                INC      DPTR
0022F1 A3                INC      DPTR
0022F2 E0                MOVX     A,@DPTR
0022F3 FC                MOV      R4,A
0022F4 A3                INC      DPTR
0022F5 E0                MOVX     A,@DPTR
0022F6 2F                ADD      A,R7
0022F7 FF                MOV      R7,A
0022F8 EC                MOV      A,R4
0022F9 3E                ADDC     A,R6
0022FA 90004A            MOV      DPTR,#vFrame+0AH
0022FD F0                MOVX     @DPTR,A
0022FE A3                INC      DPTR
0022FF EF                MOV      A,R7
002300 F0                MOVX     @DPTR,A
  369:         return PKT_REPLY_Done_ExecNoError;
002301 7E01              MOV      R6,#01H
002303 7F40              MOV      R7,#040H
002305 22                RET      
  370:     }
002306         ?C0363?PKT_I2CM:
  371:     else
  372:     {
  373:         return PKT_REPLY_Fail_I2cNoAck;
002306 7E03              MOV      R6,#03H
002308 7F40              MOV      R7,#040H
  374:     }
  375: }
00230A 22                RET      
----- FUNCTION PKT_I2CM_Stream (END) -------


----- FUNCTION _CFG_DB_WriteFlush (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
  178: void CFG_DB_WriteFlush
  179: (
00230B 8F3D              MOV      vOffset,R7
00230D 8D3E              MOV      vCount,R5
00230F 8A3F              MOV      pBuf,R2
002311 8B40              MOV      pBuf+01H,R3
  180:     IN       UINT8            vOffset,
  181:     IN       UINT8            vCount,
  182:     IN const UINT8 SEG_XDATA *pBuf
  183: )
  184: {
  185:     SINT8   vPID = cfg_db_GetPID(vOffset);
002313 D1BF              ACALL    _cfg_db_GetPID
002315 8F41              MOV      vPID,R7
  186:     UINT8   vPageSize;
  187: 
  188:     if ((vPID == MEMPAGE_PID_INVALID) || (vCount == 0))
002317 E541              MOV      A,vPID
002319 F4                CPL      A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 48


00231A 7002              JNZ      $ + 4H
00231C 811D              AJMP     ?C0044?CFG_DB
00231E E53E              MOV      A,vCount
002320 7002              JNZ      $ + 4H
002322 811D              AJMP     ?C0044?CFG_DB
  189:     {
  190:         /* invalid page, or zero flush length */
  191:         return;
  192:     }
002324         ?C0042?CFG_DB:
  193: 
  194:     /* limit Rx FIFO length to page boundary */
  195:     vPageSize = (MEMPAGE_IsRAM(vPID)? CFG_RAM_PAGE_SIZE : CFG_ROM_PAGE_SIZE);
002324 123538            LCALL    ?L?COM004D
002327 4009              JC       ?C0045?CFG_DB
002329 12351A            LCALL    ?L?COM004A
00232C 5004              JNC      ?C0045?CFG_DB
00232E 7F20              MOV      R7,#020H
002330 8002              SJMP     ?C0046?CFG_DB
002332         ?C0045?CFG_DB:
002332 7F80              MOV      R7,#080H
002334         ?C0046?CFG_DB:
;---- Variable 'vPageSize' assigned to Register 'R7' ----
  196:     vOffset  &= (vPageSize - 1);
002334 EF                MOV      A,R7
002335 14                DEC      A
002336 523D              ANL      vOffset,A
  197:     if (vOffset+vCount > vPageSize)
002338 E53E              MOV      A,vCount
00233A FD                MOV      R5,A
00233B E53D              MOV      A,vOffset
00233D 2D                ADD      A,R5
00233E FD                MOV      R5,A
00233F E4                CLR      A
002340 33                RLC      A
002341 FC                MOV      R4,A
002342 EF                MOV      A,R7
002343 FB                MOV      R3,A
002344 D3                SETB     C
002345 ED                MOV      A,R5
002346 9B                SUBB     A,R3
002347 7480              MOV      A,#080H
002349 F8                MOV      R0,A
00234A 6C                XRL      A,R4
00234B 98                SUBB     A,R0
00234C 4008              JC       ?C0047?CFG_DB
  198:     {
  199:         vCount = (vOffset+vCount) - vPageSize;
00234E E53D              MOV      A,vOffset
002350 253E              ADD      A,vCount
002352 C3                CLR      C
002353 9F                SUBB     A,R7
002354 F53E              MOV      vCount,A
  200:     }
002356         ?C0047?CFG_DB:
  201: 
  202:     if (vPID == MEMPAGE_PID_DIRECT_FE_60)
002356 E541              MOV      A,vPID
002358 6401              XRL      A,#01H
00235A 7027              JNZ      ?C0048?CFG_DB
  203:     {
  204:         /* FE.60-7F page */
  205: 
  206:         UINT8   vLoop;
  207:         for (vLoop=0; vLoop<vCount; vLoop++,vOffset++)
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 49


00235C F542              MOV      vLoop,A
00235E         ?C0049?CFG_DB:
00235E E542              MOV      A,vLoop
002360 C3                CLR      C
002361 953E              SUBB     A,vCount
002363 501C              JNC      ?C0050?CFG_DB
  208:         {
  209:             UINT8   vData = pBuf[vLoop];
002365 1234EA            LCALL    ?L?COM0043
002368 F543              MOV      vData,A
  210: 
  211:             switch (vOffset)
00236A E53D              MOV      A,vOffset
00236C 24E5              ADD      A,#0E5H
00236E 24FB              ADD      A,#0FBH
002370 5004              JNC      ?C0065?CFG_DB
002372 2408              ADD      A,#08H
002374 7005              JNZ      ?C0051?CFG_DB
  212:             {
  213:                 case CFG(RT_EVB_CTRL):
  214:                     /* EVB/DUT related */
  215:                 case CFG(Vendor_PWD_Entry)+0:
  216:                 case CFG(Vendor_PWD_Entry)+1:
  217:                 case CFG(Vendor_PWD_Entry)+2:
  218:                 case CFG(Vendor_PWD_Entry)+3:
  219:                 case CFG(Vendor_Page_Select):
  220:                     CFG_SETV8(MEMPAGE_PID_DIRECT_FE_60, vOffset, vData);
002376         ?C0065?CFG_DB:
002376 A83D              MOV      R0,vOffset
002378 E543              MOV      A,vData
00237A F2                MOVX     @R0,A
  221:                     break;
  222: 
  223:                 default:    /* read-only field */
  224:                     /* do nothing */
  225:                     break;
  226:             }
  227:         }
00237B         ?C0051?CFG_DB:
00237B 0542              INC      vLoop
00237D 053D              INC      vOffset
00237F 80DD              SJMP     ?C0049?CFG_DB
002381         ?C0050?CFG_DB:
  228: 
  229:         /* refresh password level */
  230:         CFG_PWD_RefreshLevel();
002381 A183              AJMP     CFG_PWD_RefreshLevel
  231:     }
002383         ?C0048?CFG_DB:
  232:     else    /* other pages */
  233:     {
  234:         if (vPID == MEMPAGE_PID_DIRECT_FE_00)
002383 E541              MOV      A,vPID
002385 B4061B            CJNE     A,#06H,?C0071?CFG_DB
  235:         {
  236:             if (vOffset+vCount > MEMMAP_REAL_OFFSET(DDM_EVB_TEMP))
002388 E53D              MOV      A,vOffset
00238A 253E              ADD      A,vCount
00238C FF                MOV      R7,A
00238D E4                CLR      A
00238E 33                RLC      A
00238F FE                MOV      R6,A
002390 D3                SETB     C
002391 EF                MOV      A,R7
002392 9460              SUBB     A,#060H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 50


002394 EE                MOV      A,R6
002395 6480              XRL      A,#080H
002397 9480              SUBB     A,#080H
002399 4008              JC       ?C0071?CFG_DB
  237:             {
  238:                 /* cross-write from FE.00-5F to FE.60-7F field,
  239:                  * only accept FE.00-5F field data.
  240:                  */
  241:                 vCount = (vOffset+vCount) - MEMMAP_REAL_OFFSET(DDM_EVB_TEMP);
00239B E53D              MOV      A,vOffset
00239D 253E              ADD      A,vCount
00239F 24A0              ADD      A,#0A0H
0023A1 F53E              MOV      vCount,A
  242:             }
  243:         }
0023A3         ?C0071?CFG_DB:
  244: 
  245:         /* check password level, to make sure it's writable */
  246:         if (CFG_PWD_GetLevel() >= aPagePwdWriteTable[vPID])
0023A3 AF41              MOV      R7,vPID
0023A5 EF                MOV      A,R7
0023A6 33                RLC      A
0023A7 95E0              SUBB     A,ACC
0023A9 FE                MOV      R6,A
0023AA 7435              MOV      A,#LOW aPagePwdWriteTable
0023AC 2F                ADD      A,R7
0023AD F582              MOV      DPL,A
0023AF 7416              MOV      A,#HIGH aPagePwdWriteTable
0023B1 3E                ADDC     A,R6
0023B2 123554            LCALL    ?L?COM005C
0023B5 9F                SUBB     A,R7
0023B6 4065              JC       ?C0044?CFG_DB
  247:         {
  248:             if (MEMPAGE_IsRAM(vPID))
0023B8 123539            LCALL    ?L?COM004E
0023BB 4031              JC       ?C0074?CFG_DB
0023BD 12351A            LCALL    ?L?COM004A
0023C0 502C              JNC      ?C0074?CFG_DB
  249:             {
  250:                 /* RAM page */
  251: 
  252:                 UINT8   vLoop;
  253:                 for (vLoop=0; vLoop<vCount; vLoop++)
0023C2 E4                CLR      A
0023C3 F542              MOV      vLoop,A
0023C5         ?C0075?CFG_DB:
0023C5 E542              MOV      A,vLoop
0023C7 C3                CLR      C
0023C8 953E              SUBB     A,vCount
0023CA 5051              JNC      ?C0044?CFG_DB
  254:                 {
  255:                     CFG_SETV8(vPID, vOffset+vLoop, pBuf[vLoop]);
0023CC 123538            LCALL    ?L?COM004D
0023CF 4019              JC       ?C0081?CFG_DB
0023D1 12351A            LCALL    ?L?COM004A
0023D4 5014              JNC      ?C0081?CFG_DB
0023D6 1234EA            LCALL    ?L?COM0043
0023D9 FF                MOV      R7,A
0023DA E53D              MOV      A,vOffset
0023DC 2542              ADD      A,vLoop
0023DE FE                MOV      R6,A
0023DF E541              MOV      A,vPID
0023E1 14                DEC      A
0023E2 C4                SWAP     A
0023E3 33                RLC      A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 51


0023E4 54E0              ANL      A,#0E0H
0023E6 2E                ADD      A,R6
0023E7 F8                MOV      R0,A
0023E8 EF                MOV      A,R7
0023E9 F2                MOVX     @R0,A
0023EA         ?C0081?CFG_DB:
0023EA         ?C0086?CFG_DB:
  256:                 }
0023EA         ?C0077?CFG_DB:
0023EA 0542              INC      vLoop
0023EC 80D7              SJMP     ?C0075?CFG_DB
  257:             }
0023EE         ?C0074?CFG_DB:
  258:             else if (MEMPAGE_IsROM(vPID))
0023EE C3                CLR      C
0023EF E541              MOV      A,vPID
0023F1 6480              XRL      A,#080H
0023F3 9483              SUBB     A,#083H
0023F5 4026              JC       ?C0044?CFG_DB
0023F7 D3                SETB     C
0023F8 E541              MOV      A,vPID
0023FA 6480              XRL      A,#080H
0023FC 9486              SUBB     A,#086H
0023FE 501D              JNC      ?C0044?CFG_DB
  259:             {
  260:                 /* ROM page */
  261:                 EEPROM_MEMCPY(MEMPAGE_ROM_LMA(vPID)+vOffset, pBuf, vCount);
002400 AF41              MOV      R7,vPID
002402 12354B            LCALL    ?L?COM005B
002405         ?C0092?CFG_DB:
002405 C3                CLR      C
002406 33                RLC      A
002407 CE                XCH      A,R6
002408 33                RLC      A
002409 CE                XCH      A,R6
00240A D8F9              DJNZ     R0,?C0092?CFG_DB
00240C 12352D            LCALL    ?L?COM004C
00240F 253D              ADD      A,vOffset
002411 FF                MOV      R7,A
002412 EC                MOV      A,R4
002413 3E                ADDC     A,R6
002414 FE                MOV      R6,A
002415 AB3E              MOV      R3,vCount
002417 AD40              MOV      R5,pBuf+01H
002419 AC3F              MOV      R4,pBuf
00241B 911E              ACALL    _DRV_FLASH_Update
  262:             }
  263:             else
  264:             {
  265:                 /* VIRTUAL page */
  266:                 /* do nothing */
  267:             }
  268:         }
  269:     }
  270: }
00241D         ?C0044?CFG_DB:
00241D 22                RET      
----- FUNCTION _CFG_DB_WriteFlush (END) -------


----- FUNCTION _DRV_FLASH_Update (BEGIN) -----
 FILE: '..\drv\drv_flash.c'
  189: void DRV_FLASH_Update
  190: (
00241E 8E44              MOV      vDstAddr,R6
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 52


002420 8F45              MOV      vDstAddr+01H,R7
002422 8C46              MOV      pSrcAddr,R4
002424 8D47              MOV      pSrcAddr+01H,R5
;---- Variable 'vLen' assigned to Register 'R1' ----
002426 A903              MOV      R1,AR3
  191:     IN       UINT16           vDstAddr,
  192:     IN const UINT8 SEG_XDATA *pSrcAddr,
  193:     IN       UINT8            vLen
  194: )
  195: {
  196:     BOOL   bIntStatus;
  197:     UINT16 vPageBase;
  198:     UINT16 vPageOffset;
  199:     BOOL   bErase;
  200:     UINT8  vLoop;
  201: 
  202:     /* globally lock interrupt */
  203:     bIntStatus = DRV_INT_LockGlobalInterrupt();
002428 30AF05            JNB      EA,?C0012?DRV_FLASH
00242B C2AF              CLR      EA
00242D D3                SETB     C
00242E 8001              SJMP     ?C0013?DRV_FLASH
002430         ?C0012?DRV_FLASH:
002430 C3                CLR      C
002431         ?C0013?DRV_FLASH:
002431 9238              MOV      bIntStatus,C
  204: 
  205:     /* calculate flash page base address & offset of this page */
  206:     vPageBase   = vDstAddr & FLASH_PAGE_MASK;
002433 E544              MOV      A,vDstAddr
002435 54FE              ANL      A,#0FEH
002437 F548              MOV      vPageBase,A
002439 754900            MOV      vPageBase+01H,#00H
  207:     vPageOffset = vDstAddr & ~FLASH_PAGE_MASK;
00243C E544              MOV      A,vDstAddr
00243E 5401              ANL      A,#01H
002440 F54A              MOV      vPageOffset,A
002442 85454B            MOV      vPageOffset+01H,vDstAddr+01H
  208: 
  209:     /* check whether need to erase flash page */
  210:     bErase = FALSE;
002445 C239              CLR      bErase
  211:     for (vLoop = 0; vLoop < vLen; vLoop++)
;---- Variable 'vLoop' assigned to Register 'R7' ----
002447 E4                CLR      A
002448 FF                MOV      R7,A
002449         ?C0014?DRV_FLASH:
002449 EF                MOV      A,R7
00244A C3                CLR      C
00244B 99                SUBB     A,R1
00244C 5033              JNC      ?C0015?DRV_FLASH
  212:     {
  213:         UINT8   vDstData = CODE_U8(vPageBase+vPageOffset+vLoop);
00244E E549              MOV      A,vPageBase+01H
002450 254B              ADD      A,vPageOffset+01H
002452 FD                MOV      R5,A
002453 E548              MOV      A,vPageBase
002455 354A              ADDC     A,vPageOffset
002457 FC                MOV      R4,A
002458 EF                MOV      A,R7
002459 7A00              MOV      R2,#00H
00245B 2D                ADD      A,R5
00245C FD                MOV      R5,A
00245D EA                MOV      A,R2
00245E 3C                ADDC     A,R4
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 53


00245F 8D82              MOV      DPL,R5
002461 F583              MOV      DPH,A
002463 E4                CLR      A
002464 93                MOVC     A,@A+DPTR
002465 F54C              MOV      vDstData,A
  214:         UINT8   vSrcData = pSrcAddr[vLoop];
002467 E547              MOV      A,pSrcAddr+01H
002469 2F                ADD      A,R7
00246A F582              MOV      DPL,A
00246C E4                CLR      A
00246D 3546              ADDC     A,pSrcAddr
00246F F583              MOV      DPH,A
002471 E0                MOVX     A,@DPTR
002472 F54D              MOV      vSrcData,A
  215: 
  216:         if ((vDstData&vSrcData) != vSrcData)
002474 554C              ANL      A,vDstData
002476 654D              XRL      A,vSrcData
002478 6004              JZ       ?C0016?DRV_FLASH
  217:         {
  218:             bErase = TRUE;
00247A D239              SETB     bErase
  219:             break;
00247C 8003              SJMP     ?C0015?DRV_FLASH
  220:         }
  221:     }
00247E         ?C0016?DRV_FLASH:
00247E 0F                INC      R7
00247F 80C8              SJMP     ?C0014?DRV_FLASH
002481         ?C0015?DRV_FLASH:
  222: 
  223:     if (!bErase)
002481 20390B            JB       bErase,?C0018?DRV_FLASH
  224:     {
  225:         /* no need to erase,
  226:           * just write the new data into flash is OK.
  227:           */
  228:         drv_flash_WriteBytes(vDstAddr, (UINT16)pSrcAddr, vLen, FALSE);
002484 1234AF            LCALL    ?L?COM003E
002487 AF45              MOV      R7,vDstAddr+01H
002489 AE44              MOV      R6,vDstAddr
00248B B106              ACALL    _drv_flash_WriteBytes
  229:     }
00248D 806E              SJMP     ?C0022?DRV_FLASH
00248F         ?C0018?DRV_FLASH:
  230:     else
  231:     {
  232:         UINT16 vCacheAddr;
  233: 
  234:         /* prepare cache page content, to be the final flash page content:
  235:          *  1) copy other content into cache page;
  236:          *  2) update cache page with new data;
  237:          */
  238:         vCacheAddr  = FLASH_CACHE_PAGE;
00248F 754C3A            MOV      vCacheAddr,#03AH
002492 754D00            MOV      vCacheAddr+01H,#00H
  239:         drv_flash_WriteBytes(vCacheAddr, vPageBase, vPageOffset, TRUE);
002495 D23A              SETB     ?_drv_flash_WriteBytes?BIT
002497 AB4B              MOV      R3,vPageOffset+01H
002499 AA4A              MOV      R2,vPageOffset
00249B AD49              MOV      R5,vPageBase+01H
00249D AC48              MOV      R4,vPageBase
00249F B102              ACALL    ?L?COM0049
  240:         vCacheAddr += vPageOffset;
0024A1 E54B              MOV      A,vPageOffset+01H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 54


0024A3 254D              ADD      A,vCacheAddr+01H
0024A5 F54D              MOV      vCacheAddr+01H,A
0024A7 E54A              MOV      A,vPageOffset
0024A9 354C              ADDC     A,vCacheAddr
0024AB F54C              MOV      vCacheAddr,A
  241:         drv_flash_WriteBytes(vCacheAddr, (UINT16)pSrcAddr, vLen, FALSE);
0024AD 1234AF            LCALL    ?L?COM003E
0024B0 B102              ACALL    ?L?COM0049
  242:         vCacheAddr += vLen;
0024B2 E9                MOV      A,R1
0024B3 FF                MOV      R7,A
0024B4 7E00              MOV      R6,#00H
0024B6 254D              ADD      A,vCacheAddr+01H
0024B8 F54D              MOV      vCacheAddr+01H,A
0024BA EE                MOV      A,R6
0024BB 354C              ADDC     A,vCacheAddr
0024BD F54C              MOV      vCacheAddr,A
  243:         drv_flash_WriteBytes(vCacheAddr,
  244:                              vDstAddr + vLen,
  245:                              (FLASH_PAGE_SIZE-1) - (vPageOffset+vLen),
  246:                              TRUE);
0024BF E545              MOV      A,vDstAddr+01H
0024C1 2F                ADD      A,R7
0024C2 FD                MOV      R5,A
0024C3 EE                MOV      A,R6
0024C4 3544              ADDC     A,vDstAddr
0024C6 FC                MOV      R4,A
0024C7 E54B              MOV      A,vPageOffset+01H
0024C9 2F                ADD      A,R7
0024CA FF                MOV      R7,A
0024CB EE                MOV      A,R6
0024CC 354A              ADDC     A,vPageOffset
0024CE FE                MOV      R6,A
0024CF C3                CLR      C
0024D0 74FF              MOV      A,#0FFH
0024D2 9F                SUBB     A,R7
0024D3 FB                MOV      R3,A
0024D4 7401              MOV      A,#01H
0024D6 9E                SUBB     A,R6
0024D7 FA                MOV      R2,A
0024D8 D23A              SETB     ?_drv_flash_WriteBytes?BIT
0024DA B102              ACALL    ?L?COM0049
  247: 
  248:         /* erase target flash page */
  249:         drv_flash_ErasePage(vPageBase);
0024DC E4                CLR      A
0024DD FB                MOV      R3,A
0024DE 7D03              MOV      R5,#03H
0024E0 AF49              MOV      R7,vPageBase+01H
0024E2 AE48              MOV      R6,vPageBase
0024E4 B160              ACALL    _drv_flash_Control
  250: 
  251:         /* copy cache page content into target flash page */
  252:         drv_flash_WriteBytes(vPageBase,
  253:                              FLASH_CACHE_PAGE,
  254:                              FLASH_PAGE_SIZE,
  255:                              TRUE);
0024E6 D23A              SETB     ?_drv_flash_WriteBytes?BIT
0024E8 7A02              MOV      R2,#02H
0024EA 7D00              MOV      R5,#00H
0024EC 7C3A              MOV      R4,#03AH
0024EE AF49              MOV      R7,vPageBase+01H
0024F0 AE48              MOV      R6,vPageBase
0024F2 B106              ACALL    _drv_flash_WriteBytes
  256: 
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 55


  257:         /* erase flash cache page */
  258:         drv_flash_ErasePage(FLASH_CACHE_PAGE);
0024F4 E4                CLR      A
0024F5 FB                MOV      R3,A
0024F6 7D03              MOV      R5,#03H
0024F8 FF                MOV      R7,A
0024F9 7E3A              MOV      R6,#03AH
0024FB B160              ACALL    _drv_flash_Control
  259:     }
0024FD         ?C0022?DRV_FLASH:
  260: 
  261:     /* restore interrupt status */
  262:     DRV_INT_UnlockGlobalInterrupt(bIntStatus);
0024FD A238              MOV      C,bIntStatus
0024FF 92AF              MOV      EA,C
  263: }
002501 22                RET      
----- FUNCTION _DRV_FLASH_Update (END) -------


----- FUNCTION ?L?COM0049 (BEGIN) -----
002502 AF4D              MOV      R7,vCacheAddr+01H
002504 AE4C              MOV      R6,vCacheAddr
----- FUNCTION _drv_flash_WriteBytes (BEGIN) -----
 FILE: '..\drv\drv_flash.c'
  151: static void drv_flash_WriteBytes
  152: (
002506 8E4E              MOV      vDstAddr,R6
002508 8F4F              MOV      vDstAddr+01H,R7
00250A 8C50              MOV      vSrcAddr,R4
00250C 8D51              MOV      vSrcAddr+01H,R5
00250E 8A52              MOV      vLen,R2
002510 8B53              MOV      vLen+01H,R3
  153:     IN UINT16     vDstAddr,
  154:     IN UINT16     vSrcAddr,
  155:     IN UINT16     vLen,
  156:     IN BOOL       bSrcFlash
  157: )
  158: {
  159:     for (; vLen-- != 0; vDstAddr++,vSrcAddr++)
002512         ?C0005?DRV_FLASH:
002512 E553              MOV      A,vLen+01H
002514 1553              DEC      vLen+01H
002516 AE52              MOV      R6,vLen
002518 7002              JNZ      ?C0024?DRV_FLASH
00251A 1552              DEC      vLen
00251C         ?C0024?DRV_FLASH:
00251C 4E                ORL      A,R6
00251D 6040              JZ       ?C0011?DRV_FLASH
  160:     {
  161:         UINT8 vData = (bSrcFlash? CODE_U8(vSrcAddr) : XDATA_U8(vSrcAddr));
00251F 303A0B            JNB      bSrcFlash,?C0008?DRV_FLASH
002522 855182            MOV      DPL,vSrcAddr+01H
002525 855083            MOV      DPH,vSrcAddr
002528 E4                CLR      A
002529 93                MOVC     A,@A+DPTR
00252A FF                MOV      R7,A
00252B 8008              SJMP     ?C0009?DRV_FLASH
00252D         ?C0008?DRV_FLASH:
00252D 855182            MOV      DPL,vSrcAddr+01H
002530 855083            MOV      DPH,vSrcAddr
002533 E0                MOVX     A,@DPTR
002534 FF                MOV      R7,A
002535         ?C0009?DRV_FLASH:
002535 8F54              MOV      vData,R7
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 56


  162:         if (CODE_U8(vDstAddr) != vData)
002537 854F82            MOV      DPL,vDstAddr+01H
00253A 854E83            MOV      DPH,vDstAddr
00253D E4                CLR      A
00253E 93                MOVC     A,@A+DPTR
00253F 6554              XRL      A,vData
002541 600A              JZ       ?C0007?DRV_FLASH
  163:         {
  164:             drv_flash_WriteByte(vDstAddr, vData);
002543 AB54              MOV      R3,vData
002545 7D01              MOV      R5,#01H
002547 AF4F              MOV      R7,vDstAddr+01H
002549 AE4E              MOV      R6,vDstAddr
00254B B160              ACALL    _drv_flash_Control
  165:         }
  166:     }
00254D         ?C0007?DRV_FLASH:
00254D 054F              INC      vDstAddr+01H
00254F E54F              MOV      A,vDstAddr+01H
002551 7002              JNZ      ?C0025?DRV_FLASH
002553 054E              INC      vDstAddr
002555         ?C0025?DRV_FLASH:
002555 0551              INC      vSrcAddr+01H
002557 E551              MOV      A,vSrcAddr+01H
002559 7002              JNZ      ?C0026?DRV_FLASH
00255B 0550              INC      vSrcAddr
00255D         ?C0026?DRV_FLASH:
00255D 80B3              SJMP     ?C0005?DRV_FLASH
  167: }
00255F         ?C0011?DRV_FLASH:
00255F 22                RET      
----- FUNCTION _drv_flash_WriteBytes (END) -------


----- FUNCTION _drv_flash_Control (BEGIN) -----
 FILE: '..\drv\drv_flash.c'
   71: static void drv_flash_Control(UINT16 vFlashAddr, UINT8 vPSCTL, UINT8 vData)
   72: {
002560 8E55              MOV      vFlashAddr,R6
002562 8F56              MOV      vFlashAddr+01H,R7
;---- Variable 'vData' assigned to Register 'R3' ----
;---- Variable 'vPSCTL' assigned to Register 'R5' ----
   73:   #if DRV_WATCHDOG_SUPPORT
   74:     /* kick watchdog, to prevent watchdog reset MCU */
   75:     DRV_WATCHDOG_Kick();
   76:   #endif
   77: 
   78:     /* Force Enable VDD Monitor as a reset source */
   79:     DRV_RESET_EnableVDDMonitor();
002564 75FF80            MOV      VDM0CN,#080H
002567 75EF06            MOV      RSTSRC,#06H
   80: 
   81:     /* enable flash erase/write */
   82:     PSCTL = vPSCTL;
00256A 8D8F              MOV      PSCTL,R5
   83: 
   84:     /* write KEYs to unlock flash */
   85:     FLKEY = FLASH_KEY_1;
00256C A2AF              MOV      C,EA
00256E E4                CLR      A
00256F 33                RLC      A
002570 24A5              ADD      A,#0A5H
002572 F5B7              MOV      FLKEY,A
   86:     FLKEY = FLASH_KEY_2;
002574 75B7F1            MOV      FLKEY,#0F1H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 57


   87: 
   88:     /* write data into flash */
   89:     XDATA_U8(vFlashAddr) = vData;
002577 855682            MOV      DPL,vFlashAddr+01H
00257A 855583            MOV      DPH,vFlashAddr
00257D EB                MOV      A,R3
00257E F0                MOVX     @DPTR,A
   90: 
   91:     /* disable flash erase/write */
   92:     PSCTL = 0x00;
00257F E4                CLR      A
002580 F58F              MOV      PSCTL,A
   93: }
002582 22                RET      
----- FUNCTION _drv_flash_Control (END) -------


----- FUNCTION CFG_PWD_RefreshLevel (BEGIN) -----
 FILE: '..\cfg\cfg_pwd.c'
   49: void CFG_PWD_RefreshLevel(void)
   50: {
   51:     UINT32  vPasswd = CFG_GET(Vendor_PWD_Entry);
   52: 
002583 7F1B              MOV      R7,#01BH
002585 7E00              MOV      R6,#00H
002587 F1CE              ACALL    _CFG_RAM_GET32
002589 8F47              MOV      vPasswd+03H,R7
00258B 8E46              MOV      vPasswd+02H,R6
00258D 8D45              MOV      vPasswd+01H,R5
00258F 8C44              MOV      vPasswd,R4
   53:     switch (vPasswd)
002591 1206CA            LCALL    ?C?LCASE
002594 25AE              DW       ?C0009?CFG_PWD
002596 D1E9              DW       0D1E9H
002598 5B93              DW       05B93H
00259A 25B2              DW       ?C0013?CFG_PWD
00259C DA17              DW       0DA17H
00259E B67C              DW       0B67CH
0025A0 25AA              DW       ?C0005?CFG_PWD
0025A2 E37A              DW       0E37AH
0025A4 97A1              DW       097A1H
0025A6 0000              DW       00H
0025A8 25B6              DW       ?C0014?CFG_PWD
   54:     {
   55:         case CFG_PWD_REBOOT:    /* reboot password */
0025AA         ?C0005?CFG_PWD:
   56:             DRV_RESET_SoftwareReset();
0025AA 75EF12            MOV      RSTSRC,#012H
   57:             break;
0025AD 22                RET      
   58: 
   59:         case CFG_PWD_FACTORY:   /* factory password */
0025AE         ?C0009?CFG_PWD:
   60:             PWD_LEVEL_SET(CFG_PWD_LEVEL_FACTORY);
0025AE 751708            MOV      vCfgPwdLevel,#08H
   61:             break;
0025B1 22                RET      
   62: 
   63:         case CFG_PWD_OEM:       /* OEM password */
0025B2         ?C0013?CFG_PWD:
   64:             PWD_LEVEL_SET(CFG_PWD_LEVEL_OEM);
0025B2 751704            MOV      vCfgPwdLevel,#04H
   65:             break;
0025B5 22                RET      
   66: 
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 58


   67:         default:
0025B6         ?C0014?CFG_PWD:
   68:             if (vPasswd == CFG_GET(Vendor_PWD_UserRW))
0025B6 7F7C              MOV      R7,#07CH
0025B8 123458            LCALL    ?L?COM0036
0025BB 7004              JNZ      ?C0015?CFG_PWD
   69:             {
   70:                 /* UserRW password */
   71:                 PWD_LEVEL_SET(CFG_PWD_LEVEL_UserRW);
0025BD 751702            MOV      vCfgPwdLevel,#02H
   72:             }
0025C0 22                RET      
0025C1         ?C0015?CFG_PWD:
   73:             else if (vPasswd == CFG_GET(Vendor_PWD_UserRO))
0025C1 7F78              MOV      R7,#078H
0025C3 123458            LCALL    ?L?COM0036
0025C6 7004              JNZ      ?C0027?CFG_PWD
   74:             {
   75:                 /* UserRO password */
   76:                 PWD_LEVEL_SET(CFG_PWD_LEVEL_UserRO);
0025C8 751701            MOV      vCfgPwdLevel,#01H
   77:             }
0025CB 22                RET      
   78:             else
   79:             {
0025CC         ?C0027?CFG_PWD:
   80:                 PWD_LEVEL_SET(CFG_PWD_LEVEL_NORMAL);
0025CC E4                CLR      A
0025CD F517              MOV      vCfgPwdLevel,A
   81:             }
   82:             break;
   83:     }
   84: }
0025CF 22                RET      
----- FUNCTION CFG_PWD_RefreshLevel (END) -------


----- FUNCTION PKT_I2CM_Inspect (BEGIN) -----
 FILE: '..\pkt\pkt_i2cm.c'
  339: UINT16 PKT_I2CM_Inspect(void)
  340: {
  341:     _pkt_i2cm_Init();
  342: 
0025D0 123292            LCALL    ?L?COM000B
0025D3 D282              SETB     IO_DUT_I2CM_SCL
0025D5 753301            MOV      _loop,#01H
0025D8 7534F4            MOV      _loop+01H,#0F4H
0025DB         ?C0351?PKT_I2CM:
0025DB 208212            JB       IO_DUT_I2CM_SCL,?C0355?PKT_I2CM
0025DE E534              MOV      A,_loop+01H
0025E0 1534              DEC      _loop+01H
0025E2 AE33              MOV      R6,_loop
0025E4 7002              JNZ      ?C0394?PKT_I2CM
0025E6 1533              DEC      _loop
0025E8         ?C0394?PKT_I2CM:
0025E8 4E                ORL      A,R6
0025E9 6005              JZ       ?C0355?PKT_I2CM
0025EB 121C22            LCALL    ?L?COM0006
0025EE 80EB              SJMP     ?C0351?PKT_I2CM
0025F0         ?C0355?PKT_I2CM:
0025F0 D292              SETB     IO_DUT_I2CM_SDA
  343:     PKT_SetPayloadSize(0x00);
0025F2 12342A            LCALL    ?L?COM002F
  344:     return PKT_REPLY_Done_ExecNoError;
0025F5 7E01              MOV      R6,#01H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 59


0025F7 7F40              MOV      R7,#040H
  345: }
0025F9 22                RET      
----- FUNCTION PKT_I2CM_Inspect (END) -------


----- FUNCTION CFG_PWD_Init (BEGIN) -----
 FILE: '..\cfg\cfg_pwd.c'
  101: void CFG_PWD_Init(void)
  102: {
  103:     /* set default password */
  104:     CFG_SET(Vendor_PWD_Entry, CFG_PWD_DEFAULT);
0025FA         ?C0045?CFG_PWD:
0025FA E4                CLR      A
0025FB F531              MOV      ?_CFG_RAM_SET32?BYTE+05H,A
0025FD F530              MOV      ?_CFG_RAM_SET32?BYTE+04H,A
0025FF F52F              MOV      ?_CFG_RAM_SET32?BYTE+03H,A
002601 F52E              MOV      ?_CFG_RAM_SET32?BYTE+02H,A
002603 7F1B              MOV      R7,#01BH
002605 FE                MOV      R6,A
002606 F1DC              ACALL    _CFG_RAM_SET32
002608         ?C0030?CFG_PWD:
  105: 
  106:     /* refresh password level */
  107:     CFG_PWD_RefreshLevel();
002608 A183              AJMP     CFG_PWD_RefreshLevel
----- FUNCTION CFG_PWD_Init (END) -------


----- FUNCTION _CFG_DB_ReadByte (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
  106: UINT8 CFG_DB_ReadByte(IN UINT8 vOffset)
  107: {
;---- Variable 'vOffset' assigned to Register 'R5' ----
00260A AD07              MOV      R5,AR7
  108:     SINT8   vPID = cfg_db_GetPID(vOffset);
  109:     UINT8   vPageSize;
00260C D1BF              ACALL    _cfg_db_GetPID
;---- Variable 'vPID' assigned to Register 'R6' ----
00260E AE07              MOV      R6,AR7
  110: 
  111:     if (vPID == MEMPAGE_PID_INVALID)
002610 BEFF03            CJNE     R6,#0FFH,?C0020?CFG_DB
  112:     {
  113:         /* invalid page */
  114:         return (UINT8)I2CS_INVALID_DATA;
002613 7FAA              MOV      R7,#0AAH
002615 22                RET      
  115:     }
002616         ?C0020?CFG_DB:
  116: 
  117:     vPageSize = (MEMPAGE_IsRAM(vPID)? CFG_RAM_PAGE_SIZE : CFG_ROM_PAGE_SIZE);
002616 C3                CLR      C
002617 EE                MOV      A,R6
002618 6480              XRL      A,#080H
00261A 9481              SUBB     A,#081H
00261C 400C              JC       ?C0022?CFG_DB
00261E D3                SETB     C
00261F EE                MOV      A,R6
002620 6480              XRL      A,#080H
002622 9482              SUBB     A,#082H
002624 5004              JNC      ?C0022?CFG_DB
002626 7F20              MOV      R7,#020H
002628 8002              SJMP     ?C0023?CFG_DB
00262A         ?C0022?CFG_DB:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 60


00262A 7F80              MOV      R7,#080H
00262C         ?C0023?CFG_DB:
;---- Variable 'vPageSize' assigned to Register 'R7' ----
  118:     vOffset  &= (vPageSize - 1);
00262C EF                MOV      A,R7
00262D 14                DEC      A
00262E 5205              ANL      AR5,A
  119: 
  120:     /* check password level, to make sure it's readable */
  121:     if (CFG_PWD_GetLevel() >= aPagePwdReadTable[vPID])
002630 EE                MOV      A,R6
002631 FB                MOV      R3,A
002632 33                RLC      A
002633 95E0              SUBB     A,ACC
002635 FA                MOV      R2,A
002636 742E              MOV      A,#LOW aPagePwdReadTable
002638 2B                ADD      A,R3
002639 F582              MOV      DPL,A
00263B 7416              MOV      A,#HIGH aPagePwdReadTable
00263D 3A                ADDC     A,R2
00263E 123554            LCALL    ?L?COM005C
002641 9F                SUBB     A,R7
002642 4078              JC       ?C0024?CFG_DB
  122:     {
  123:         /* password check pass */
  124:         switch (vPID)
002644 EE                MOV      A,R6
002645 6014              JZ       ?C0033?CFG_DB
002647 14                DEC      A
002648 7027              JNZ      ?C0025?CFG_DB
  125:         {
  126:             case MEMPAGE_PID_DIRECT_FE_60:
00264A         ?C0026?CFG_DB:
  127:                 switch (vOffset)
00264A ED                MOV      A,R5
00264B 24E5              ADD      A,#0E5H
00264D 24FD              ADD      A,#0FDH
00264F 5004              JNC      ?C0030?CFG_DB
002651 6005              JZ       ?C0031?CFG_DB
002653 801C              SJMP     ?C0025?CFG_DB
  128:                 {
  129:                     /* for security reason,
  130:                      *  the password entry is write-only field.
  131:                      */
  132:                     case CFG(Vendor_PWD_Entry)+0:
  133:                     case CFG(Vendor_PWD_Entry)+1:
  134:                     case CFG(Vendor_PWD_Entry)+2: return 0x00;
002655         ?C0030?CFG_DB:
002655 7F00              MOV      R7,#00H
002657 22                RET      
  135:                     case CFG(Vendor_PWD_Entry)+3: return CFG_PWD_GetLevel();
002658         ?C0031?CFG_DB:
002658 AF17              MOV      R7,vCfgPwdLevel
00265A 22                RET      
  136: 
  137:                     default:
  138:                         break;
  139:                 }
  140:                 break;
  141: 
  142:             case MEMPAGE_PID_EXTEND_FE_FF:
00265B         ?C0033?CFG_DB:
  143:                 return (((vOffset >= CFG_HEAD(Vendor_FwVersion))
  144:                             && (vOffset <= CFG_TAIL(Vendor_FwVersion)))?
  145:                         FW_VERSION(vOffset-CFG_HEAD(Vendor_FwVersion)):
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 61


  146:                         (UINT8)I2CS_INVALID_DATA);
00265B ED                MOV      A,R5
00265C C3                CLR      C
00265D 9478              SUBB     A,#078H
00265F 400D              JC       ?C0034?CFG_DB
002661 ED                MOV      A,R5
002662 D3                SETB     C
002663 947F              SUBB     A,#07FH
002665 5007              JNC      ?C0034?CFG_DB
002667 ED                MOV      A,R5
002668 900170            MOV      DPTR,#__sig-070H
00266B 93                MOVC     A,@A+DPTR
00266C FF                MOV      R7,A
00266D 22                RET      
00266E         ?C0034?CFG_DB:
00266E 7FAA              MOV      R7,#0AAH
002670 22                RET      
  147: 
  148:             default:
  149:                 break;
  150:         }
002671         ?C0025?CFG_DB:
  151: 
  152:         return CFG_GETV8(vPID, vOffset);
002671 C3                CLR      C
002672 EE                MOV      A,R6
002673 6480              XRL      A,#080H
002675 9481              SUBB     A,#081H
002677 4014              JC       ?C0037?CFG_DB
002679 D3                SETB     C
00267A EE                MOV      A,R6
00267B 6480              XRL      A,#080H
00267D 9482              SUBB     A,#082H
00267F 500C              JNC      ?C0037?CFG_DB
002681 EE                MOV      A,R6
002682 14                DEC      A
002683 C4                SWAP     A
002684 33                RLC      A
002685 54E0              ANL      A,#0E0H
002687 2D                ADD      A,R5
002688 F8                MOV      R0,A
002689 E2                MOVX     A,@R0
00268A FF                MOV      R7,A
00268B 802E              SJMP     ?C0038?CFG_DB
00268D         ?C0037?CFG_DB:
00268D C3                CLR      C
00268E EE                MOV      A,R6
00268F 6480              XRL      A,#080H
002691 9483              SUBB     A,#083H
002693 4024              JC       ?C0039?CFG_DB
002695 D3                SETB     C
002696 EE                MOV      A,R6
002697 6480              XRL      A,#080H
002699 9486              SUBB     A,#086H
00269B 501C              JNC      ?C0039?CFG_DB
00269D AF06              MOV      R7,AR6
00269F 12354B            LCALL    ?L?COM005B
0026A2         ?C0091?CFG_DB:
0026A2 C3                CLR      C
0026A3 33                RLC      A
0026A4 CE                XCH      A,R6
0026A5 33                RLC      A
0026A6 CE                XCH      A,R6
0026A7 D8F9              DJNZ     R0,?C0091?CFG_DB
0026A9 12352D            LCALL    ?L?COM004C
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 62


0026AC 2D                ADD      A,R5
0026AD FF                MOV      R7,A
0026AE EC                MOV      A,R4
0026AF 3E                ADDC     A,R6
0026B0 8F82              MOV      DPL,R7
0026B2 F583              MOV      DPH,A
0026B4 E4                CLR      A
0026B5 93                MOVC     A,@A+DPTR
0026B6 FF                MOV      R7,A
0026B7 8002              SJMP     ?C0040?CFG_DB
0026B9         ?C0039?CFG_DB:
0026B9 7FAA              MOV      R7,#0AAH
0026BB         ?C0040?CFG_DB:
0026BB         ?C0038?CFG_DB:
0026BB 22                RET      
  153:     }
0026BC         ?C0024?CFG_DB:
  154:     else
  155:     {
  156:         /* password check fail */
  157:         return (UINT8)I2CS_INVALID_DATA;
0026BC 7FAA              MOV      R7,#0AAH
  158:     }
  159: }
0026BE 22                RET      
----- FUNCTION _CFG_DB_ReadByte (END) -------


----- FUNCTION _cfg_db_GetPID (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   53: static SINT8 cfg_db_GetPID(IN UINT8 vOffset)
   54: {
;---- Variable 'vOffset' assigned to Register 'R7' ----
   55:     if (vOffset < MEMMAP_REAL_OFFSET(DDM_EVB_TEMP))
   56:     {
0026BF EF                MOV      A,R7
0026C0 C3                CLR      C
0026C1 9460              SUBB     A,#060H
0026C3 5003              JNC      ?C0007?CFG_DB
   57:         return MEMPAGE_PID_DIRECT_FE_00;
   58:     }
0026C5 7F06              MOV      R7,#06H
0026C7 22                RET      
   59:     else if (vOffset < I2CS_PAGE_SIZE)
0026C8         ?C0007?CFG_DB:
   60:     {
0026C8 EF                MOV      A,R7
0026C9 C3                CLR      C
0026CA 9480              SUBB     A,#080H
0026CC 5003              JNC      ?C0010?CFG_DB
   61:         return MEMPAGE_PID_DIRECT_FE_60;
   62:     }
0026CE 7F01              MOV      R7,#01H
0026D0 22                RET      
   63:     else
0026D1         ?C0010?CFG_DB:
   64:     {
   65:         switch (CFG_GET8(Vendor_Page_Select))
0026D1 781F              MOV      R0,#01FH
0026D3 E2                MOVX     A,@R0
0026D4 2480              ADD      A,#080H
0026D6 6017              JZ       ?C0015?CFG_DB
0026D8 14                DEC      A
0026D9 6017              JZ       ?C0016?CFG_DB
0026DB 14                DEC      A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 63


0026DC 6017              JZ       ?C0017?CFG_DB
0026DE 2483              ADD      A,#083H
0026E0 6016              JZ       ?C0018?CFG_DB
0026E2 243F              ADD      A,#03FH
0026E4 7015              JNZ      ?C0009?CFG_DB
   66:         {
   67:             /* RAM pages */
   68:             case 0xC0:
0026E6         ?C0013?CFG_DB:
   69:                 if (vOffset < I2CS_PAGE_SIZE+CFG_RAM_PAGE_SIZE)
0026E6 EF                MOV      A,R7
0026E7 C3                CLR      C
0026E8 94A0              SUBB     A,#0A0H
0026EA 500F              JNC      ?C0009?CFG_DB
   70:                 {
   71:                     return MEMPAGE_PID_EXTEND_FE_C0;
0026EC 7F02              MOV      R7,#02H
0026EE 22                RET      
   72:                 }
   73:                 break;
   74: 
   75:             /* ROM pages */
   76:             case 0x80: return MEMPAGE_PID_EXTEND_FE_80;
0026EF         ?C0015?CFG_DB:
0026EF 7F03              MOV      R7,#03H
0026F1 22                RET      
   77:             case 0x81: return MEMPAGE_PID_EXTEND_FE_81;
0026F2         ?C0016?CFG_DB:
0026F2 7F04              MOV      R7,#04H
0026F4 22                RET      
   78:             case 0x82: return MEMPAGE_PID_EXTEND_FE_82;
0026F5         ?C0017?CFG_DB:
0026F5 7F05              MOV      R7,#05H
0026F7 22                RET      
   79: 
   80:             /* virtual pages */
   81:             case 0xFF: return MEMPAGE_PID_EXTEND_FE_FF;
0026F8         ?C0018?CFG_DB:
0026F8 7F00              MOV      R7,#00H
0026FA 22                RET      
   82: 
   83:             default:
   84:                 break;
   85:         }
   86:     }
0026FB         ?C0009?CFG_DB:
   87: 
   88:     return MEMPAGE_PID_INVALID;
0026FB 7FFF              MOV      R7,#0FFH
   89: }
0026FD 22                RET      
----- FUNCTION _cfg_db_GetPID (END) -------


----- FUNCTION PKT_MDIOM_Probe (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
   44: UINT16 PKT_MDIOM_Probe(void)
   45: {
   46:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
   47:     UINT16      SEG_XDATA  vData;
;---- Variable 'pPayload' assigned to Register 'DPTR' ----
0026FE 90004C            MOV      DPTR,#vFrame+0CH
   48: 
   49:     if (!DRV_MDIOM_FrameRead(pPayload->vPortAddr,
002701 E0                MOVX     A,@DPTR
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 64


002702 FF                MOV      R7,A
002703 A3                INC      DPTR
002704 E0                MOVX     A,@DPTR
002705 FD                MOV      R5,A
002706 7A04              MOV      R2,#HIGH vData
002708 7BEA              MOV      R3,#LOW vData
00270A F115              ACALL    _DRV_MDIOM_FrameRead
00270C 7E01              MOV      R6,#01H
00270E 4002              JC       ?C0005?PKT_MDIOM
   50:                              pPayload->vDevAddr,
   51:                              &vData))
   52:     {
   53:         return PKT_REPLY_Fail_MdioNoAck;
002710 7E03              MOV      R6,#03H
   54:     }
002712         ?C0005?PKT_MDIOM:
   55: 
   56:     return PKT_REPLY_Done_ExecNoError;
002712 7F40              MOV      R7,#040H
   57: }
002714 22                RET      
----- FUNCTION PKT_MDIOM_Probe (END) -------


----- FUNCTION _DRV_MDIOM_FrameRead (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  451: BOOL DRV_MDIOM_FrameRead
  452: (
;---- Variable 'vPortAddr' assigned to Register 'R7' ----
;---- Variable 'pData' assigned to Register 'DPTR' ----
002715 8B82              MOV      DPL,R3
002717 8A83              MOV      DPH,R2
;---- Variable 'vDevAddr' assigned to Register 'R1' ----
002719 A905              MOV      R1,AR5
  453:     IN  UINT8               vPortAddr,
  454:     IN  UINT8               vDevAddr,
  455:     OUT UINT16 SEG_XDATA   *pData
  456: )
  457: {
  458:     BOOL    bIntState;
  459: 
  460:     /* lock globally interrupt */
  461:     bIntState = DRV_INT_LockGlobalInterrupt();
00271B 30AF05            JNB      EA,?C2425?DRV_MDIOM
00271E C2AF              CLR      EA
002720 D3                SETB     C
002721 8001              SJMP     ?C2426?DRV_MDIOM
002723         ?C2425?DRV_MDIOM:
002723 C3                CLR      C
002724         ?C2426?DRV_MDIOM:
002724 123471            LCALL    ?L?COM0038
002727 4403              ORL      A,#03H
002729 123374            LCALL    ?L?COM001B
00272C 6003              JZ       ?C2439?DRV_MDIOM
  462: 
  463:     /* create frame: READ */
  464:     drv_mdiom_CreateFrame(FRAME_TYPE_READ, vPortAddr, vDevAddr, 0xFFFF);
  465: 
  466:     /* transmit frame: READ */
  467:     drv_mdiom_RxDataFrame();
  468: 
  469:     /* unlock globally interrupt */
  470:     DRV_INT_UnlockGlobalInterrupt(bIntState);
  471: 
  472:     /* check read status */
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 65


  473:     if (pData != NULL)
  474:     {
  475:         *pData = vMdioData;
00272E 123512            LCALL    ?L?COM0048
  476:     }
002731         ?C2439?DRV_MDIOM:
  477:     return drv_mdiom_IsReadSuccess();
002731 A200              MOV      C,bMdioTurnAround0
002733 4003              JC       ?C2440?DRV_MDIOM
002735 D3                SETB     C
002736 8001              SJMP     ?C2441?DRV_MDIOM
002738         ?C2440?DRV_MDIOM:
002738 C3                CLR      C
002739         ?C2441?DRV_MDIOM:
  478: }
002739 22                RET      
----- FUNCTION _DRV_MDIOM_FrameRead (END) -------


----- FUNCTION drv_mdiom_RxDataFrame (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  329: static void drv_mdiom_RxDataFrame(void)
  330: {
  331:     drv_mdiom_StartFrame();
  332:     drv_mdiom_TxPreamble();
00273A 1230B7            LCALL    ?L?COM0001
00273D 123105            LCALL    ?L?COM0002
002740 12315E            LCALL    ?L?COM0003
  333:     drv_mdiom_TxStartFrame();
  334:     drv_mdiom_TxOperationCode();
  335:     drv_mdiom_TxPortAddress();
  336:     drv_mdiom_TxDeviceAddress();
  337:     drv_mdiom_RxTurnAround();
002743 00                NOP      
002744 00                NOP      
002745 D296              SETB     IO_DUT_MDIOM_SCL_OUT
002747 D294              SETB     IO_DUT_MDIOM_SDA_OUT
002749 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00274B D2A1              SETB     IO_DUT_MDIOM_SDA_OEn
00274D D296              SETB     IO_DUT_MDIOM_SCL_OUT
00274F 00                NOP      
002750 00                NOP      
002751 1232E1            LCALL    ?L?COM000F
002754 9200              MOV      bMdioTurnAround0,C
  338:     drv_mdiom_RxData();
002756 1232E1            LCALL    ?L?COM000F
002759 9227              MOV      bMdioData15,C
00275B 1232E1            LCALL    ?L?COM000F
00275E 9226              MOV      bMdioData14,C
002760 1232E1            LCALL    ?L?COM000F
002763 9225              MOV      bMdioData13,C
002765 1232E1            LCALL    ?L?COM000F
002768 9224              MOV      bMdioData12,C
00276A 1232E1            LCALL    ?L?COM000F
00276D 9223              MOV      bMdioData11,C
00276F 1232E1            LCALL    ?L?COM000F
002772 9222              MOV      bMdioData10,C
002774 1232E1            LCALL    ?L?COM000F
002777 9221              MOV      bMdioData9,C
002779 1232E1            LCALL    ?L?COM000F
00277C 9220              MOV      bMdioData8,C
00277E 1232E1            LCALL    ?L?COM000F
002781 922F              MOV      bMdioData7,C
002783 1232E1            LCALL    ?L?COM000F
002786 922E              MOV      bMdioData6,C
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 66


002788 1232E1            LCALL    ?L?COM000F
00278B 922D              MOV      bMdioData5,C
00278D 1232E1            LCALL    ?L?COM000F
002790 922C              MOV      bMdioData4,C
002792 1232E1            LCALL    ?L?COM000F
002795 922B              MOV      bMdioData3,C
002797 1232E1            LCALL    ?L?COM000F
00279A 922A              MOV      bMdioData2,C
00279C 1232E1            LCALL    ?L?COM000F
00279F 9229              MOV      bMdioData1,C
0027A1 1232E1            LCALL    ?L?COM000F
0027A4 9228              MOV      bMdioData0,C
  339:     drv_mdiom_StopFrame();
0027A6 023442            LJMP     ?L?COM0032
  340: }
----- FUNCTION drv_mdiom_RxDataFrame (END) -------


----- FUNCTION _DRV_MDIOM_FramePRIA (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  498: BOOL DRV_MDIOM_FramePRIA
  499: (
;---- Variable 'vPortAddr' assigned to Register 'R7' ----
;---- Variable 'pData' assigned to Register 'DPTR' ----
0027A9 8B82              MOV      DPL,R3
0027AB 8A83              MOV      DPH,R2
;---- Variable 'vDevAddr' assigned to Register 'R1' ----
0027AD A905              MOV      R1,AR5
  500:     IN  UINT8               vPortAddr,
  501:     IN  UINT8               vDevAddr,
  502:     OUT UINT16 SEG_XDATA   *pData
  503: )
  504: {
  505:     BOOL    bIntState;
  506: 
  507:     /* lock globally interrupt */
  508:     bIntState = DRV_INT_LockGlobalInterrupt();
0027AF 30AF05            JNB      EA,?C2443?DRV_MDIOM
0027B2 C2AF              CLR      EA
0027B4 D3                SETB     C
0027B5 8001              SJMP     ?C2444?DRV_MDIOM
0027B7         ?C2443?DRV_MDIOM:
0027B7 C3                CLR      C
0027B8         ?C2444?DRV_MDIOM:
0027B8 123471            LCALL    ?L?COM0038
0027BB 4402              ORL      A,#02H
0027BD 123374            LCALL    ?L?COM001B
0027C0 6003              JZ       ?C2457?DRV_MDIOM
  509: 
  510:     /* create frame: PRIA */
  511:     drv_mdiom_CreateFrame(FRAME_TYPE_PRIA, vPortAddr, vDevAddr, 0xFFFF);
  512: 
  513:     /* transmit frame: PRIA */
  514:     drv_mdiom_RxDataFrame();
  515: 
  516:     /* unlock globally interrupt */
  517:     DRV_INT_UnlockGlobalInterrupt(bIntState);
  518: 
  519:     /* check read status */
  520:     if (pData != NULL)
  521:     {
  522:         *pData = vMdioData;
0027C2 123512            LCALL    ?L?COM0048
  523:     }
0027C5         ?C2457?DRV_MDIOM:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 67


  524:     return drv_mdiom_IsReadSuccess();
0027C5 A200              MOV      C,bMdioTurnAround0
0027C7 4003              JC       ?C2458?DRV_MDIOM
0027C9 D3                SETB     C
0027CA 8001              SJMP     ?C2459?DRV_MDIOM
0027CC         ?C2458?DRV_MDIOM:
0027CC C3                CLR      C
0027CD         ?C2459?DRV_MDIOM:
  525: }
0027CD 22                RET      
----- FUNCTION _DRV_MDIOM_FramePRIA (END) -------


----- FUNCTION _CFG_RAM_GET32 (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   87: 
   88:     return MEMPAGE_PID_INVALID;
;---- Variable 'vAddr' assigned to Register 'R6/R7' ----
0027CE A807              MOV      R0,AR7
0027D0 E2                MOVX     A,@R0
0027D1 FC                MOV      R4,A
0027D2 08                INC      R0
0027D3 E2                MOVX     A,@R0
0027D4 FD                MOV      R5,A
0027D5 08                INC      R0
0027D6 E2                MOVX     A,@R0
0027D7 FE                MOV      R6,A
0027D8 08                INC      R0
0027D9 E2                MOVX     A,@R0
0027DA FF                MOV      R7,A
0027DB 22                RET      
----- FUNCTION _CFG_RAM_GET32 (END) -------


----- FUNCTION _CFG_RAM_SET32 (BEGIN) -----
 FILE: '..\cfg\cfg_db.c'
   89: }
   90: 
;---- Variable 'vAddr' assigned to Register 'R2/R3' ----
0027DC AB07              MOV      R3,AR7
0027DE AF31              MOV      R7,vData+03H
0027E0 AE30              MOV      R6,vData+02H
0027E2 AD2F              MOV      R5,vData+01H
0027E4 AC2E              MOV      R4,vData
0027E6 A803              MOV      R0,AR3
0027E8 020691            LJMP     ?C?LSTPDATA
----- FUNCTION _CFG_RAM_SET32 (END) -------


----- FUNCTION PKT_MDIOM_FrameRead (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
  119: UINT16 PKT_MDIOM_FrameRead(void)
  120: {
  121:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
  122: 
;---- Variable 'pPayload' assigned to Register 'R2/R3' ----
0027EB 123396            LCALL    ?L?COM001C
0027EE 12356F            LCALL    ?L?COM005F
0027F1 F115              ACALL    _DRV_MDIOM_FrameRead
0027F3 7E01              MOV      R6,#01H
0027F5 4002              JC       ?C0015?PKT_MDIOM
  123:     if (!DRV_MDIOM_FrameRead(pPayload->vPortAddr,
  124:                              pPayload->vDevAddr,
  125:                              pPayload->aData))
  126:     {
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 68


  127:         return PKT_REPLY_Fail_MdioNoAck;
0027F7 7E03              MOV      R6,#03H
  128:     }
0027F9         ?C0015?PKT_MDIOM:
  129: 
  130:     return PKT_REPLY_Done_ExecNoError;
0027F9 7F40              MOV      R7,#040H
  131: }
0027FB 22                RET      
----- FUNCTION PKT_MDIOM_FrameRead (END) -------


----- FUNCTION PKT_MDIOM_Read (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
   59: UINT16 PKT_MDIOM_Read(void)
   60: {
   61:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
   62: 
002800 1232A5            LCALL    ?L?COM000E
002803 110E              ACALL    _DRV_MDIOM_Read
002805 7E01              MOV      R6,#01H
002807 4002              JC       ?C0007?PKT_MDIOM
   63:     if (!DRV_MDIOM_Read(pPayload->vPortAddr,
   64:                         pPayload->vDevAddr,
   65:                         pPayload->vOffset,
   66:                         pPayload->vDataCount,
   67:                         pPayload->aData))
   68:     {
   69:         return PKT_REPLY_Fail_MdioNoAck;
002809 7E03              MOV      R6,#03H
   70:     }
00280B         ?C0007?PKT_MDIOM:
   71: 
   72:     return PKT_REPLY_Done_ExecNoError;
00280B 7F40              MOV      R7,#040H
   73: }
00280D 22                RET      
----- FUNCTION PKT_MDIOM_Read (END) -------


----- FUNCTION _DRV_MDIOM_Read (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  552: BOOL DRV_MDIOM_Read
  553: (
00280E 8F35              MOV      vPortAddr,R7
;---- Variable 'vRegAddr' assigned to Register 'R2/R3' ----
;---- Variable 'vDevAddr' assigned to Register 'R1' ----
002810 A905              MOV      R1,AR5
  554:     IN  UINT8               vPortAddr,
  555:     IN  UINT8               vDevAddr,
  556:     IN  UINT16              vRegAddr,
  557:     IN  UINT16              vDataLen,
  558:     OUT UINT16 SEG_XDATA   *pDataBuf
  559: )
  560: {
  561:     BOOL    bResult = TRUE;
002812 D238              SETB     bResult
  562:     BOOL    bIntState;
  563: 
  564:     for (; vDataLen-- != 0; vRegAddr++, pDataBuf++)
002814         ?C2461?DRV_MDIOM:
002814 E53A              MOV      A,vDataLen+01H
002816 153A              DEC      vDataLen+01H
002818 AE39              MOV      R6,vDataLen
00281A 7002              JNZ      ?C2525?DRV_MDIOM
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 69


00281C 1539              DEC      vDataLen
00281E         ?C2525?DRV_MDIOM:
00281E 4E                ORL      A,R6
00281F 6045              JZ       ?C2462?DRV_MDIOM
  565:     {
  566:         /* lock globally interrupt */
  567:         bIntState = DRV_INT_LockGlobalInterrupt();
002821 30AF05            JNB      EA,?C2464?DRV_MDIOM
002824 C2AF              CLR      EA
002826 D3                SETB     C
002827 8001              SJMP     ?C2465?DRV_MDIOM
002829         ?C2464?DRV_MDIOM:
002829 C3                CLR      C
00282A         ?C2465?DRV_MDIOM:
00282A 9239              MOV      bIntState,C
  568: 
  569:         /* create frame: ADDR */
  570:         drv_mdiom_CreateFrame(FRAME_TYPE_ADDR, vPortAddr, vDevAddr, vRegAddr);
00282C 1169              ACALL    ?L?COM0012
  571: 
  572:         /* transmit frame: ADDR */
  573:         drv_mdiom_TxAddrFrame();
  574: 
  575:         /* set frame type: READ */
  576:         drv_mdiom_SetFrameType(FRAME_TYPE_READ);
00282E D20D              SETB     bMdioOperationCode1
002830 D20C              SETB     bMdioOperationCode0
  577: 
  578:         /* transmit frame: READ */
  579:         drv_mdiom_RxDataFrame();
002832 12273A            LCALL    drv_mdiom_RxDataFrame
  580: 
  581:         /* unlock globally interrupt */
  582:         DRV_INT_UnlockGlobalInterrupt(bIntState);
002835 A239              MOV      C,bIntState
002837 92AF              MOV      EA,C
  583: 
  584:         /* check read status */
  585:         *pDataBuf++ = vMdioData;
002839 E53C              MOV      A,pDataBuf+01H
00283B FF                MOV      R7,A
00283C 2402              ADD      A,#02H
00283E F53C              MOV      pDataBuf+01H,A
002840 E53B              MOV      A,pDataBuf
002842 FE                MOV      R6,A
002843 3400              ADDC     A,#00H
002845 F53B              MOV      pDataBuf,A
002847 8F82              MOV      DPL,R7
002849 8E83              MOV      DPH,R6
00284B 123512            LCALL    ?L?COM0048
  586:         if (!drv_mdiom_IsReadSuccess())
00284E A200              MOV      C,bMdioTurnAround0
002850 4003              JC       ?C2482?DRV_MDIOM
002852 D3                SETB     C
002853 8001              SJMP     ?C2483?DRV_MDIOM
002855         ?C2482?DRV_MDIOM:
002855 C3                CLR      C
002856         ?C2483?DRV_MDIOM:
002856 4004              JC       ?C2463?DRV_MDIOM
  587:         {
  588:             bResult = FALSE;
002858 C238              CLR      bResult
  589:             break;
00285A 800A              SJMP     ?C2462?DRV_MDIOM
  590:         }
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 70


  591:     }
00285C         ?C2463?DRV_MDIOM:
00285C 0B                INC      R3
00285D BB0001            CJNE     R3,#00H,?C2526?DRV_MDIOM
002860 0A                INC      R2
002861         ?C2526?DRV_MDIOM:
002861 123506            LCALL    ?L?COM0047
002864 80AE              SJMP     ?C2461?DRV_MDIOM
002866         ?C2462?DRV_MDIOM:
  592: 
  593:     return bResult;
002866 A238              MOV      C,bResult
  594: }
002868 22                RET      
----- FUNCTION _DRV_MDIOM_Read (END) -------


----- FUNCTION ?L?COM0012 (BEGIN) -----
002869 E9                MOV      A,R1
00286A 75F004            MOV      B,#04H
00286D A4                MUL      AB
00286E FD                MOV      R5,A
00286F ACF0              MOV      R4,B
002871 E535              MOV      A,vPortAddr
002873         ?L?COM0013:
002873 75F080            MOV      B,#080H
002876 A4                MUL      AB
002877 FF                MOV      R7,A
002878 E5F0              MOV      A,B
00287A 4C                ORL      A,R4
00287B F520              MOV      vMdioCtrl,A
00287D EF                MOV      A,R7
00287E 4D                ORL      A,R5
00287F F521              MOV      vMdioCtrl+01H,A
002881 8A22              MOV      vMdioAddr,R2
002883 8B23              MOV      vMdioAddr+01H,R3
----- FUNCTION drv_mdiom_TxAddrFrame (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  303: static void drv_mdiom_TxAddrFrame(void)
  304: {
  305:     drv_mdiom_StartFrame();
  306:     drv_mdiom_TxPreamble();
002885 1230B7            LCALL    ?L?COM0001
002888 123105            LCALL    ?L?COM0002
00288B 12315E            LCALL    ?L?COM0003
  307:     drv_mdiom_TxStartFrame();
  308:     drv_mdiom_TxOperationCode();
  309:     drv_mdiom_TxPortAddress();
  310:     drv_mdiom_TxDeviceAddress();
  311:     drv_mdiom_TxTurnAround();
00288E A201              MOV      C,bMdioTurnAround1
002890 1231CE            LCALL    ?L?COM0004
002893 A200              MOV      C,bMdioTurnAround0
002895 1231CE            LCALL    ?L?COM0004
  312:     drv_mdiom_TxAddr();
002898 A217              MOV      C,bMdioAddr15
00289A 1231CE            LCALL    ?L?COM0004
00289D A216              MOV      C,bMdioAddr14
00289F 1231CE            LCALL    ?L?COM0004
0028A2 A215              MOV      C,bMdioAddr13
0028A4 1231CE            LCALL    ?L?COM0004
0028A7 A214              MOV      C,bMdioAddr12
0028A9 1231CE            LCALL    ?L?COM0004
0028AC A213              MOV      C,bMdioAddr11
0028AE 1231CE            LCALL    ?L?COM0004
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 71


0028B1 A212              MOV      C,bMdioAddr10
0028B3 1231CE            LCALL    ?L?COM0004
0028B6 A211              MOV      C,bMdioAddr9
0028B8 1231CE            LCALL    ?L?COM0004
0028BB A210              MOV      C,bMdioAddr8
0028BD 1231CE            LCALL    ?L?COM0004
0028C0 A21F              MOV      C,bMdioAddr7
0028C2 1231CE            LCALL    ?L?COM0004
0028C5 A21E              MOV      C,bMdioAddr6
0028C7 1231CE            LCALL    ?L?COM0004
0028CA A21D              MOV      C,bMdioAddr5
0028CC 1231CE            LCALL    ?L?COM0004
0028CF A21C              MOV      C,bMdioAddr4
0028D1 1231CE            LCALL    ?L?COM0004
0028D4 A21B              MOV      C,bMdioAddr3
0028D6 1231CE            LCALL    ?L?COM0004
0028D9 A21A              MOV      C,bMdioAddr2
0028DB 1231CE            LCALL    ?L?COM0004
0028DE A219              MOV      C,bMdioAddr1
0028E0 1231CE            LCALL    ?L?COM0004
0028E3 A218              MOV      C,bMdioAddr0
0028E5 1231CE            LCALL    ?L?COM0004
0028E8 00                NOP      
0028E9 00                NOP      
  313:     drv_mdiom_StopFrame();
0028EA 023442            LJMP     ?L?COM0032
  314: }
----- FUNCTION drv_mdiom_TxAddrFrame (END) -------


----- FUNCTION _DRV_MDIOM_Write (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  616: BOOL DRV_MDIOM_Write
  617: (
0028ED 8F35              MOV      vPortAddr,R7
;---- Variable 'vRegAddr' assigned to Register 'R2/R3' ----
;---- Variable 'vDevAddr' assigned to Register 'R1' ----
0028EF A905              MOV      R1,AR5
  618:     IN       UINT8              vPortAddr,
  619:     IN       UINT8              vDevAddr,
  620:     IN       UINT16             vRegAddr,
  621:     IN       UINT16             vDataLen,
  622:     IN const UINT16 SEG_XDATA  *pDataBuf
  623: )
  624: {
  625:     BOOL    bIntState;
  626: 
  627:     for (; vDataLen-- != 0; vRegAddr++, pDataBuf++)
0028F1         ?C2485?DRV_MDIOM:
0028F1 E53A              MOV      A,vDataLen+01H
0028F3 153A              DEC      vDataLen+01H
0028F5 AE39              MOV      R6,vDataLen
0028F7 7002              JNZ      ?C2527?DRV_MDIOM
0028F9 1539              DEC      vDataLen
0028FB         ?C2527?DRV_MDIOM:
0028FB 4E                ORL      A,R6
0028FC 602B              JZ       ?C2486?DRV_MDIOM
  628:     {
  629:         /* prepare data */
  630:         drv_mdiom_SetData(*pDataBuf);
0028FE 853C82            MOV      DPL,pDataBuf+01H
002901 853B83            MOV      DPH,pDataBuf
002904 E0                MOVX     A,@DPTR
002905 F524              MOV      vMdioData,A
002907 A3                INC      DPTR
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 72


002908 E0                MOVX     A,@DPTR
002909 F525              MOV      vMdioData+01H,A
  631: 
  632:         /* lock globally interrupt */
  633:         bIntState = DRV_INT_LockGlobalInterrupt();
00290B 30AF05            JNB      EA,?C2491?DRV_MDIOM
00290E C2AF              CLR      EA
002910 D3                SETB     C
002911 8001              SJMP     ?C2492?DRV_MDIOM
002913         ?C2491?DRV_MDIOM:
002913 C3                CLR      C
002914         ?C2492?DRV_MDIOM:
002914 9238              MOV      bIntState,C
  634: 
  635:         /* create frame: ADDR */
  636:         drv_mdiom_CreateFrame(FRAME_TYPE_ADDR, vPortAddr, vDevAddr, vRegAddr);
002916 1169              ACALL    ?L?COM0012
  637: 
  638:         /* transmit frame: ADDR */
  639:         drv_mdiom_TxAddrFrame();
  640: 
  641:         /* set frame type: WRITE */
  642:         drv_mdiom_SetFrameType(FRAME_TYPE_WRITE);
002918 C20D              CLR      bMdioOperationCode1
00291A D20C              SETB     bMdioOperationCode0
  643: 
  644:         /* transmit frame: WRITE */
  645:         drv_mdiom_TxDataFrame();
00291C 123577            LCALL    ?L?COM0060
  646: 
  647:         /* unlock globally interrupt */
  648:         DRV_INT_UnlockGlobalInterrupt(bIntState);
  649:     }
00291F 0B                INC      R3
002920 BB0001            CJNE     R3,#00H,?C2528?DRV_MDIOM
002923 0A                INC      R2
002924         ?C2528?DRV_MDIOM:
002924 123506            LCALL    ?L?COM0047
002927 80C8              SJMP     ?C2485?DRV_MDIOM
002929         ?C2486?DRV_MDIOM:
  650: 
  651:     return TRUE;
002929 D3                SETB     C
  652: }
00292A 22                RET      
----- FUNCTION _DRV_MDIOM_Write (END) -------


----- FUNCTION drv_mdiom_TxDataFrame (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  316: static void drv_mdiom_TxDataFrame(void)
  317: {
  318:     drv_mdiom_StartFrame();
  319:     drv_mdiom_TxPreamble();
00292B 1230B7            LCALL    ?L?COM0001
00292E 123105            LCALL    ?L?COM0002
002931 12315E            LCALL    ?L?COM0003
  320:     drv_mdiom_TxStartFrame();
  321:     drv_mdiom_TxOperationCode();
  322:     drv_mdiom_TxPortAddress();
  323:     drv_mdiom_TxDeviceAddress();
  324:     drv_mdiom_TxTurnAround();
002934 A201              MOV      C,bMdioTurnAround1
002936 1231CE            LCALL    ?L?COM0004
002939 A200              MOV      C,bMdioTurnAround0
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 73


00293B 1231CE            LCALL    ?L?COM0004
  325:     drv_mdiom_TxData();
00293E A227              MOV      C,bMdioData15
002940 1231CE            LCALL    ?L?COM0004
002943 A226              MOV      C,bMdioData14
002945 1231CE            LCALL    ?L?COM0004
002948 A225              MOV      C,bMdioData13
00294A 1231CE            LCALL    ?L?COM0004
00294D A224              MOV      C,bMdioData12
00294F 1231CE            LCALL    ?L?COM0004
002952 A223              MOV      C,bMdioData11
002954 1231CE            LCALL    ?L?COM0004
002957 A222              MOV      C,bMdioData10
002959 1231CE            LCALL    ?L?COM0004
00295C A221              MOV      C,bMdioData9
00295E 1231CE            LCALL    ?L?COM0004
002961 A220              MOV      C,bMdioData8
002963 1231CE            LCALL    ?L?COM0004
002966 A22F              MOV      C,bMdioData7
002968 1231CE            LCALL    ?L?COM0004
00296B A22E              MOV      C,bMdioData6
00296D 1231CE            LCALL    ?L?COM0004
002970 A22D              MOV      C,bMdioData5
002972 1231CE            LCALL    ?L?COM0004
002975 A22C              MOV      C,bMdioData4
002977 1231CE            LCALL    ?L?COM0004
00297A A22B              MOV      C,bMdioData3
00297C 1231CE            LCALL    ?L?COM0004
00297F A22A              MOV      C,bMdioData2
002981 1231CE            LCALL    ?L?COM0004
002984 A229              MOV      C,bMdioData1
002986 1231CE            LCALL    ?L?COM0004
002989 A228              MOV      C,bMdioData0
00298B 1231CE            LCALL    ?L?COM0004
00298E 00                NOP      
00298F 00                NOP      
  326:     drv_mdiom_StopFrame();
002990 023442            LJMP     ?L?COM0032
  327: }
----- FUNCTION drv_mdiom_TxDataFrame (END) -------


----- FUNCTION _DRV_MDIOM_FrameWrite (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
  408: BOOL DRV_MDIOM_FrameWrite
  409: (
;---- Variable 'vPortAddr' assigned to Register 'R7' ----
;---- Variable 'vData' assigned to Register 'R2/R3' ----
;---- Variable 'vDevAddr' assigned to Register 'R1' ----
002993 A905              MOV      R1,AR5
  410:     IN  UINT8           vPortAddr,
  411:     IN  UINT8           vDevAddr,
  412:     IN  UINT16          vData
  413: )
  414: {
  415:     BOOL    bIntState;
  416: 
  417:     /* lock globally interrupt */
  418:     bIntState = DRV_INT_LockGlobalInterrupt();
002995 30AF05            JNB      EA,?C2410?DRV_MDIOM
002998 C2AF              CLR      EA
00299A D3                SETB     C
00299B 8001              SJMP     ?C2411?DRV_MDIOM
00299D         ?C2410?DRV_MDIOM:
00299D C3                CLR      C
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 74


00299E         ?C2411?DRV_MDIOM:
00299E 123471            LCALL    ?L?COM0038
0029A1 4401              ORL      A,#01H
0029A3 FD                MOV      R5,A
0029A4 E9                MOV      A,R1
0029A5 75F004            MOV      B,#04H
0029A8 A4                MUL      AB
0029A9 FF                MOV      R7,A
0029AA EC                MOV      A,R4
0029AB 45F0              ORL      A,B
0029AD F520              MOV      vMdioCtrl,A
0029AF ED                MOV      A,R5
0029B0 4F                ORL      A,R7
0029B1 F521              MOV      vMdioCtrl+01H,A
0029B3 8A22              MOV      vMdioAddr,R2
0029B5 8B23              MOV      vMdioAddr+01H,R3
  419: 
  420:     /* create frame: WRITE */
  421:     drv_mdiom_CreateFrame(FRAME_TYPE_WRITE, vPortAddr, vDevAddr, vData);
  422: 
  423:     /* transmit frame: WRITE */
  424:     drv_mdiom_TxDataFrame();
0029B7 123577            LCALL    ?L?COM0060
  425: 
  426:     /* unlock globally interrupt */
  427:     DRV_INT_UnlockGlobalInterrupt(bIntState);
  428: 
  429:     /* check frame result */
  430:     return TRUE;
0029BA D3                SETB     C
  431: }
0029BB 22                RET      
----- FUNCTION _DRV_MDIOM_FrameWrite (END) -------


----- FUNCTION PKT_MDIOM_Write (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
   75: UINT16 PKT_MDIOM_Write(void)
   76: {
   77:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
   78: 
0029BC 1232A5            LCALL    ?L?COM000E
0029BF 11ED              ACALL    _DRV_MDIOM_Write
0029C1 7E01              MOV      R6,#01H
0029C3 4002              JC       ?C0009?PKT_MDIOM
   79:     if (!DRV_MDIOM_Write(pPayload->vPortAddr,
   80:                          pPayload->vDevAddr,
   81:                          pPayload->vOffset,
   82:                          pPayload->vDataCount,
   83:                          pPayload->aData))
   84:     {
   85:         return PKT_REPLY_Fail_MdioNoAck;
0029C5 7E03              MOV      R6,#03H
   86:     }
0029C7         ?C0009?PKT_MDIOM:
   87: 
   88:     return PKT_REPLY_Done_ExecNoError;
0029C7 7F40              MOV      R7,#040H
   89: }
0029C9 22                RET      
----- FUNCTION PKT_MDIOM_Write (END) -------


----- FUNCTION _DRV_MDIOM_FrameAddr (BEGIN) -----
 FILE: '..\drv\drv_mdiom.c'
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 75


  365: BOOL DRV_MDIOM_FrameAddr
  366: (
;---- Variable 'vPortAddr' assigned to Register 'R1' ----
0029CA A907              MOV      R1,AR7
;---- Variable 'vRegAddr' assigned to Register 'R2/R3' ----
;---- Variable 'vDevAddr' assigned to Register 'R5' ----
  367:     IN  UINT8           vPortAddr,
  368:     IN  UINT8           vDevAddr,
  369:     IN  UINT16          vRegAddr
  370: )
  371: {
  372:     BOOL    bIntState;
  373: 
  374:     /* lock globally interrupt */
  375:     bIntState = DRV_INT_LockGlobalInterrupt();
0029CC 30AF05            JNB      EA,?C2395?DRV_MDIOM
0029CF C2AF              CLR      EA
0029D1 D3                SETB     C
0029D2 8001              SJMP     ?C2396?DRV_MDIOM
0029D4         ?C2395?DRV_MDIOM:
0029D4 C3                CLR      C
0029D5         ?C2396?DRV_MDIOM:
0029D5 9238              MOV      bIntState,C
  376: 
  377:     /* create frame: ADDR */
  378:     drv_mdiom_CreateFrame(FRAME_TYPE_ADDR, vPortAddr, vDevAddr, vRegAddr);
0029D7 ED                MOV      A,R5
0029D8 75F004            MOV      B,#04H
0029DB A4                MUL      AB
0029DC FD                MOV      R5,A
0029DD ACF0              MOV      R4,B
0029DF E9                MOV      A,R1
0029E0 1173              ACALL    ?L?COM0013
  379: 
  380:     /* transmit frame: ADDR */
  381:     drv_mdiom_TxAddrFrame();
  382: 
  383:     /* unlock globally interrupt */
  384:     DRV_INT_UnlockGlobalInterrupt(bIntState);
0029E2 A238              MOV      C,bIntState
0029E4 92AF              MOV      EA,C
  385: 
  386:     /* check frame result */
  387:     return TRUE;
0029E6 D3                SETB     C
  388: }
0029E7 22                RET      
----- FUNCTION _DRV_MDIOM_FrameAddr (END) -------


----- FUNCTION PKT_MDIOM_FrameAddr (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
   91: UINT16 PKT_MDIOM_FrameAddr(void)
   92: {
   93:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
   94: 
;---- Variable 'pPayload' assigned to Register 'R2/R3' ----
0029E8 123396            LCALL    ?L?COM001C
0029EB 1582              DEC      DPL
0029ED 8A83              MOV      DPH,R2
0029EF A3                INC      DPTR
0029F0 A3                INC      DPTR
0029F1 E0                MOVX     A,@DPTR
0029F2 FA                MOV      R2,A
0029F3 A3                INC      DPTR
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 76


0029F4 E0                MOVX     A,@DPTR
0029F5 FB                MOV      R3,A
0029F6 31CA              ACALL    _DRV_MDIOM_FrameAddr
0029F8 7E01              MOV      R6,#01H
0029FA 4002              JC       ?C0011?PKT_MDIOM
   95:     if (!DRV_MDIOM_FrameAddr(pPayload->vPortAddr,
   96:                              pPayload->vDevAddr,
   97:                              pPayload->vOffset))
   98:     {
   99:         return PKT_REPLY_Fail_MdioNoAck;
0029FC 7E03              MOV      R6,#03H
  100:     }
0029FE         ?C0011?PKT_MDIOM:
  101: 
  102:     return PKT_REPLY_Done_ExecNoError;
0029FE 7F40              MOV      R7,#040H
  103: }
002A00 22                RET      
----- FUNCTION PKT_MDIOM_FrameAddr (END) -------


----- FUNCTION PKT_MDIOM_FrameWrite (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
  105: UINT16 PKT_MDIOM_FrameWrite(void)
  106: {
  107:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
  108: 
;---- Variable 'pPayload' assigned to Register 'R2/R3' ----
002A01 123396            LCALL    ?L?COM001C
002A04 1582              DEC      DPL
002A06 E582              MOV      A,DPL
002A08 2406              ADD      A,#06H
002A0A F582              MOV      DPL,A
002A0C E4                CLR      A
002A0D 3A                ADDC     A,R2
002A0E F583              MOV      DPH,A
002A10 E0                MOVX     A,@DPTR
002A11 FA                MOV      R2,A
002A12 A3                INC      DPTR
002A13 E0                MOVX     A,@DPTR
002A14 FB                MOV      R3,A
002A15 3193              ACALL    _DRV_MDIOM_FrameWrite
002A17 7E01              MOV      R6,#01H
002A19 4002              JC       ?C0013?PKT_MDIOM
  109:     if (!DRV_MDIOM_FrameWrite(pPayload->vPortAddr,
  110:                               pPayload->vDevAddr,
  111:                               pPayload->aData[0]))
  112:     {
  113:         return PKT_REPLY_Fail_MdioNoAck;
002A1B 7E03              MOV      R6,#03H
  114:     }
002A1D         ?C0013?PKT_MDIOM:
  115: 
  116:     return PKT_REPLY_Done_ExecNoError;
002A1D 7F40              MOV      R7,#040H
  117: }
002A1F 22                RET      
----- FUNCTION PKT_MDIOM_FrameWrite (END) -------


----- FUNCTION PKT_MDIOM_FramePRIA (BEGIN) -----
 FILE: '..\pkt\pkt_mdiom.c'
  133: UINT16 PKT_MDIOM_FramePRIA(void)
  134: {
  135:     PKT_MDIOM_T SEG_XDATA *pPayload = (PKT_MDIOM_T SEG_XDATA *)PKT_GetPayload();
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 77


  136: 
;---- Variable 'pPayload' assigned to Register 'R2/R3' ----
002A20 123396            LCALL    ?L?COM001C
002A23 12356F            LCALL    ?L?COM005F
002A26 1227A9            LCALL    _DRV_MDIOM_FramePRIA
002A29 7E01              MOV      R6,#01H
002A2B 4002              JC       ?C0017?PKT_MDIOM
  137:     if (!DRV_MDIOM_FramePRIA(pPayload->vPortAddr,
  138:                              pPayload->vDevAddr,
  139:                              pPayload->aData))
  140:     {
  141:         return PKT_REPLY_Fail_MdioNoAck;
002A2D 7E03              MOV      R6,#03H
  142:     }
002A2F         ?C0017?PKT_MDIOM:
  143: 
  144:     return PKT_REPLY_Done_ExecNoError;
002A2F 7F40              MOV      R7,#040H
  145: }
002A31 22                RET      
----- FUNCTION PKT_MDIOM_FramePRIA (END) -------


----- FUNCTION PKT_C2M_Inspect (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
   38: UINT16 PKT_C2M_Inspect(void)
   39: {
   40:     PKT_SetPayloadSize(0x00);
   41:     return PKT_REPLY_Done_ExecNoError;
002A32 12342A            LCALL    ?L?COM002F
   42: }
002A35 7E01              MOV      R6,#01H
002A37 7F40              MOV      R7,#040H
   43: 
002A39 22                RET      
----- FUNCTION PKT_C2M_Inspect (END) -------


----- FUNCTION PKT_C2M_Reset (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
   44: UINT16 PKT_C2M_Reset(void)
   45: {
   46:     PKT_SetPayloadSize(0x00);
   47:     return (DRV_C2M_Reset() ?
002A3A 12342A            LCALL    ?L?COM002F
   48:             PKT_REPLY_Done_ExecNoError :
   49:             PKT_REPLY_Fail_ExecErrorCode0);
002A3D 5148              ACALL    DRV_C2M_Reset
002A3F 7E03              MOV      R6,#03H
002A41 5002              JNC      ?C0008?PKT_C2M
002A43 7E01              MOV      R6,#01H
002A45         ?C0008?PKT_C2M:
002A45 7F40              MOV      R7,#040H
   50: }
002A47 22                RET      
----- FUNCTION PKT_C2M_Reset (END) -------


----- FUNCTION DRV_C2M_Reset (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  427: BOOL DRV_C2M_Reset(void)
  428: {
  429:     if (!drv_c2m_IsReady())
  430:     {
002A48 309703            JNB      IO_DUT_C2M_SCL,?C0824?DRV_C2M
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 78


002A4B 20A002            JB       IO_DUT_C2M_SDA,?C0831?DRV_C2M
002A4E         ?C0824?DRV_C2M:
  431:         /* C2 bus is not ready */
  432:         return FALSE;
002A4E C3                CLR      C
002A4F 22                RET      
  433:     }
  434: 
  435:     c2m_Reset();
002A50         ?C0831?DRV_C2M:
002A50 123400            LCALL    ?L?COM002C
002A53 53A57F            ANL      P1MDOUT,#07FH
  436:     return TRUE;
002A56 D3                SETB     C
  437: }
002A57 22                RET      
----- FUNCTION DRV_C2M_Reset (END) -------


----- FUNCTION PKT_C2M_Probe (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
   52: UINT16 PKT_C2M_Probe(void)
   53: {
   54:     XDATA_U32(PKT_GetPayload()) = DRV_C2M_Probe();
   55:     PKT_SetPayloadSize(sizeof(UINT32));
002A58 121E66            LCALL    DRV_C2M_Probe
002A5B 90004C            MOV      DPTR,#vFrame+0CH
002A5E 120685            LCALL    ?C?LSTXDATA
   56:     return PKT_REPLY_Done_ExecNoError;
002A61 90004A            MOV      DPTR,#vFrame+0AH
002A64 E4                CLR      A
002A65 F0                MOVX     @DPTR,A
002A66 A3                INC      DPTR
002A67 7404              MOV      A,#04H
002A69 F0                MOVX     @DPTR,A
   57: }
002A6A 7E01              MOV      R6,#01H
002A6C 7F40              MOV      R7,#040H
   58: 
002A6E 22                RET      
----- FUNCTION PKT_C2M_Probe (END) -------


----- FUNCTION PKT_C2M_FlashChipErase (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
   59: UINT16 PKT_C2M_FlashChipErase(void)
   60: {
   61:     PKT_SetPayloadSize(0x00);
   62:     return (DRV_C2M_ChipErase() ?
002A6F 12342A            LCALL    ?L?COM002F
   63:             PKT_REPLY_Done_ExecNoError :
   64:             PKT_REPLY_Fail_ExecErrorCode0);
002A72 121F7A            LCALL    DRV_C2M_ChipErase
002A75 7E03              MOV      R6,#03H
002A77 5002              JNC      ?C0018?PKT_C2M
002A79 7E01              MOV      R6,#01H
002A7B         ?C0018?PKT_C2M:
002A7B 7F40              MOV      R7,#040H
   65: }
002A7D 22                RET      
----- FUNCTION PKT_C2M_FlashChipErase (END) -------


----- FUNCTION PKT_C2M_FlashPageErase (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 79


   67: UINT16 PKT_C2M_FlashPageErase(void)
   68: {
   69:     if (PKT_GetPayloadSize() != 1)
   70:     {
002A7E 90004A            MOV      DPTR,#vFrame+0AH
002A81 E0                MOVX     A,@DPTR
002A82 7004              JNZ      ?C0043?PKT_C2M
002A84 A3                INC      DPTR
002A85 E0                MOVX     A,@DPTR
002A86 6401              XRL      A,#01H
002A88         ?C0043?PKT_C2M:
002A88 6005              JZ       ?C0021?PKT_C2M
   71:         return PKT_REPLY_Fail_InvalidLen;
   72:     }
002A8A 7E03              MOV      R6,#03H
002A8C 7F04              MOV      R7,#04H
002A8E 22                RET      
   73: 
002A8F         ?C0021?PKT_C2M:
   74:     return (DRV_C2M_PageErase(XDATA_U8(PKT_GetPayload())) ?
   75:             PKT_REPLY_Done_ExecNoError :
   76:             PKT_REPLY_Fail_ExecErrorCode0);
002A8F 90004C            MOV      DPTR,#vFrame+0CH
002A92 E0                MOVX     A,@DPTR
002A93 FF                MOV      R7,A
002A94 121D6D            LCALL    _DRV_C2M_PageErase
002A97 7E03              MOV      R6,#03H
002A99 5002              JNC      ?C0023?PKT_C2M
002A9B 7E01              MOV      R6,#01H
002A9D         ?C0023?PKT_C2M:
002A9D 7F40              MOV      R7,#040H
   77: }
002A9F 22                RET      
----- FUNCTION PKT_C2M_FlashPageErase (END) -------


----- FUNCTION PKT_C2M_FlashWrite (BEGIN) -----
 FILE: '..\pkt\pkt_c2m.c'
  115: UINT16 PKT_C2M_FlashWrite(void)
  116: {
  117:     PKT_C2M_RW_T SEG_XDATA *pPayload = (PKT_C2M_RW_T SEG_XDATA *)PKT_GetPayload();
  118:     UINT8 SEG_XDATA *pBuf  = pPayload->aBuf;
;---- Variable 'pPayload' assigned to Register 'R2/R3' ----
002AA0 1232E8            LCALL    ?L?COM0010
  119:     UINT16           vAddr = (UINT16)pPayload->vAddr;
  120:     UINT16           vLen  = pPayload->vDataLen;
  121: 
  122:     if (PKT_GetPayloadSize() != (PKT_C2M_RW_HEADER_LEN+vLen))
002AA3 2406              ADD      A,#06H
002AA5 FF                MOV      R7,A
002AA6 E4                CLR      A
002AA7 3537              ADDC     A,vLen
002AA9 FE                MOV      R6,A
002AAA 90004A            MOV      DPTR,#vFrame+0AH
002AAD E0                MOVX     A,@DPTR
002AAE 6E                XRL      A,R6
002AAF 7003              JNZ      ?C0045?PKT_C2M
002AB1 A3                INC      DPTR
002AB2 E0                MOVX     A,@DPTR
002AB3 6F                XRL      A,R7
002AB4         ?C0045?PKT_C2M:
002AB4 6005              JZ       ?C0038?PKT_C2M
  123:     {
  124:         return PKT_REPLY_Fail_InvalidLen;
002AB6 7E03              MOV      R6,#03H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 80


002AB8 7F04              MOV      R7,#04H
002ABA 22                RET      
  125:     }
002ABB         ?C0038?PKT_C2M:
  126: 
  127:     /* split too long write data buffer into pieces to write */
  128:     while (vLen != 0)
002ABB E538              MOV      A,vLen+01H
002ABD 4537              ORL      A,vLen
002ABF 602E              JZ       ?C0039?PKT_C2M
  129:     {
  130:         UINT16 vWriteLen = ((vLen<0x100)?vLen:0x100);
002AC1 C3                CLR      C
002AC2 E537              MOV      A,vLen
002AC4 9401              SUBB     A,#01H
002AC6 5006              JNC      ?C0040?PKT_C2M
002AC8 AE37              MOV      R6,vLen
002ACA AF38              MOV      R7,vLen+01H
002ACC 8004              SJMP     ?C0041?PKT_C2M
002ACE         ?C0040?PKT_C2M:
002ACE 7E01              MOV      R6,#01H
002AD0 7F00              MOV      R7,#00H
002AD2         ?C0041?PKT_C2M:
002AD2 8E39              MOV      vWriteLen,R6
002AD4 8F3A              MOV      vWriteLen+01H,R7
  131: 
  132:       #if DRV_WATCHDOG_SUPPORT
  133:         DRV_WATCHDOG_Kick();
  134:       #endif
  135: 
  136:         if (!DRV_C2M_FlashWrite(vAddr, pBuf, (UINT8)vWriteLen))
002AD6 AB3A              MOV      R3,vWriteLen+01H
002AD8 AD34              MOV      R5,pBuf+01H
002ADA AC33              MOV      R4,pBuf
002ADC AF36              MOV      R7,vAddr+01H
002ADE AE35              MOV      R6,vAddr
002AE0 121CBB            LCALL    _DRV_C2M_FlashWrite
002AE3 4005              JC       ?C0042?PKT_C2M
  137:         {
  138:             return PKT_REPLY_Fail_ExecErrorCode0;
002AE5 7E03              MOV      R6,#03H
002AE7 7F40              MOV      R7,#040H
002AE9 22                RET      
  139:         }
002AEA         ?C0042?PKT_C2M:
  140: 
  141:         pBuf  += vWriteLen;
002AEA 123328            LCALL    ?L?COM0019
  142:         vAddr += vWriteLen;
  143:         vLen  -= vWriteLen;
  144:     }
002AED 80CC              SJMP     ?C0038?PKT_C2M
002AEF         ?C0039?PKT_C2M:
  145: 
  146:     return PKT_REPLY_Done_ExecNoError;
002AEF 7E01              MOV      R6,#01H
002AF1 7F40              MOV      R7,#040H
  147: }
002AF3 22                RET      
----- FUNCTION PKT_C2M_FlashWrite (END) -------


----- FUNCTION thread_IDLE_Entry (BEGIN) -----
 FILE: '..\plf\thread_idle.c'
   49: OS_HANDLE thread_IDLE_Entry(void)
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 81


   50: {
   51:     PT_BEGIN(&vTCB_Idle);
   52: 
002AF4 752B01            MOV      PT_YIELD_FLAG,#01H
002AF7         ?C0001?THREAD_IDLE:
002AF7 E512              MOV      A,vTCB_Idle
002AF9 7038              JNZ      ?C0002?THREAD_IDLE
002AFB E513              MOV      A,vTCB_Idle+01H
002AFD 24C4              ADD      A,#0C4H
002AFF 601F              JZ       ?C0012?THREAD_IDLE
002B01 243C              ADD      A,#03CH
002B03 702E              JNZ      ?C0002?THREAD_IDLE
   53:     for (;;)
002B05         ?C0004?THREAD_IDLE:
   54:     {
   55:     	/* system entry */
   56:         CFG_Entry();
   57:         DRV_Entry();
   58:         APL_Entry();
002B05 1218D9            LCALL    APL_Entry
   59: 
   60:         OS_SLEEP_MS(&vTCB_Idle, 50);
002B08 E511              MOV      A,vTickCount+03H
002B0A 2432              ADD      A,#032H
002B0C FF                MOV      R7,A
002B0D E4                CLR      A
002B0E 3510              ADDC     A,vTickCount+02H
002B10 12355D            LCALL    ?L?COM005D
002B13 FC                MOV      R4,A
002B14 9004FC            MOV      DPTR,#vEndTick
002B17 120685            LCALL    ?C?LSTXDATA
002B1A 751200            MOV      vTCB_Idle,#00H
002B1D 75133C            MOV      vTCB_Idle+01H,#03CH
002B20         ?C0012?THREAD_IDLE:
002B20 00                NOP      
002B21 9004FC            MOV      DPTR,#vEndTick
002B24 1233A4            LCALL    ?L?COM001D
002B27 7F00              MOV      R7,#00H
002B29 5002              JNC      ?C0014?THREAD_IDLE
002B2B 7F01              MOV      R7,#01H
002B2D         ?C0014?THREAD_IDLE:
002B2D         ?C0015?THREAD_IDLE:
002B2D EF                MOV      A,R7
002B2E 60D5              JZ       ?C0004?THREAD_IDLE
002B30 7F00              MOV      R7,#00H
002B32 22                RET      
   61:     }
   62: 
   63:     PT_END(&vTCB_Idle);
002B33         ?C0002?THREAD_IDLE:
002B33 E4                CLR      A
002B34 F52B              MOV      PT_YIELD_FLAG,A
002B36 F512              MOV      vTCB_Idle,A
002B38 F513              MOV      vTCB_Idle+01H,A
002B3A 7F03              MOV      R7,#03H
   64: }
002B3C 22                RET      
----- FUNCTION thread_IDLE_Entry (END) -------


----- FUNCTION thread_IDLE_Init (BEGIN) -----
 FILE: '..\plf\thread_idle.c'
   81: void thread_IDLE_Init(void)
   82: {
   83:     PT_INIT(&vTCB_Idle);
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 82


   84: 
002B3D E4                CLR      A
002B3E F512              MOV      vTCB_Idle,A
002B40 F513              MOV      vTCB_Idle+01H,A
   85: 	/* system init */
   86:     CFG_Init();
002B42 1201DD            LCALL    CFG_Init
   87:     DRV_Init();
002B45 7161              ACALL    DRV_Init
;----                  JMP      APL_Init
   88:     APL_Init();
----- FUNCTION thread_IDLE_Init (END) -------


----- FUNCTION APL_Init (BEGIN) -----
 FILE: '..\apl\apl.c'
  194: void APL_Init(void)
  195: {
  196:     /* copy initial setting */
  197:     CFG_SET(RT_EVB_CTRL, CFG_GET(INIT_RT_EVB_CTRL));
002B47         ?C0598?APL:
002B47 903860            MOV      DPTR,#03860H
002B4A E4                CLR      A
002B4B 93                MOVC     A,@A+DPTR
002B4C FF                MOV      R7,A
002B4D 7818              MOV      R0,#018H
002B4F EF                MOV      A,R7
002B50 F2                MOVX     @R0,A
002B51         ?C0619?APL:
  198: 
  199:     /* enable PWM_VBUF output */
  200:     DRV_PCA_Write(PCA(PWM_VBUF), CFG_GET(RT_EVB_CTRL_PWM_VBUF));
002B51 7818              MOV      R0,#018H
002B53 E2                MOVX     A,@R0
002B54 FF                MOV      R7,A
002B55 E4                CLR      A
002B56 8FFC              MOV      PCA0CPH0,R7
002B58         ?C0618?APL:
  201:     DRV_CPU_DelayMs(10);
002B58 7F0A              MOV      R7,#0AH
002B5A 7E00              MOV      R6,#00H
002B5C 91A8              ACALL    _DRV_CPU_DelayMs
  202:     DRV_IO_Write(IO(IO_VBUF_OEn), LOW);
002B5E C291              CLR      IO_VBUF_OEn
  203: }
002B60 22                RET      
----- FUNCTION APL_Init (END) -------


----- FUNCTION DRV_Init (BEGIN) -----
 FILE: '..\drv\drv.c'
   47: void DRV_Init(void)
   48: {
   49: 	DRV_VECTOR_Init();
   50: 
   51:   #if DRV_FLASH_SUPPORT
   52: 	DRV_FLASH_Init();
   53:   #endif
   54: 
   55:   #if DRV_RESET_SUPPORT
   56: 	DRV_RESET_Init();
   57:   #endif
   58: 
   59:   #if DRV_TIMER_SUPPORT
   60: 	DRV_TIMER_Init();
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 83


002B61 438E10            ORL      CKCON,#010H
002B64 E4                CLR      A
002B65 F5C8              MOV      TMR2CN,A
002B67 75CA40            MOV      TMR2RLL,#040H
002B6A 75CC40            MOV      TMR2L,#040H
002B6D 75CBA2            MOV      TMR2RLH,#0A2H
002B70 75CDA2            MOV      TMR2H,#0A2H
002B73 C2CF              CLR      TF2H
002B75 D2CA              SETB     TR2
002B77 C2BD              CLR      PT2
002B79 D2AD              SETB     ET2
002B7B F511              MOV      vTickCount+03H,A
002B7D F510              MOV      vTickCount+02H,A
002B7F F50F              MOV      vTickCount+01H,A
002B81 F50E              MOV      vTickCount,A
   61:   #endif
   62: 
   63:   #if DRV_USB_SUPPORT
   64: 	DRV_USB_Init();
002B83 719C              ACALL    DRV_USB_Init
   65:   #endif
   66: 
   67:   #if DRV_VREF_SUPPORT
   68: 	DRV_VREF_Init();
002B85 75D107            MOV      REF0CN,#07H
002B88 7FD0              MOV      R7,#0D0H
002B8A 7E07              MOV      R6,#07H
002B8C 121C26            LCALL    _DRV_CPU_DelayUs
   69:   #endif
   70: 
   71:   #if DRV_ADC_SUPPORT
   72: 	DRV_ADC_Init();
002B8F 91E9              ACALL    DRV_ADC_Init
;----                  JMP      DRV_C2M_Init
   73:   #endif
   74: 
   75:   #if DRV_I2CM_SUPPORT
   76: 	DRV_I2CM_Init();
   77:   #endif
   78: 
   79:   #if DRV_C2M_SUPPORT
----- FUNCTION DRV_Init (END) -------


----- FUNCTION DRV_C2M_Init (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  700: void DRV_C2M_Init(void)
  701: {
  702:     c2m_Init();
  703: }
002B91 53A57F            ANL      P1MDOUT,#07FH
002B94 53A6FE            ANL      P2MDOUT,#0FEH
002B97 D297              SETB     IO_DUT_C2M_SCL
002B99 D2A0              SETB     IO_DUT_C2M_SDA
  704: 
002B9B 22                RET      
----- FUNCTION DRV_C2M_Init (END) -------


----- FUNCTION DRV_USB_Init (BEGIN) -----
 FILE: '..\drv\drv_usb.c'
   54: void DRV_USB_Init(void)
   55: {
   56:     UINT8   vData;
   57:     UINT8   vLoop;
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 84


   58: 
   59:     /* init USB manufacture string */
   60:     aManufacturerStr[1] = 0x03;
002B9C 900485            MOV      DPTR,#aManufacturerStr+01H
002B9F 7403              MOV      A,#03H
002BA1 F0                MOVX     @DPTR,A
   61:     for (vLoop=2; vLoop<sizeof(aManufacturerStr); vLoop+=2)
;---- Variable 'vLoop' assigned to Register 'R7' ----
002BA2 7F02              MOV      R7,#02H
002BA4         ?C0001?DRV_USB:
002BA4 EF                MOV      A,R7
002BA5 C3                CLR      C
002BA6 9422              SUBB     A,#022H
002BA8 5030              JNC      ?C0002?DRV_USB
   62:     {
   63:         vData = CFG_GETO8(EE_Vendor_Name, (vLoop>>1)-1);
002BAA EF                MOV      A,R7
002BAB C3                CLR      C
002BAC 13                RRC      A
002BAD C3                CLR      C
002BAE 9401              SUBB     A,#01H
002BB0 2490              ADD      A,#090H
002BB2 1233D0            LCALL    ?L?COM0027
002BB5 4023              JC       ?C0002?DRV_USB
002BB7 E52B              MOV      A,vData
002BB9 947F              SUBB     A,#07FH
002BBB 501D              JNC      ?C0002?DRV_USB
   64: 
   65:         if ((vData < 0x20) || (vData >= 0x7F))
   66:         {
   67:             break;
   68:         }
002BBD         ?C0004?DRV_USB:
   69: 
   70:         aManufacturerStr[vLoop+0] = vData;
002BBD 7484              MOV      A,#LOW aManufacturerStr
002BBF 2F                ADD      A,R7
002BC0 F582              MOV      DPL,A
002BC2 E4                CLR      A
002BC3 3404              ADDC     A,#HIGH aManufacturerStr
002BC5 F583              MOV      DPH,A
002BC7 E52B              MOV      A,vData
002BC9 F0                MOVX     @DPTR,A
   71:         aManufacturerStr[vLoop+1] = 0;
002BCA 7485              MOV      A,#LOW aManufacturerStr+01H
002BCC 2F                ADD      A,R7
002BCD F582              MOV      DPL,A
002BCF E4                CLR      A
002BD0 3404              ADDC     A,#HIGH aManufacturerStr+01H
002BD2 F583              MOV      DPH,A
002BD4 E4                CLR      A
002BD5 F0                MOVX     @DPTR,A
   72:     }
002BD6 0F                INC      R7
002BD7 0F                INC      R7
002BD8 80CA              SJMP     ?C0001?DRV_USB
002BDA         ?C0002?DRV_USB:
   73:     aManufacturerStr[0] = vLoop;
002BDA 900484            MOV      DPTR,#aManufacturerStr
002BDD EF                MOV      A,R7
002BDE F0                MOVX     @DPTR,A
   74: 
   75:     /* init USB product string */
   76:     aProductStr[1] = 0x03;
002BDF 9004A7            MOV      DPTR,#aProductStr+01H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 85


002BE2 7403              MOV      A,#03H
002BE4 F0                MOVX     @DPTR,A
   77:     for (vLoop=2; vLoop<sizeof(aProductStr); vLoop+=2)
002BE5 7F02              MOV      R7,#02H
002BE7         ?C0006?DRV_USB:
002BE7 EF                MOV      A,R7
002BE8 C3                CLR      C
002BE9 9422              SUBB     A,#022H
002BEB 5030              JNC      ?C0007?DRV_USB
   78:     {
   79:         vData = CFG_GETO8(EE_Vendor_PN, (vLoop>>1)-1);
002BED EF                MOV      A,R7
002BEE C3                CLR      C
002BEF 13                RRC      A
002BF0 C3                CLR      C
002BF1 9401              SUBB     A,#01H
002BF3 24A0              ADD      A,#0A0H
002BF5 1233D0            LCALL    ?L?COM0027
002BF8 4023              JC       ?C0007?DRV_USB
002BFA E52B              MOV      A,vData
002BFC 947F              SUBB     A,#07FH
002BFE 501D              JNC      ?C0007?DRV_USB
   80: 
   81:         if ((vData < 0x20) || (vData >= 0x7F))
   82:         {
   83:             break;
   84:         }
002C00         ?C0009?DRV_USB:
   85: 
   86:         aProductStr[vLoop+0] = vData;
002C00 74A6              MOV      A,#LOW aProductStr
002C02 2F                ADD      A,R7
002C03 F582              MOV      DPL,A
002C05 E4                CLR      A
002C06 3404              ADDC     A,#HIGH aProductStr
002C08 F583              MOV      DPH,A
002C0A E52B              MOV      A,vData
002C0C F0                MOVX     @DPTR,A
   87:         aProductStr[vLoop+1] = 0;
002C0D 74A7              MOV      A,#LOW aProductStr+01H
002C0F 2F                ADD      A,R7
002C10 F582              MOV      DPL,A
002C12 E4                CLR      A
002C13 3404              ADDC     A,#HIGH aProductStr+01H
002C15 F583              MOV      DPH,A
002C17 E4                CLR      A
002C18 F0                MOVX     @DPTR,A
   88:     }
002C19 0F                INC      R7
002C1A 0F                INC      R7
002C1B 80CA              SJMP     ?C0006?DRV_USB
002C1D         ?C0007?DRV_USB:
   89:     aProductStr[0] = vLoop;
002C1D 9004A6            MOV      DPTR,#aProductStr
002C20 EF                MOV      A,R7
002C21 F0                MOVX     @DPTR,A
   90: 
   91:     /* init USB serial number string */
   92:     aSerialNumberStr[1] = 0x03;
002C22 9004C9            MOV      DPTR,#aSerialNumberStr+01H
002C25 7403              MOV      A,#03H
002C27 F0                MOVX     @DPTR,A
   93:     for (vLoop=2; vLoop<sizeof(aSerialNumberStr); vLoop+=2)
002C28 7F02              MOV      R7,#02H
002C2A         ?C0011?DRV_USB:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 86


002C2A EF                MOV      A,R7
002C2B C3                CLR      C
002C2C 9422              SUBB     A,#022H
002C2E 5030              JNC      ?C0012?DRV_USB
   94:     {
   95:         vData = CFG_GETO8(EE_Vendor_SN, (vLoop>>1)-1);
002C30 EF                MOV      A,R7
002C31 C3                CLR      C
002C32 13                RRC      A
002C33 C3                CLR      C
002C34 9401              SUBB     A,#01H
002C36 24B0              ADD      A,#0B0H
002C38 1233D0            LCALL    ?L?COM0027
002C3B 4023              JC       ?C0012?DRV_USB
002C3D E52B              MOV      A,vData
002C3F 947F              SUBB     A,#07FH
002C41 501D              JNC      ?C0012?DRV_USB
   96: 
   97:         if ((vData < 0x20) || (vData >= 0x7F))
   98:         {
   99:             break;
  100:         }
002C43         ?C0014?DRV_USB:
  101: 
  102:         aSerialNumberStr[vLoop+0] = vData;
002C43 74C8              MOV      A,#LOW aSerialNumberStr
002C45 2F                ADD      A,R7
002C46 F582              MOV      DPL,A
002C48 E4                CLR      A
002C49 3404              ADDC     A,#HIGH aSerialNumberStr
002C4B F583              MOV      DPH,A
002C4D E52B              MOV      A,vData
002C4F F0                MOVX     @DPTR,A
  103:         aSerialNumberStr[vLoop+1] = 0;
002C50 74C9              MOV      A,#LOW aSerialNumberStr+01H
002C52 2F                ADD      A,R7
002C53 F582              MOV      DPL,A
002C55 E4                CLR      A
002C56 3404              ADDC     A,#HIGH aSerialNumberStr+01H
002C58 F583              MOV      DPH,A
002C5A E4                CLR      A
002C5B F0                MOVX     @DPTR,A
  104:     }
002C5C 0F                INC      R7
002C5D 0F                INC      R7
002C5E 80CA              SJMP     ?C0011?DRV_USB
002C60         ?C0012?DRV_USB:
  105:     aSerialNumberStr[0] = vLoop;
002C60 9004C8            MOV      DPTR,#aSerialNumberStr
002C63 EF                MOV      A,R7
002C64 F0                MOVX     @DPTR,A
  106: 
  107:     /* set USB0 to the high priority level interrupt */
  108:     EIP1 |= (1<<1);
002C65 43F602            ORL      EIP1,#02H
  109: 
  110:     /* init USB device */
  111:     USB_Clock_Start();
002C68 120046            LCALL    USB_Clock_Start
  112:     USB_Init(DRV_USB_VID,
002C6B 9004F1            MOV      DPTR,#?_USB_Init?BYTE+07H
002C6E 7401              MOV      A,#01H
002C70 F0                MOVX     @DPTR,A
002C71 A3                INC      DPTR
002C72 7404              MOV      A,#HIGH aProductStr
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 87


002C74 F0                MOVX     @DPTR,A
002C75 A3                INC      DPTR
002C76 74A6              MOV      A,#LOW aProductStr
002C78 F0                MOVX     @DPTR,A
002C79 A3                INC      DPTR
002C7A 7401              MOV      A,#01H
002C7C F0                MOVX     @DPTR,A
002C7D A3                INC      DPTR
002C7E 7404              MOV      A,#HIGH aSerialNumberStr
002C80 F0                MOVX     @DPTR,A
002C81 A3                INC      DPTR
002C82 74C8              MOV      A,#LOW aSerialNumberStr
002C84 F0                MOVX     @DPTR,A
002C85 A3                INC      DPTR
002C86 74FA              MOV      A,#0FAH
002C88 F0                MOVX     @DPTR,A
002C89 A3                INC      DPTR
002C8A 7480              MOV      A,#080H
002C8C F0                MOVX     @DPTR,A
002C8D A3                INC      DPTR
002C8E 7401              MOV      A,#01H
002C90 F0                MOVX     @DPTR,A
002C91 A3                INC      DPTR
002C92 E4                CLR      A
002C93 F0                MOVX     @DPTR,A
002C94 7B01              MOV      R3,#01H
002C96 7A04              MOV      R2,#HIGH aManufacturerStr
002C98 7984              MOV      R1,#LOW aManufacturerStr
002C9A 7D61              MOV      R5,#061H
002C9C 7CEA              MOV      R4,#0EAH
002C9E 7FC4              MOV      R7,#0C4H
002CA0 7E10              MOV      R6,#010H
002CA2 120BCD            LCALL    _USB_Init
  113:              DRV_USB_PID,
  114:              aManufacturerStr,
  115:              aProductStr,
  116:              aSerialNumberStr,
  117:              0xFA,      /* maximum current: 500mA */
  118:              0x80,      /* bus-powered, remote wakeup is unsupported */
  119:              0x100);    /* device release number 1.00 */
  120: 
  121:     /* the USB_Init() API will auto-enable global interrupt,
  122:      * disable it here, and will be enabled later.
  123:      */
  124:     DRV_INT_GlobalDisableInterrupt();
002CA5 C2AF              CLR      EA
  125: }
002CA7 22                RET      
----- FUNCTION DRV_USB_Init (END) -------


----- FUNCTION _DRV_CPU_DelayMs (BEGIN) -----
 FILE: '..\drv\drv_cpu.c'
   78: void DRV_CPU_DelayMs(UINT16 vMsec)
   79: {
;---- Variable 'vMsec' assigned to Register 'DPTR' ----
002CA8 8F82              MOV      DPL,R7
002CAA 8E83              MOV      DPH,R6
   80:   #if DRV_TIMER_SUPPORT
   81:     if (DRV_INT_IsGlobalInterruptEnable())
002CAC 30AF23            JNB      EA,?C0008?DRV_CPU
   82:     {
   83:         UINT64  vStopTick = DRV_TIMER_GetTick() + vMsec/DRV_TIMER_INTERVAL;
002CAF EF                MOV      A,R7
002CB0 2511              ADD      A,vTickCount+03H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 88


002CB2 F53E              MOV      vStopTick+03H,A
002CB4 EE                MOV      A,R6
002CB5 3510              ADDC     A,vTickCount+02H
002CB7 F53D              MOV      vStopTick+02H,A
002CB9 E4                CLR      A
002CBA 350F              ADDC     A,vTickCount+01H
002CBC F53C              MOV      vStopTick+01H,A
002CBE E4                CLR      A
002CBF 350E              ADDC     A,vTickCount
002CC1 F53B              MOV      vStopTick,A
002CC3         ?C0005?DRV_CPU:
   84: 
   85:         while (DRV_TIMER_GetTick() < vStopTick)
002CC3 AF3E              MOV      R7,vStopTick+03H
002CC5 AE3D              MOV      R6,vStopTick+02H
002CC7 AD3C              MOV      R5,vStopTick+01H
002CC9 AC3B              MOV      R4,vStopTick
002CCB 1233AF            LCALL    ?L?COM001E
002CCE 5018              JNC      ?C0010?DRV_CPU
   86:         {
   87:           #if DRV_WATCHDOG_SUPPORT
   88:             DRV_WATCHDOG_Kick();
   89:           #endif
   90:         }
002CD0 80F1              SJMP     ?C0005?DRV_CPU
   91:     }
   92:     else
   93:   #endif
   94:     {
002CD2         ?C0008?DRV_CPU:
   95:     	while (vMsec--)
002CD2 E582              MOV      A,DPL
002CD4 1582              DEC      DPL
002CD6 AE83              MOV      R6,DPH
002CD8 7002              JNZ      ?C0012?DRV_CPU
002CDA 1583              DEC      DPH
002CDC         ?C0012?DRV_CPU:
002CDC 4E                ORL      A,R6
002CDD 6009              JZ       ?C0010?DRV_CPU
   96:     	{
   97:           #if DRV_WATCHDOG_SUPPORT
   98:     		DRV_WATCHDOG_Kick();
   99:           #endif
  100: 
  101:     		DRV_CPU_DelayUs(1000);
002CDF 7FE8              MOV      R7,#0E8H
002CE1 7E03              MOV      R6,#03H
002CE3 121C26            LCALL    _DRV_CPU_DelayUs
  102:     	}
002CE6 80EA              SJMP     ?C0008?DRV_CPU
  103:     }
  104: }
002CE8         ?C0010?DRV_CPU:
002CE8 22                RET      
----- FUNCTION _DRV_CPU_DelayMs (END) -------


----- FUNCTION DRV_ADC_Init (BEGIN) -----
 FILE: '..\drv\drv_adc.c'
   99: void DRV_ADC_Init(void)
  100: {
  101:   /* AD0SC value */
  102:   #define AD0SC_VAL (((CORE_CLOCK*10/DRV_ADC_SAR_RATE/1000/ADC_SAR_ConvClock+5)/10-1)&0x1F)
  103: 
  104:     /* default:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 89


  105:      *  positive channel: temperature sensor;
  106:      *  negative channel: GND;
  107:      */
  108:     AMX0P = ADC_CHP_TEMP;
002CE9 75BB1E            MOV      AMX0P,#01EH
  109:     AMX0N = ADC_CHN_GND;
002CEC 75BA1F            MOV      AMX0N,#01FH
  110: 
  111:     /* ADC control:
  112:      *  right justify;
  113:      *  ADC start-of-conversion source is write of '1' to ADC0BUSY;
  114:      *  clear ADC flag;
  115:      *  enable ADC;
  116:      */
  117:     ADC0CF = (AD0SC_VAL<<3) | (0<<2);
002CEF 75BCB8            MOV      ADC0CF,#0B8H
  118:     ADC0CN = 0x80;
002CF2 75E880            MOV      ADC0CN,#080H
  119: }
002CF5 22                RET      
----- FUNCTION DRV_ADC_Init (END) -------


----- FUNCTION thread_LED_Entry (BEGIN) -----
 FILE: '..\plf\thread_led.c'
   48: OS_HANDLE thread_LED_Entry(void)
   49: {
   50:     PT_BEGIN(&vTCB_LED);
   51: 
002CF6 752B01            MOV      PT_YIELD_FLAG,#01H
002CF9         ?C0001?THREAD_LED:
002CF9 E514              MOV      A,vTCB_LED
002CFB 7054              JNZ      ?C0002?THREAD_LED
002CFD E515              MOV      A,vTCB_LED+01H
002CFF 24BA              ADD      A,#0BAH
002D01 603B              JZ       ?C0029?THREAD_LED
002D03 2446              ADD      A,#046H
002D05 704A              JNZ      ?C0002?THREAD_LED
   52:     for (;;)
002D07         ?C0004?THREAD_LED:
   53:     {
   54:       #if CFG_SUPPORT
   55:         if (CFG_GET(RT_EVB_STAT_Global_Ready) == HIGH)
002D07 7819              MOV      R0,#019H
002D09 E2                MOVX     A,@R0
002D0A C4                SWAP     A
002D0B 13                RRC      A
002D0C 13                RRC      A
002D0D 13                RRC      A
002D0E 5401              ANL      A,#01H
002D10 1233BE            LCALL    ?L?COM0020
002D13 1234BE            LCALL    ?L?COM003F
002D16 7006              JNZ      ?C0016?THREAD_LED
   56:         {
   57:             /* system running OK */
   58:             DRV_IO_Write(IO(IO_LED_1_OUT), HIGH);
002D18 D293              SETB     IO_LED_1_OUT
   59:             DRV_IO_Write(IO(IO_LED_2_OUT), LOW);
002D1A C286              CLR      IO_LED_2_OUT
   60:         }
002D1C 8004              SJMP     ?C0022?THREAD_LED
   61:         else
   62:       #endif
   63:         {
002D1E         ?C0016?THREAD_LED:
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 90


   64:             /* system running abnormally */
   65:             DRV_IO_Write(IO(IO_LED_1_OUT), LOW);
002D1E C293              CLR      IO_LED_1_OUT
   66:             DRV_IO_Write(IO(IO_LED_2_OUT), HIGH);
002D20 D286              SETB     IO_LED_2_OUT
   67:         }
002D22         ?C0022?THREAD_LED:
   68: 
   69:         DRV_IO_Toggle(IO(IO_LED_STATUS_OUT));
002D22 63A008            XRL      P2,#08H
   70:         OS_SLEEP_MS(&vTCB_LED, 500);
002D25 E511              MOV      A,vTickCount+03H
002D27 24F4              ADD      A,#0F4H
002D29 FF                MOV      R7,A
002D2A E510              MOV      A,vTickCount+02H
002D2C 3401              ADDC     A,#01H
002D2E 12355D            LCALL    ?L?COM005D
002D31 FC                MOV      R4,A
002D32 900500            MOV      DPTR,#vEndTick
002D35 120685            LCALL    ?C?LSTXDATA
002D38 751400            MOV      vTCB_LED,#00H
002D3B 751546            MOV      vTCB_LED+01H,#046H
002D3E         ?C0029?THREAD_LED:
002D3E 00                NOP      
002D3F 900500            MOV      DPTR,#vEndTick
002D42 1233A4            LCALL    ?L?COM001D
002D45 7F00              MOV      R7,#00H
002D47 5002              JNC      ?C0031?THREAD_LED
002D49 7F01              MOV      R7,#01H
002D4B         ?C0031?THREAD_LED:
002D4B         ?C0032?THREAD_LED:
002D4B EF                MOV      A,R7
002D4C 60B9              JZ       ?C0004?THREAD_LED
002D4E 7F00              MOV      R7,#00H
002D50 22                RET      
   71:     }
   72: 
   73:     PT_END(&vTCB_LED);
002D51         ?C0002?THREAD_LED:
002D51 E4                CLR      A
002D52 F52B              MOV      PT_YIELD_FLAG,A
002D54 F514              MOV      vTCB_LED,A
002D56 F515              MOV      vTCB_LED+01H,A
002D58 7F03              MOV      R7,#03H
   74: }
002D5A 22                RET      
----- FUNCTION thread_LED_Entry (END) -------


----- FUNCTION thread_LED_Init (BEGIN) -----
 FILE: '..\plf\thread_led.c'
   91: void thread_LED_Init(void)
   92: {
   93:     PT_INIT(&vTCB_LED);
   94: }
002D5B E4                CLR      A
002D5C F514              MOV      vTCB_LED,A
002D5E F515              MOV      vTCB_LED+01H,A
   95: 
002D60 22                RET      
----- FUNCTION thread_LED_Init (END) -------


----- FUNCTION _fixupInit (BEGIN) -----
 FILE: '..\plf\main.c'
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 91


   46: static void _fixupInit(void)
   47: {
   48:     /* Globally enable Interrupt */
   49:     DRV_INT_GlobalEnableInterrupt();
002D61 D2AF              SETB     EA
   50: 
   51:   #if DRV_USB_SUPPORT
   52: 	/* enable USB interface */
   53: 	DRV_USB_Enable();
002D63 021303            LJMP     USB_Int_Enable
----- FUNCTION _fixupInit (END) -------


----- FUNCTION main (BEGIN) -----
 FILE: '..\plf\main.c'
   72: void main(void)
   73: {
   74: 	/* previous init */
   75: 	DRV_PreInit();
002D66 B199              ACALL    DRV_PreInit
   76: 
   77:     /* init protothread */
   78:     OS_Init();
002D68 B183              ACALL    OS_Init
   79: 
   80:     /* fixup init */
   81:     _fixupInit();
002D6A B161              ACALL    _fixupInit
;----                  JMP      OS_Start
   82: 
   83:     /* start protothread (never return) */
----- FUNCTION main (END) -------


----- FUNCTION OS_Start (BEGIN) -----
 FILE: '..\os\os.c'
   59: void OS_Start(void)
   60: {
   61:     for (;;)
   62:     {
002D6C         ?C0001?OS:
   63:         UINT8   i;
   64: 
   65:         for (i = 0; i < COUNT_OF(aThreadList); i++)
002D6C E4                CLR      A
002D6D F52A              MOV      i,A
002D6F         ?C0003?OS:
   66:         {
   67:             aThreadList[i].pEntry();
002D6F E52A              MOV      A,i
002D71 75F006            MOV      B,#06H
002D74 A4                MUL      AB
002D75 241C              ADD      A,#LOW aThreadList
002D77 F582              MOV      DPL,A
002D79 E4                CLR      A
002D7A 3416              ADDC     A,#HIGH aThreadList
002D7C 123415            LCALL    ?L?COM002D
002D7F 40EE              JC       ?C0003?OS
002D81 80E9              SJMP     ?C0001?OS
   68:         }
----- FUNCTION OS_Start (END) -------


----- FUNCTION OS_Init (BEGIN) -----
 FILE: '..\os\os.c'
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 92


   87: void OS_Init(void)
   88: {
   89:     UINT8   i;
   90: 
   91:     for (i = 0; i < COUNT_OF(aThreadList); i++)
002D83 E4                CLR      A
002D84 F52A              MOV      i,A
002D86         ?C0007?OS:
   92:     {
   93:         aThreadList[i].pInit();
002D86 E52A              MOV      A,i
002D88 75F006            MOV      B,#06H
002D8B A4                MUL      AB
002D8C 241F              ADD      A,#LOW aThreadList+03H
002D8E F582              MOV      DPL,A
002D90 E4                CLR      A
002D91 3416              ADDC     A,#HIGH aThreadList+03H
002D93 123415            LCALL    ?L?COM002D
002D96 40EE              JC       ?C0007?OS
   94:     }
   95: }
002D98 22                RET      
----- FUNCTION OS_Init (END) -------


----- FUNCTION DRV_PreInit (BEGIN) -----
 FILE: '..\drv\drv.c'
   99: void DRV_PreInit(void)
  100: {
  101:     /* disable all interrupt */
  102:     DRV_INT_DisableAllInterrupt();
002D99 E4                CLR      A
002D9A F5A8              MOV      IE,A
002D9C F5E6              MOV      EIE1,A
  103: 
  104:   #if DRV_CLOCK_SUPPORT
  105:     DRV_CLOCK_Init();
002D9E 75B283            MOV      OSCICN,#083H
002DA1         ?C0026?DRV:
002DA1 E5B2              MOV      A,OSCICN
002DA3 C4                SWAP     A
002DA4 13                RRC      A
002DA5 13                RRC      A
002DA6 5403              ANL      A,#03H
002DA8 13                RRC      A
002DA9 50F6              JNC      ?C0026?DRV
002DAB         ?C0027?DRV:
002DAB 75B980            MOV      CLKMUL,#080H
002DAE 7F05              MOV      R7,#05H
002DB0 7E00              MOV      R6,#00H
002DB2 121C26            LCALL    _DRV_CPU_DelayUs
002DB5 43B9C0            ORL      CLKMUL,#0C0H
002DB8         ?C0028?DRV:
002DB8 E5B9              MOV      A,CLKMUL
002DBA C4                SWAP     A
002DBB 13                RRC      A
002DBC 5407              ANL      A,#07H
002DBE 13                RRC      A
002DBF 50F7              JNC      ?C0028?DRV
002DC1         ?C0029?DRV:
002DC1 75A902            MOV      CLKSEL,#02H
002DC4 75B680            MOV      FLSCL,#080H
  106:   #endif
  107: 
  108:   #if DRV_IO_SUPPORT
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 93


  109: 	DRV_IO_Init();
002DC7 D12A              ACALL    DRV_IO_Init
  110:   #endif
  111: 
  112:   #if DRV_UART_SUPPORT
  113:     DRV_UART_Init();
002DC9 438E08            ORL      CKCON,#08H
002DCC E589              MOV      A,TMOD
002DCE 540F              ANL      A,#0FH
002DD0 4420              ORL      A,#020H
002DD2 F589              MOV      TMOD,A
002DD4 758D98            MOV      TH1,#098H
002DD7 D28E              SETB     TR1
002DD9 AFD4              MOV      R7,P0SKIP
002DDB EF                MOV      A,R7
002DDC 54EF              ANL      A,#0EFH
002DDE FF                MOV      R7,A
002DDF 8FD4              MOV      P0SKIP,R7
002DE1 AFD4              MOV      R7,P0SKIP
002DE3 EF                MOV      A,R7
002DE4 54DF              ANL      A,#0DFH
002DE6 FF                MOV      R7,A
002DE7 E4                CLR      A
002DE8 8FD4              MOV      P0SKIP,R7
002DEA 43E101            ORL      XBR0,#01H
002DED 759802            MOV      SCON0,#02H
;----                  JMP      DRV_PCA_Init
  114:   #endif
  115: 
  116:   #if DRV_PCA_SUPPORT
----- FUNCTION DRV_PreInit (END) -------


----- FUNCTION DRV_PCA_Init (BEGIN) -----
 FILE: '..\drv\drv_pca.c'
   48: void DRV_PCA_Init(void)
   49: {
   50:     UINT8   vPCA0ME = 0x00;
   51: 
;---- Variable 'vPCA0ME' assigned to Register 'R3' ----
002DF0 E4                CLR      A
002DF1 FB                MOV      R3,A
   52:     /* PCA channel init */
   53:   #define DECLARE_PCA(_name,_ch,_io,_mode,_init,_desc)                      \
   54:     do {                                                                    \
   55:         DRV_PCA_Write(_name, _init);                                        \
   56:         DRV_PCA_SetMode(_name, _mode);                                      \
   57:                                                                             \
   58:         if (_mode != PCA_MODE_DISABLE)                                      \
   59:         {                                                                   \
   60:             /* force no-skip this PCA channel for GPIO */                   \
   61:             drv_io_SetSkip(_PCA_IO(_name), DISABLE);                        \
   62:             vPCA0ME++;                                                      \
   63:         }                                                                   \
   64:     } while (0);
   65:   #include "cfg_hw_def.h"
   66:   #undef DECLARE_PCA
   67: 
   68:     /* init PCA0:
   69:      *  reset PCA counter;
   70:      *  PCA clock source: defined by DRV_PCA_SOURCE_CLOCK;
   71:      *  enable PCA;
   72:      */
   73:     PCA0H  = 0x00;
   74:     PCA0L  = 0x00;
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 94


   75:     PCA0MD = (DRV_PCA_SOURCE_CLOCK<<1);
   76:     PCA0CN = 0x40;
   77: 
   78:     /* enable CEXn at cross-bar */
   79:     XBR1 |= (vPCA0ME&0x7);
   80: }
   81: 
   82: #endif
   83: 
   83: 
002DF2 75FCFF            MOV      PCA0CPH0,#0FFH
002DF5         ?C0011?DRV_PCA:
002DF5 75DA42            MOV      PCA0CPM0,#042H
002DF8 AFD4              MOV      R7,P0SKIP
002DFA EF                MOV      A,R7
002DFB 54FD              ANL      A,#0FDH
002DFD FF                MOV      R7,A
002DFE 8FD4              MOV      P0SKIP,R7
002E00 0B                INC      R3
   83: 
002E01         ?C0022?DRV_PCA:
002E01 E4                CLR      A
002E02 F5E9              MOV      PCA0CPL1,A
002E04 F5EA              MOV      PCA0CPH1,A
002E06         ?C0026?DRV_PCA:
002E06 E4                CLR      A
002E07 F5DB              MOV      PCA0CPM1,A
002E09         ?C0037?DRV_PCA:
002E09 E4                CLR      A
002E0A F5EB              MOV      PCA0CPL2,A
002E0C F5EC              MOV      PCA0CPH2,A
002E0E         ?C0041?DRV_PCA:
002E0E E4                CLR      A
002E0F F5DC              MOV      PCA0CPM2,A
002E11         ?C0052?DRV_PCA:
002E11 E4                CLR      A
002E12 F5ED              MOV      PCA0CPL3,A
002E14 F5EE              MOV      PCA0CPH3,A
002E16         ?C0056?DRV_PCA:
002E16 E4                CLR      A
002E17 F5DD              MOV      PCA0CPM3,A
002E19         ?C0047?DRV_PCA:
002E19 E4                CLR      A
002E1A F5FA              MOV      PCA0H,A
002E1C F5F9              MOV      PCA0L,A
002E1E 75D908            MOV      PCA0MD,#08H
002E21 75D840            MOV      PCA0CN,#040H
002E24 EB                MOV      A,R3
002E25 5407              ANL      A,#07H
002E27 42E2              ORL      XBR1,A
002E29 22                RET      
----- FUNCTION DRV_PCA_Init (END) -------


----- FUNCTION DRV_IO_Init (BEGIN) -----
 FILE: '..\drv\drv_io.c'
   48: void DRV_IO_Init(void)
   49: {
   50:     /* io internal init */
   51:     P0      = _PORT_INIT(P0);
002E2A 7580BF            MOV      P0,#0BFH
   52:     P1      = _PORT_INIT(P1);
002E2D 7590F7            MOV      P1,#0F7H
   53:     P2      = _PORT_INIT(P2);
002E30 75A0FF            MOV      P2,#0FFH
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 95


   54:     P3      = _PORT_INIT(P3);
002E33 75B0FF            MOV      P3,#0FFH
   55:     P0MDIN  = _PORT_MDIN(P0);
002E36 75F17F            MOV      P0MDIN,#07FH
   56:     P1MDIN  = _PORT_MDIN(P1);
002E39 75F2FE            MOV      P1MDIN,#0FEH
   57:     P2MDIN  = _PORT_MDIN(P2);
002E3C 75F3FB            MOV      P2MDIN,#0FBH
   58:     P3MDIN  = _PORT_MDIN(P3);
002E3F 75F4FE            MOV      P3MDIN,#0FEH
   59:     P0MDOUT = _PORT_MDOUT(P0);
002E42 75A44A            MOV      P0MDOUT,#04AH
   60:     P1MDOUT = _PORT_MDOUT(P1);
002E45 75A558            MOV      P1MDOUT,#058H
   61:     P2MDOUT = _PORT_MDOUT(P2);
002E48 75A60A            MOV      P2MDOUT,#0AH
   62:     P3MDOUT = _PORT_MDOUT(P3);
002E4B E4                CLR      A
002E4C F5A7              MOV      P3MDOUT,A
   63: 
   64:     /* default, all pins are skipped for cross-bar */
   65:     P0SKIP = 0xFF;
002E4E 75D4FF            MOV      P0SKIP,#0FFH
   66:     P1SKIP = 0xFF;
002E51 75D5FF            MOV      P1SKIP,#0FFH
   67:     P2SKIP = 0xFF;
002E54 75D6FF            MOV      P2SKIP,#0FFH
   68: 
   69:     /* enable cross-bar */
   70:     XBR0 = 0x00;
002E57 F5E1              MOV      XBR0,A
   71:     XBR1 = 0x40;
002E59 75E240            MOV      XBR1,#040H
   72: }
002E5C 22                RET      
----- FUNCTION DRV_IO_Init (END) -------


----- FUNCTION DRV_VECTOR_Timer2 (BEGIN) -----
 FILE: '..\drv\drv_vector.c'
   49: void DRV_VECTOR_Timer2(void) __interrupt(INTERRUPT_TIMER2)
002E5D C0E0              PUSH     ACC
002E5F C0D0              PUSH     PSW
002E61 75D000            MOV      PSW,#00H
002E64 C004              PUSH     AR4
002E66 C005              PUSH     AR5
002E68 C006              PUSH     AR6
002E6A C007              PUSH     AR7
   50: {
   51:     /* clear timeout flag */
   52:     DRV_TIMER_ClearTimeoutFlag();
002E6C C2CF              CLR      TF2H
   53: 
   54:     /* update tick counter */
   55: 	DRV_TIMER_UpdateTick();
002E6E AF11              MOV      R7,vTickCount+03H
002E70 AE10              MOV      R6,vTickCount+02H
002E72 AD0F              MOV      R5,vTickCount+01H
002E74 AC0E              MOV      R4,vTickCount
002E76 EF                MOV      A,R7
002E77 2401              ADD      A,#01H
002E79 F511              MOV      vTickCount+03H,A
002E7B E4                CLR      A
002E7C 3E                ADDC     A,R6
002E7D F510              MOV      vTickCount+02H,A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 96


002E7F E4                CLR      A
002E80 3D                ADDC     A,R5
002E81 F50F              MOV      vTickCount+01H,A
002E83 E4                CLR      A
002E84 3C                ADDC     A,R4
002E85 F50E              MOV      vTickCount,A
   56: }
002E87 D007              POP      AR7
002E89 D006              POP      AR6
002E8B D005              POP      AR5
002E8D D004              POP      AR4
002E8F D0D0              POP      PSW
002E91 D0E0              POP      ACC
002E93 32                RETI     
----- FUNCTION DRV_VECTOR_Timer2 (END) -------


----- FUNCTION DRV_VECTOR_UserUSB (BEGIN) -----
 FILE: '..\drv\drv_vector.c'
   76: void DRV_VECTOR_UserUSB(void) __interrupt(INTERRUPT_UserUSB)
002E94 C0E0              PUSH     ACC
002E96 C0F0              PUSH     B
002E98 C083              PUSH     DPH
002E9A C082              PUSH     DPL
002E9C C0D0              PUSH     PSW
002E9E 75D000            MOV      PSW,#00H
002EA1 C000              PUSH     AR0
002EA3 C001              PUSH     AR1
002EA5 C002              PUSH     AR2
002EA7 C003              PUSH     AR3
002EA9 C004              PUSH     AR4
002EAB C005              PUSH     AR5
002EAD C006              PUSH     AR6
002EAF C007              PUSH     AR7
   77: {
   78:   #if PKT_SUPPORT
   79: 	thread_Pkt_Notify(DRV_USB_GetInterruptSource());
002EB1 12133E            LCALL    Get_Interrupt_Source
002EB4 1217DB            LCALL    _thread_Pkt_Notify
   80:   #endif
   81: }
002EB7 D007              POP      AR7
002EB9 D006              POP      AR6
002EBB D005              POP      AR5
002EBD D004              POP      AR4
002EBF D003              POP      AR3
002EC1 D002              POP      AR2
002EC3 D001              POP      AR1
002EC5 D000              POP      AR0
002EC7 D0D0              POP      PSW
002EC9 D082              POP      DPL
002ECB D083              POP      DPH
002ECD D0F0              POP      B
002ECF D0E0              POP      ACC
002ED1 32                RETI     
----- FUNCTION DRV_VECTOR_UserUSB (END) -------


----- FUNCTION _DRV_ADC_Sample (BEGIN) -----
 FILE: '..\drv\drv_adc.c'
   50: SINT16 DRV_ADC_Sample(UINT8 vPositive, UINT8 vNegative, UINT8 vAvgNum)
   51: {
002ED2 8B30              MOV      vAvgNum,R3
;---- Variable 'vNegative' assigned to Register 'R5' ----
;---- Variable 'vPositive' assigned to Register 'R7' ----
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 97


   52:     SINT16  vAdcSum;
   53:     UINT8   vLoop;
   54: 
   55:     /* select positive/negative channel */
   56:     AMX0P = vPositive;
002ED4 8FBB              MOV      AMX0P,R7
   57:     AMX0N = vNegative;
002ED6 8DBA              MOV      AMX0N,R5
   58: 
   59:     /* wait for ADC input stable */
   60:     DRV_CPU_DelayUs(ADC_SettlingTime);
002ED8 7FC8              MOV      R7,#0C8H
002EDA 7E00              MOV      R6,#00H
002EDC 121C26            LCALL    _DRV_CPU_DelayUs
   61: 
   62:     /* sampling */
   63:     vAdcSum = 0;
;---- Variable 'vAdcSum' assigned to Register 'R4/R5' ----
002EDF E4                CLR      A
002EE0 FD                MOV      R5,A
002EE1 FC                MOV      R4,A
   64:     for (vLoop = (1<<vAvgNum); vLoop > 0; vLoop--)
002EE2 AF30              MOV      R7,vAvgNum
002EE4 04                INC      A
002EE5 A807              MOV      R0,AR7
002EE7 08                INC      R0
002EE8 8002              SJMP     ?C0009?DRV_ADC
002EEA         ?C0008?DRV_ADC:
002EEA C3                CLR      C
002EEB 33                RLC      A
002EEC         ?C0009?DRV_ADC:
002EEC D8FC              DJNZ     R0,?C0008?DRV_ADC
;---- Variable 'vLoop' assigned to Register 'R3' ----
002EEE FB                MOV      R3,A
002EEF         ?C0001?DRV_ADC:
002EEF EB                MOV      A,R3
002EF0 D3                SETB     C
002EF1 9400              SUBB     A,#00H
002EF3 401A              JC       ?C0002?DRV_ADC
   65:     {
   66:         /* clear the ADC last converted flag */
   67:         AD0INT = 0;
002EF5 C2ED              CLR      AD0INT
   68: 
   69:         /* start a new ADC converting */
   70:         AD0BUSY = 1;
002EF7 D2EC              SETB     AD0BUSY
002EF9         ?C0004?DRV_ADC:
   71: 
   72:         /* waiting for ADC converted */
   73:         while (!AD0INT)
002EF9 30EDFD            JNB      AD0INT,?C0004?DRV_ADC
   74:         {}
002EFC         ?C0005?DRV_ADC:
   75: 
   76:         /* sum the ADC result */
   77:         vAdcSum += (SINT16)(((UINT16)ADC0H<<8)|ADC0L);
002EFC AFBE              MOV      R7,ADC0H
002EFE EF                MOV      A,R7
002EFF FE                MOV      R6,A
002F00 AABD              MOV      R2,ADC0L
002F02 EA                MOV      A,R2
002F03 F582              MOV      DPL,A
002F05 E582              MOV      A,DPL
002F07 2D                ADD      A,R5
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 98


002F08 FD                MOV      R5,A
002F09 EE                MOV      A,R6
002F0A 3C                ADDC     A,R4
002F0B FC                MOV      R4,A
   78:     }
002F0C 1B                DEC      R3
002F0D 80E0              SJMP     ?C0001?DRV_ADC
002F0F         ?C0002?DRV_ADC:
   79: 
   80:     /* calculate the averaged value */
   81:     return (vAdcSum>>vAvgNum);
002F0F ED                MOV      A,R5
002F10 AE04              MOV      R6,AR4
002F12 A830              MOV      R0,vAvgNum
002F14 08                INC      R0
002F15 8006              SJMP     ?C0011?DRV_ADC
002F17         ?C0010?DRV_ADC:
002F17 CE                XCH      A,R6
002F18 A2E7              MOV      C,ACC.7
002F1A 13                RRC      A
002F1B CE                XCH      A,R6
002F1C 13                RRC      A
002F1D         ?C0011?DRV_ADC:
002F1D D8F8              DJNZ     R0,?C0010?DRV_ADC
002F1F FF                MOV      R7,A
   82: }
002F20 22                RET      
----- FUNCTION _DRV_ADC_Sample (END) -------


----- FUNCTION apl_ddm_GetEVBTemp (BEGIN) -----
 FILE: '..\apl\apl.c'
   61: static UINT16 apl_ddm_GetEVBTemp(void)
   62: {
   63:     UINT16  vRawADC;
   64: 
   65:     /* get raw ADC value, and record it */
   66:     vRawADC = (UINT16)DRV_ADC_Sample(ADC(ADC_EVB_TEMP));
002F21 7B03              MOV      R3,#03H
002F23 7D1F              MOV      R5,#01FH
002F25 7F1E              MOV      R7,#01EH
002F27 F1E5              ACALL    ?L?COM002E
002F29 7F20              MOV      R7,#020H
002F2B 7E00              MOV      R6,#00H
002F2D 121FEF            LCALL    _CFG_RAM_SET16
002F30         ?C0013?APL:
   67:     CFG_SET(DDM_ADC_EVB_TEMP, vRawADC);
   68: 
   69:     /* calibration */
   70:     return apl_ddm_Calibrate(vRawADC,
   71:                              GET_SLOPE_DELTA(DDM_EVB_TEMP_Slope),
   72:                              TRUE);
002F30 D238              SETB     ?_apl_ddm_Calibrate?BIT
002F32 E4                CLR      A
002F33 FD                MOV      R5,A
;----                  JMP      ?L?COM0046
   73: }
----- FUNCTION apl_ddm_GetEVBTemp (END) -------


----- FUNCTION ?L?COM0046 (BEGIN) -----
002F34 AF2E              MOV      R7,vRawADC+01H
002F36 AE2D              MOV      R6,vRawADC
----- FUNCTION _apl_ddm_Calibrate (BEGIN) -----
 FILE: '..\apl\apl.c'
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 99


   39: static UINT16 apl_ddm_Calibrate
   40: (
002F38 8E30              MOV      vRawADC,R6
002F3A 8F31              MOV      vRawADC+01H,R7
002F3C 8D32              MOV      vSlopeDelta,R5
   41:     IN UINT16   vRawADC,
   42:     IN UINT8    vSlopeDelta,
   43:     IN BOOL     bSignDDM
   44: )
   45: {
   46:     SINT64  vTmpData;
   47:     SINT32  vTmpSlope, vTmpOffset;
   48: 
   49:     vTmpSlope  = (SINT32)CFG_GETO32(DDM_EVB_TEMP_Slope,  vSlopeDelta);
002F3E E4                CLR      A
002F3F 2532              ADD      A,vSlopeDelta
002F41 121FE3            LCALL    ?L?COM0050
002F44 8F3A              MOV      vTmpSlope+03H,R7
002F46 8E39              MOV      vTmpSlope+02H,R6
002F48 8D38              MOV      vTmpSlope+01H,R5
002F4A 8C37              MOV      vTmpSlope,R4
   50:     vTmpOffset = (SINT32)CFG_GETO32(DDM_EVB_TEMP_Offset, vSlopeDelta);
002F4C E532              MOV      A,vSlopeDelta
002F4E 2404              ADD      A,#04H
002F50 121FE3            LCALL    ?L?COM0050
002F53 8F3E              MOV      vTmpOffset+03H,R7
002F55 8E3D              MOV      vTmpOffset+02H,R6
002F57 8D3C              MOV      vTmpOffset+01H,R5
002F59 8C3B              MOV      vTmpOffset,R4
   51: 
   52:     vTmpData = (((SINT64)vTmpSlope * vRawADC) >> Slope_ZoomIn_ShiftBits)
002F5B AE30              MOV      R6,vRawADC
002F5D AF31              MOV      R7,vRawADC+01H
002F5F E4                CLR      A
002F60 FC                MOV      R4,A
002F61 FD                MOV      R5,A
002F62 AB3A              MOV      R3,vTmpSlope+03H
002F64 AA39              MOV      R2,vTmpSlope+02H
002F66 A938              MOV      R1,vTmpSlope+01H
002F68 A837              MOV      R0,vTmpSlope
002F6A 1205B8            LCALL    ?C?LMUL
002F6D 7808              MOV      R0,#08H
002F6F 12062E            LCALL    ?C?SLSHR
002F72 EF                MOV      A,R7
002F73 253E              ADD      A,vTmpOffset+03H
002F75 F536              MOV      vTmpData+03H,A
002F77 EE                MOV      A,R6
002F78 353D              ADDC     A,vTmpOffset+02H
002F7A F535              MOV      vTmpData+02H,A
002F7C ED                MOV      A,R5
002F7D 353C              ADDC     A,vTmpOffset+01H
002F7F F534              MOV      vTmpData+01H,A
002F81 EC                MOV      A,R4
002F82 353B              ADDC     A,vTmpOffset
002F84 F533              MOV      vTmpData,A
   53:                 + vTmpOffset;
   54: 
   55:     /* limit the calibrated value to 16-bit formatting,
   56:      *  to strictly follow MSA Standard.
   57:      */
   58:     return (UINT16)(bSignDDM? LIMIT_S16(vTmpData): LIMIT_U16(vTmpData));
002F86 303831            JNB      bSignDDM,?C0001?APL
002F89 E4                CLR      A
002F8A 7FFF              MOV      R7,#0FFH
002F8C 7E7F              MOV      R6,#07FH
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 100


002F8E 1233EE            LCALL    ?L?COM0029
002F91 C3                CLR      C
002F92 120607            LCALL    ?C?SLCMP
002F95 4006              JC       ?C0003?APL
002F97 7E7F              MOV      R6,#07FH
002F99 7FFF              MOV      R7,#0FFH
002F9B 8047              SJMP     ?C0002?APL
002F9D         ?C0003?APL:
002F9D 7F00              MOV      R7,#00H
002F9F 7E80              MOV      R6,#080H
002FA1 7DFF              MOV      R5,#0FFH
002FA3 7CFF              MOV      R4,#0FFH
002FA5 1233F0            LCALL    ?L?COM002A
002FA8 D3                SETB     C
002FA9 120607            LCALL    ?C?SLCMP
002FAC 5006              JNC      ?C0005?APL
002FAE 7E80              MOV      R6,#080H
002FB0 7F00              MOV      R7,#00H
002FB2 8004              SJMP     ?C0006?APL
002FB4         ?C0005?APL:
002FB4 AE35              MOV      R6,vTmpData+02H
002FB6 AF36              MOV      R7,vTmpData+03H
002FB8         ?C0006?APL:
002FB8         ?C0004?APL:
002FB8 802A              SJMP     ?C0002?APL
002FBA         ?C0001?APL:
002FBA E4                CLR      A
002FBB 7FFF              MOV      R7,#0FFH
002FBD 7EFF              MOV      R6,#0FFH
002FBF 1233EE            LCALL    ?L?COM0029
002FC2 C3                CLR      C
002FC3 120607            LCALL    ?C?SLCMP
002FC6 4006              JC       ?C0007?APL
002FC8 7EFF              MOV      R6,#0FFH
002FCA 7FFF              MOV      R7,#0FFH
002FCC 8016              SJMP     ?C0008?APL
002FCE         ?C0007?APL:
002FCE E4                CLR      A
002FCF FF                MOV      R7,A
002FD0 FE                MOV      R6,A
002FD1 1233EE            LCALL    ?L?COM0029
002FD4 D3                SETB     C
002FD5 120607            LCALL    ?C?SLCMP
002FD8 5006              JNC      ?C0009?APL
002FDA 7E00              MOV      R6,#00H
002FDC 7F00              MOV      R7,#00H
002FDE 8004              SJMP     ?C0010?APL
002FE0         ?C0009?APL:
002FE0 AE35              MOV      R6,vTmpData+02H
002FE2 AF36              MOV      R7,vTmpData+03H
002FE4         ?C0010?APL:
002FE4         ?C0008?APL:
002FE4         ?C0002?APL:
   59: }
002FE4 22                RET      
----- FUNCTION _apl_ddm_Calibrate (END) -------


----- FUNCTION ?L?COM002E (BEGIN) -----
002FE5 D1D2              ACALL    _DRV_ADC_Sample
002FE7 8E2D              MOV      vRawADC,R6
002FE9 8F2E              MOV      vRawADC+01H,R7
002FEB AD2E              MOV      R5,vRawADC+01H
002FED AC2D              MOV      R4,vRawADC
002FEF 22                RET      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 101


----- FUNCTION ?L?COM002E (END) -------


----- FUNCTION _c2m_WriteDR (BEGIN) -----
 FILE: '..\drv\drv_c2m.c'
  237: static void c2m_WriteDR(UINT8 vData)
  238: {
;---- Variable 'vData' assigned to Register 'R7' ----
  239:     BOOL    bIntState;
  240: 
  241:     c2m_SetIns(0x1);    /* instruction: write data */
003000 D243              SETB     bIns0
003002 C244              CLR      bIns1
  242:     c2m_SetLength(0x1); /* length: 1 byte */
003004 C245              CLR      bLength0
003006 C246              CLR      bLength1
  243:     c2m_SetData(vData);
003008 8F26              MOV      vC2Data,R7
  244: 
  245:     /* lock globally interrupt */
  246:     bIntState = DRV_INT_LockGlobalInterrupt();
00300A 30AF05            JNB      EA,?C0355?DRV_C2M
00300D C2AF              CLR      EA
00300F D3                SETB     C
003010 8001              SJMP     ?C0356?DRV_C2M
003012         ?C0355?DRV_C2M:
003012 C3                CLR      C
003013         ?C0356?DRV_C2M:
003013 31D5              ACALL    ?L?COM0017
003015 00                NOP      
003016 00                NOP      
003017 00                NOP      
003018 00                NOP      
003019 5151              ACALL    ?L?COM0026
00301B 00                NOP      
00301C 00                NOP      
00301D 00                NOP      
00301E 00                NOP      
00301F 31E4              ACALL    ?L?COM0033
003021 00                NOP      
003022 00                NOP      
003023 00                NOP      
003024 00                NOP      
003025 31F6              ACALL    ?L?COM0052
003027 00                NOP      
003028 00                NOP      
003029 00                NOP      
00302A 00                NOP      
00302B 31ED              ACALL    ?L?COM0051
00302D 00                NOP      
00302E 00                NOP      
00302F 00                NOP      
003030 00                NOP      
003031 513E              ACALL    ?L?COM005A
003033 00                NOP      
003034 00                NOP      
003035 00                NOP      
003036 00                NOP      
003037 5135              ACALL    ?L?COM0059
003039 00                NOP      
00303A 00                NOP      
00303B 00                NOP      
00303C 00                NOP      
00303D 512C              ACALL    ?L?COM0058
00303F 00                NOP      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 102


003040 00                NOP      
003041 00                NOP      
003042 00                NOP      
003043 5123              ACALL    ?L?COM0057
003045 00                NOP      
003046 00                NOP      
003047 00                NOP      
003048 00                NOP      
003049 511A              ACALL    ?L?COM0056
00304B 00                NOP      
00304C 00                NOP      
00304D 00                NOP      
00304E 00                NOP      
00304F 5111              ACALL    ?L?COM0055
003051 00                NOP      
003052 00                NOP      
003053 00                NOP      
003054 00                NOP      
003055 5108              ACALL    ?L?COM0054
003057 00                NOP      
003058 00                NOP      
003059 00                NOP      
00305A 00                NOP      
00305B 31FF              ACALL    ?L?COM0053
00305D 00                NOP      
00305E 00                NOP      
00305F 00                NOP      
003060 00                NOP      
003061 5147              ACALL    ?L?COM003A
003063 00                NOP      
003064 D297              SETB     IO_DUT_C2M_SCL
003066 00                NOP      
003067 00                NOP      
  247: 
  248:     c2m_TxStart();      /* tx frame start */
  249:     c2m_TxIns();        /* tx instruction */
  250:     c2m_TxLength();     /* tx length */
  251:     c2m_TxByte();       /* tx address */
  252:     c2m_TxTurnAround(); /* tx turn-around */
  253:     c2m_Wait();         /* wait for target device ready */
003068 754827            MOV      _timeout,#027H
00306B 754910            MOV      _timeout+01H,#010H
00306E         ?C0557?DRV_C2M:
00306E 00                NOP      
00306F 00                NOP      
003070 C297              CLR      IO_DUT_C2M_SCL
003072 00                NOP      
003073 00                NOP      
003074 121C1C            LCALL    ?L?COM0005
003077 20300D            JB       bC2Bit0,?C0570?DRV_C2M
00307A E549              MOV      A,_timeout+01H
00307C 1549              DEC      _timeout+01H
00307E AE48              MOV      R6,_timeout
003080 7002              JNZ      ?C1013?DRV_C2M
003082 1548              DEC      _timeout
003084         ?C1013?DRV_C2M:
003084 4E                ORL      A,R6
003085 70E7              JNZ      ?C0557?DRV_C2M
  254:     c2m_RxStop();       /* rx frame stop */
003087         ?C0570?DRV_C2M:
003087 4163              AJMP     ?L?COM0024
  255: 
  256:     /* unlock globally interrupt */
  257:     DRV_INT_UnlockGlobalInterrupt(bIntState);
----- FUNCTION _c2m_WriteDR (END) -------
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 103




----- FUNCTION apl_ddm_GetEVBVCC (BEGIN) -----
 FILE: '..\apl\apl.c'
   75: static UINT16 apl_ddm_GetEVBVCC(void)
   76: {
   77:     UINT16  vRawADC;
   78: 
   79:     /* get raw ADC value, and record it */
   80:     vRawADC = (UINT16)DRV_ADC_Sample(ADC(ADC_EVB_VCC));
003089 7B03              MOV      R3,#03H
00308B 7D1E              MOV      R5,#01EH
00308D 7F1F              MOV      R7,#01FH
00308F 122FE5            LCALL    ?L?COM002E
003092 7F22              MOV      R7,#022H
003094 7E00              MOV      R6,#00H
003096 121FEF            LCALL    _CFG_RAM_SET16
003099         ?C0061?APL:
   81:     CFG_SET(DDM_ADC_EVB_VCC, vRawADC);
   82: 
   83:     /* calibration */
   84:     return apl_ddm_Calibrate(vRawADC,
   85:                              GET_SLOPE_DELTA(DDM_EVB_VCC_Slope),
   86:                              FALSE);
003099 C238              CLR      ?_apl_ddm_Calibrate?BIT
00309B 7D08              MOV      R5,#08H
00309D 022F34            LJMP     ?L?COM0046
   87: }
----- FUNCTION apl_ddm_GetEVBVCC (END) -------


----- FUNCTION apl_ddm_GetEVBVBUF (BEGIN) -----
 FILE: '..\apl\apl.c'
   89: static UINT16 apl_ddm_GetEVBVBUF(void)
   90: {
   91:     UINT16  vRawADC;
   92: 
   93:     /* get raw ADC value, and record it */
   94:     vRawADC = (UINT16)DRV_ADC_Sample(ADC(ADC_EVB_VBUF));
0030A0 7B03              MOV      R3,#03H
0030A2 7D1F              MOV      R5,#01FH
0030A4 7F0A              MOV      R7,#0AH
0030A6 122FE5            LCALL    ?L?COM002E
0030A9 7F24              MOV      R7,#024H
0030AB 7E00              MOV      R6,#00H
0030AD 121FEF            LCALL    _CFG_RAM_SET16
0030B0         ?C0109?APL:
   95:     CFG_SET(DDM_ADC_EVB_VBUF, vRawADC);
   96: 
   97:     /* calibration */
   98:     return apl_ddm_Calibrate(vRawADC,
   99:                              GET_SLOPE_DELTA(DDM_EVB_VBUF_Slope),
  100:                              FALSE);
0030B0 C238              CLR      ?_apl_ddm_Calibrate?BIT
0030B2 7D10              MOV      R5,#010H
0030B4 022F34            LJMP     ?L?COM0046
  101: }
----- FUNCTION apl_ddm_GetEVBVBUF (END) -------


----- FUNCTION ?L?COM0001 (BEGIN) -----
0030B7 C283              CLR      IO_DUT_MDIOM_SCL_OEn
0030B9 C2A1              CLR      IO_DUT_MDIOM_SDA_OEn
0030BB A248              MOV      C,bMdioPreamble
0030BD D296              SETB     IO_DUT_MDIOM_SCL_OUT
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 104


0030BF 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030C1 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030C3 A248              MOV      C,bMdioPreamble
0030C5 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030C7 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030C9 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030CB A248              MOV      C,bMdioPreamble
0030CD D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030CF 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030D1 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030D3 A248              MOV      C,bMdioPreamble
0030D5 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030D7 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030D9 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030DB A248              MOV      C,bMdioPreamble
0030DD D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030DF 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030E1 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030E3 A248              MOV      C,bMdioPreamble
0030E5 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030E7 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030E9 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030EB A248              MOV      C,bMdioPreamble
0030ED D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030EF 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030F1 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030F3 A248              MOV      C,bMdioPreamble
0030F5 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030F7 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0030F9 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0030FB A248              MOV      C,bMdioPreamble
0030FD D296              SETB     IO_DUT_MDIOM_SCL_OUT
0030FF 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003101 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003103 A248              MOV      C,bMdioPreamble
003105         ?L?COM0002:
003105 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003107 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003109 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00310B A248              MOV      C,bMdioPreamble
00310D D296              SETB     IO_DUT_MDIOM_SCL_OUT
00310F 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003111 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003113 A248              MOV      C,bMdioPreamble
003115 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003117 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003119 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00311B A248              MOV      C,bMdioPreamble
00311D D296              SETB     IO_DUT_MDIOM_SCL_OUT
00311F 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003121 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003123 A248              MOV      C,bMdioPreamble
003125 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003127 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003129 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00312B A248              MOV      C,bMdioPreamble
00312D D296              SETB     IO_DUT_MDIOM_SCL_OUT
00312F 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003131 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003133 A248              MOV      C,bMdioPreamble
003135 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003137 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003139 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00313B A248              MOV      C,bMdioPreamble
00313D D296              SETB     IO_DUT_MDIOM_SCL_OUT
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 105


00313F 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003141 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003143 A248              MOV      C,bMdioPreamble
003145 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003147 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003149 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00314B A248              MOV      C,bMdioPreamble
00314D D296              SETB     IO_DUT_MDIOM_SCL_OUT
00314F 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003151 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003153 A248              MOV      C,bMdioPreamble
003155 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003157 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003159 C296              CLR      IO_DUT_MDIOM_SCL_OUT
00315B A248              MOV      C,bMdioPreamble
00315D 22                RET      
----- FUNCTION ?L?COM0001 (END) -------


----- FUNCTION ?L?COM0003 (BEGIN) -----
00315E D296              SETB     IO_DUT_MDIOM_SCL_OUT
003160 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003162 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003164 A20F              MOV      C,bMdioStartFrame1
003166 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003168 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
00316A C296              CLR      IO_DUT_MDIOM_SCL_OUT
00316C A20E              MOV      C,bMdioStartFrame0
00316E D296              SETB     IO_DUT_MDIOM_SCL_OUT
003170 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003172 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003174 A20D              MOV      C,bMdioOperationCode1
003176 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003178 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
00317A C296              CLR      IO_DUT_MDIOM_SCL_OUT
00317C A20C              MOV      C,bMdioOperationCode0
00317E D296              SETB     IO_DUT_MDIOM_SCL_OUT
003180 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003182 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003184 A20B              MOV      C,bMdioPortAddr4
003186 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003188 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
00318A C296              CLR      IO_DUT_MDIOM_SCL_OUT
00318C A20A              MOV      C,bMdioPortAddr3
00318E D296              SETB     IO_DUT_MDIOM_SCL_OUT
003190 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
003192 C296              CLR      IO_DUT_MDIOM_SCL_OUT
003194 A209              MOV      C,bMdioPortAddr2
003196 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003198 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
00319A C296              CLR      IO_DUT_MDIOM_SCL_OUT
00319C A208              MOV      C,bMdioPortAddr1
00319E D296              SETB     IO_DUT_MDIOM_SCL_OUT
0031A0 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031A2 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031A4 A207              MOV      C,bMdioPortAddr0
0031A6 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0031A8 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031AA C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031AC A206              MOV      C,bMdioDeviceAddr4
0031AE D296              SETB     IO_DUT_MDIOM_SCL_OUT
0031B0 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031B2 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031B4 A205              MOV      C,bMdioDeviceAddr3
0031B6 D296              SETB     IO_DUT_MDIOM_SCL_OUT
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 106


0031B8 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031BA C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031BC A204              MOV      C,bMdioDeviceAddr2
0031BE D296              SETB     IO_DUT_MDIOM_SCL_OUT
0031C0 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031C2 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031C4 A203              MOV      C,bMdioDeviceAddr1
0031C6 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0031C8 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031CA C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031CC A202              MOV      C,bMdioDeviceAddr0
0031CE         ?L?COM0004:
0031CE D296              SETB     IO_DUT_MDIOM_SCL_OUT
0031D0 9294              MOV      IO_DUT_MDIOM_SDA_OUT,C
0031D2 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0031D4 22                RET      
----- FUNCTION ?L?COM0003 (END) -------


----- FUNCTION ?L?COM0017 (BEGIN) -----
0031D5 9239              MOV      bIntState,C
0031D7 53A6FE            ANL      P2MDOUT,#0FEH
0031DA 43A580            ORL      P1MDOUT,#080H
0031DD         ?L?COM0018:
0031DD A241              MOV      C,bHigh
0031DF 92A0              MOV      IO_DUT_C2M_SDA,C
0031E1 C297              CLR      IO_DUT_C2M_SCL
0031E3 22                RET      
----- FUNCTION ?L?COM0017 (END) -------


----- FUNCTION ?L?COM0033 (BEGIN) -----
0031E4 D297              SETB     IO_DUT_C2M_SCL
0031E6 A244              MOV      C,bIns1
0031E8 92A0              MOV      IO_DUT_C2M_SDA,C
0031EA C297              CLR      IO_DUT_C2M_SCL
0031EC 22                RET      
----- FUNCTION ?L?COM0033 (END) -------


----- FUNCTION ?L?COM0051 (BEGIN) -----
0031ED D297              SETB     IO_DUT_C2M_SCL
0031EF A246              MOV      C,bLength1
0031F1 92A0              MOV      IO_DUT_C2M_SDA,C
0031F3 C297              CLR      IO_DUT_C2M_SCL
0031F5 22                RET      
----- FUNCTION ?L?COM0051 (END) -------


----- FUNCTION ?L?COM0052 (BEGIN) -----
0031F6 D297              SETB     IO_DUT_C2M_SCL
0031F8 A245              MOV      C,bLength0
0031FA 92A0              MOV      IO_DUT_C2M_SDA,C
0031FC C297              CLR      IO_DUT_C2M_SCL
0031FE 22                RET      
----- FUNCTION ?L?COM0052 (END) -------


----- FUNCTION ?L?COM0053 (BEGIN) -----
0031FF D297              SETB     IO_DUT_C2M_SCL
003201 A237              MOV      C,bC2Bit7
003203 92A0              MOV      IO_DUT_C2M_SDA,C
003205 C297              CLR      IO_DUT_C2M_SCL
003207 22                RET      
----- FUNCTION ?L?COM0053 (END) -------
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 107




----- FUNCTION ?L?COM0054 (BEGIN) -----
003208 D297              SETB     IO_DUT_C2M_SCL
00320A A236              MOV      C,bC2Bit6
00320C 92A0              MOV      IO_DUT_C2M_SDA,C
00320E C297              CLR      IO_DUT_C2M_SCL
003210 22                RET      
----- FUNCTION ?L?COM0054 (END) -------


----- FUNCTION ?L?COM0055 (BEGIN) -----
003211 D297              SETB     IO_DUT_C2M_SCL
003213 A235              MOV      C,bC2Bit5
003215 92A0              MOV      IO_DUT_C2M_SDA,C
003217 C297              CLR      IO_DUT_C2M_SCL
003219 22                RET      
----- FUNCTION ?L?COM0055 (END) -------


----- FUNCTION ?L?COM0056 (BEGIN) -----
00321A D297              SETB     IO_DUT_C2M_SCL
00321C A234              MOV      C,bC2Bit4
00321E 92A0              MOV      IO_DUT_C2M_SDA,C
003220 C297              CLR      IO_DUT_C2M_SCL
003222 22                RET      
----- FUNCTION ?L?COM0056 (END) -------


----- FUNCTION ?L?COM0057 (BEGIN) -----
003223 D297              SETB     IO_DUT_C2M_SCL
003225 A233              MOV      C,bC2Bit3
003227 92A0              MOV      IO_DUT_C2M_SDA,C
003229 C297              CLR      IO_DUT_C2M_SCL
00322B 22                RET      
----- FUNCTION ?L?COM0057 (END) -------


----- FUNCTION ?L?COM0058 (BEGIN) -----
00322C D297              SETB     IO_DUT_C2M_SCL
00322E A232              MOV      C,bC2Bit2
003230 92A0              MOV      IO_DUT_C2M_SDA,C
003232 C297              CLR      IO_DUT_C2M_SCL
003234 22                RET      
----- FUNCTION ?L?COM0058 (END) -------


----- FUNCTION ?L?COM0059 (BEGIN) -----
003235 D297              SETB     IO_DUT_C2M_SCL
003237 A231              MOV      C,bC2Bit1
003239 92A0              MOV      IO_DUT_C2M_SDA,C
00323B C297              CLR      IO_DUT_C2M_SCL
00323D 22                RET      
----- FUNCTION ?L?COM0059 (END) -------


----- FUNCTION ?L?COM005A (BEGIN) -----
00323E D297              SETB     IO_DUT_C2M_SCL
003240 A230              MOV      C,bC2Bit0
003242 92A0              MOV      IO_DUT_C2M_SDA,C
003244 C297              CLR      IO_DUT_C2M_SCL
003246 22                RET      
----- FUNCTION ?L?COM005A (END) -------


LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 108


----- FUNCTION ?L?COM003A (BEGIN) -----
003247 D297              SETB     IO_DUT_C2M_SCL
003249 53A6FE            ANL      P2MDOUT,#0FEH
00324C D2A0              SETB     IO_DUT_C2M_SDA
00324E C297              CLR      IO_DUT_C2M_SCL
003250 22                RET      
----- FUNCTION ?L?COM003A (END) -------


----- FUNCTION ?L?COM0026 (BEGIN) -----
003251 D297              SETB     IO_DUT_C2M_SCL
003253 43A601            ORL      P2MDOUT,#01H
003256 A243              MOV      C,bIns0
003258 92A0              MOV      IO_DUT_C2M_SDA,C
00325A C297              CLR      IO_DUT_C2M_SCL
00325C 22                RET      
----- FUNCTION ?L?COM0026 (END) -------


----- FUNCTION ?L?COM0023 (BEGIN) -----
00325D A2A0              MOV      C,IO_DUT_C2M_SDA
00325F D297              SETB     IO_DUT_C2M_SCL
003261 9237              MOV      bC2Bit7,C
003263         ?L?COM0024:
003263 53A6FE            ANL      P2MDOUT,#0FEH
003266         ?L?COM0025:
003266 53A57F            ANL      P1MDOUT,#07FH
003269 A239              MOV      C,bIntState
00326B 92AF              MOV      EA,C
00326D 22                RET      
----- FUNCTION ?L?COM0023 (END) -------


----- FUNCTION ?L?COM0007 (BEGIN) -----
00326E 7819              MOV      R0,#019H
003270 E2                MOVX     A,@R0
003271 C4                SWAP     A
003272 13                RRC      A
003273 13                RRC      A
003274 13                RRC      A
003275 5401              ANL      A,#01H
003277         ?L?COM0008:
003277 FF                MOV      R7,A
003278 EF                MOV      A,R7
003279 5401              ANL      A,#01H
00327B FB                MOV      R3,A
00327C E4                CLR      A
00327D FA                MOV      R2,A
00327E F9                MOV      R1,A
00327F F8                MOV      R0,A
003280 AF2C              MOV      R7,_v
003282 FC                MOV      R4,A
003283 FD                MOV      R5,A
003284 FE                MOV      R6,A
003285 C3                CLR      C
003286 02061D            LJMP     ?C?ULCMP
----- FUNCTION ?L?COM0007 (END) -------


----- FUNCTION ?L?COM0009 (BEGIN) -----
003289 7F03              MOV      R7,#03H
00328B 7E00              MOV      R6,#00H
00328D 121C26            LCALL    _DRV_CPU_DelayUs
003290         ?L?COM000A:
003290 C292              CLR      IO_DUT_I2CM_SDA
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 109


003292         ?L?COM000B:
003292 7F03              MOV      R7,#03H
003294 7E00              MOV      R6,#00H
003296 021C26            LJMP     _DRV_CPU_DelayUs
----- FUNCTION ?L?COM0009 (END) -------


----- FUNCTION ?L?COM000C (BEGIN) -----
003299 7842              MOV      R0,#LOW _timeout
00329B         ?L?COM000D:
00329B 74FF              MOV      A,#0FFH
00329D 120667            LCALL    ?C?LLDIIDATA8
0032A0 EC                MOV      A,R4
0032A1 4D                ORL      A,R5
0032A2 4E                ORL      A,R6
0032A3 4F                ORL      A,R7
0032A4 22                RET      
----- FUNCTION ?L?COM000C (END) -------


----- FUNCTION ?L?COM000E (BEGIN) -----
0032A5 753300            MOV      pPayload,#HIGH vFrame+0CH
0032A8 75344C            MOV      pPayload+01H,#LOW vFrame+0CH
0032AB 853482            MOV      DPL,pPayload+01H
0032AE 853383            MOV      DPH,pPayload
0032B1 E0                MOVX     A,@DPTR
0032B2 FF                MOV      R7,A
0032B3 A3                INC      DPTR
0032B4 E0                MOVX     A,@DPTR
0032B5 FD                MOV      R5,A
0032B6 853482            MOV      DPL,pPayload+01H
0032B9 853383            MOV      DPH,pPayload
0032BC A3                INC      DPTR
0032BD A3                INC      DPTR
0032BE E0                MOVX     A,@DPTR
0032BF FA                MOV      R2,A
0032C0 A3                INC      DPTR
0032C1 E0                MOVX     A,@DPTR
0032C2 FB                MOV      R3,A
0032C3 E534              MOV      A,pPayload+01H
0032C5 2404              ADD      A,#04H
0032C7 F582              MOV      DPL,A
0032C9 E4                CLR      A
0032CA 3533              ADDC     A,pPayload
0032CC F583              MOV      DPH,A
0032CE E0                MOVX     A,@DPTR
0032CF F539              MOV      ?_DRV_MDIOM_Write?BYTE+04H,A
0032D1 A3                INC      DPTR
0032D2 E0                MOVX     A,@DPTR
0032D3 F53A              MOV      ?_DRV_MDIOM_Write?BYTE+05H,A
0032D5 E534              MOV      A,pPayload+01H
0032D7 2406              ADD      A,#06H
0032D9 F53C              MOV      ?_DRV_MDIOM_Write?BYTE+07H,A
0032DB E4                CLR      A
0032DC 3533              ADDC     A,pPayload
0032DE F53B              MOV      ?_DRV_MDIOM_Write?BYTE+06H,A
0032E0 22                RET      
----- FUNCTION ?L?COM000E (END) -------


----- FUNCTION ?L?COM000F (BEGIN) -----
0032E1 C296              CLR      IO_DUT_MDIOM_SCL_OUT
0032E3 A280              MOV      C,IO_DUT_MDIOM_SDA_IN
0032E5 D296              SETB     IO_DUT_MDIOM_SCL_OUT
0032E7 22                RET      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 110


----- FUNCTION ?L?COM000F (END) -------


----- FUNCTION ?L?COM0010 (BEGIN) -----
0032E8 7B4C              MOV      R3,#LOW vFrame+0CH
0032EA 7A00              MOV      R2,#HIGH vFrame+0CH
0032EC EB                MOV      A,R3
0032ED 2406              ADD      A,#06H
0032EF F534              MOV      pBuf+01H,A
0032F1 E4                CLR      A
0032F2 3A                ADDC     A,R2
0032F3 F533              MOV      pBuf,A
0032F5 8B82              MOV      DPL,R3
0032F7 8A83              MOV      DPH,R2
0032F9 A3                INC      DPTR
0032FA A3                INC      DPTR
0032FB E0                MOVX     A,@DPTR
0032FC FE                MOV      R6,A
0032FD A3                INC      DPTR
0032FE E0                MOVX     A,@DPTR
0032FF 8E35              MOV      vAddr,R6
003301 F536              MOV      vAddr+01H,A
003303 EB                MOV      A,R3
003304 2404              ADD      A,#04H
003306 F582              MOV      DPL,A
003308 E4                CLR      A
003309 3A                ADDC     A,R2
00330A F583              MOV      DPH,A
00330C         ?L?COM0011:
00330C E0                MOVX     A,@DPTR
00330D F537              MOV      vLen,A
00330F A3                INC      DPTR
003310 E0                MOVX     A,@DPTR
003311 F538              MOV      vLen+01H,A
003313 22                RET      
----- FUNCTION ?L?COM0010 (END) -------


----- FUNCTION ?L?COM0014 (BEGIN) -----
003314 121D4C            LCALL    _drv_c2m_WriteData
003317 AF3F              MOV      R7,vCount
003319         ?L?COM0015:
003319 121D4C            LCALL    _drv_c2m_WriteData
00331C         ?L?COM0016:
00331C E4                CLR      A
00331D 754510            MOV      _timeout+03H,#010H
003320 754427            MOV      _timeout+02H,#027H
003323 F543              MOV      _timeout+01H,A
003325 F542              MOV      _timeout,A
003327 22                RET      
----- FUNCTION ?L?COM0014 (END) -------


----- FUNCTION ?L?COM0019 (BEGIN) -----
003328 E53A              MOV      A,vWriteLen+01H
00332A 2534              ADD      A,pBuf+01H
00332C F534              MOV      pBuf+01H,A
00332E E539              MOV      A,vWriteLen
003330 3533              ADDC     A,pBuf
003332 F533              MOV      pBuf,A
003334 E53A              MOV      A,vWriteLen+01H
003336 2536              ADD      A,vAddr+01H
003338 F536              MOV      vAddr+01H,A
00333A E539              MOV      A,vWriteLen
00333C 3535              ADDC     A,vAddr
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 111


00333E F535              MOV      vAddr,A
003340 C3                CLR      C
003341 E538              MOV      A,vLen+01H
003343 953A              SUBB     A,vWriteLen+01H
003345 F538              MOV      vLen+01H,A
003347 E537              MOV      A,vLen
003349 9539              SUBB     A,vWriteLen
00334B F537              MOV      vLen,A
00334D 22                RET      
----- FUNCTION ?L?COM0019 (END) -------


----- FUNCTION ?L?COM001A (BEGIN) -----
00334E E538              MOV      A,vWriteLen+01H
003350 253C              ADD      A,vLoop+01H
003352 FD                MOV      R5,A
003353 E537              MOV      A,vWriteLen
003355 353B              ADDC     A,vLoop
003357 FC                MOV      R4,A
003358 E536              MOV      A,pPayload+01H
00335A 2405              ADD      A,#05H
00335C F582              MOV      DPL,A
00335E E4                CLR      A
00335F 3535              ADDC     A,pPayload
003361 F583              MOV      DPH,A
003363 E582              MOV      A,DPL
003365 2D                ADD      A,R5
003366 F582              MOV      DPL,A
003368 E583              MOV      A,DPH
00336A 3C                ADDC     A,R4
00336B F583              MOV      DPH,A
00336D EF                MOV      A,R7
00336E F0                MOVX     @DPTR,A
00336F 053C              INC      vLoop+01H
003371 E53C              MOV      A,vLoop+01H
003373 22                RET      
----- FUNCTION ?L?COM001A (END) -------


----- FUNCTION ?L?COM001B (BEGIN) -----
003374 FD                MOV      R5,A
003375 E9                MOV      A,R1
003376 75F004            MOV      B,#04H
003379 A4                MUL      AB
00337A FF                MOV      R7,A
00337B EC                MOV      A,R4
00337C 45F0              ORL      A,B
00337E F520              MOV      vMdioCtrl,A
003380 ED                MOV      A,R5
003381 4F                ORL      A,R7
003382 F521              MOV      vMdioCtrl+01H,A
003384 74FF              MOV      A,#0FFH
003386 F522              MOV      vMdioAddr,A
003388 F523              MOV      vMdioAddr+01H,A
00338A 12273A            LCALL    drv_mdiom_RxDataFrame
00338D A238              MOV      C,bIntState
00338F 92AF              MOV      EA,C
003391 E582              MOV      A,DPL
003393 4583              ORL      A,DPH
003395 22                RET      
----- FUNCTION ?L?COM001B (END) -------


----- FUNCTION ?L?COM001C (BEGIN) -----
003396 7B4C              MOV      R3,#LOW vFrame+0CH
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 112


003398 7A00              MOV      R2,#HIGH vFrame+0CH
00339A 8B82              MOV      DPL,R3
00339C 8A83              MOV      DPH,R2
00339E E0                MOVX     A,@DPTR
00339F FF                MOV      R7,A
0033A0 A3                INC      DPTR
0033A1 E0                MOVX     A,@DPTR
0033A2 FD                MOV      R5,A
0033A3 22                RET      
----- FUNCTION ?L?COM001C (END) -------


----- FUNCTION ?L?COM001D (BEGIN) -----
0033A4 E0                MOVX     A,@DPTR
0033A5 FC                MOV      R4,A
0033A6 A3                INC      DPTR
0033A7 E0                MOVX     A,@DPTR
0033A8 FD                MOV      R5,A
0033A9 A3                INC      DPTR
0033AA E0                MOVX     A,@DPTR
0033AB FE                MOV      R6,A
0033AC A3                INC      DPTR
0033AD E0                MOVX     A,@DPTR
0033AE FF                MOV      R7,A
0033AF         ?L?COM001E:
0033AF AB11              MOV      R3,vTickCount+03H
0033B1 AA10              MOV      R2,vTickCount+02H
0033B3 A90F              MOV      R1,vTickCount+01H
0033B5 A80E              MOV      R0,vTickCount
0033B7 C3                CLR      C
0033B8 02061D            LJMP     ?C?ULCMP
----- FUNCTION ?L?COM001D (END) -------


----- FUNCTION ?L?COM001F (BEGIN) -----
0033BB 7819              MOV      R0,#019H
0033BD E2                MOVX     A,@R0
0033BE         ?L?COM0020:
0033BE FF                MOV      R7,A
0033BF E4                CLR      A
0033C0 FC                MOV      R4,A
0033C1 FD                MOV      R5,A
0033C2 FE                MOV      R6,A
0033C3 EF                MOV      A,R7
0033C4 22                RET      
----- FUNCTION ?L?COM001F (END) -------


----- FUNCTION ?L?COM0021 (BEGIN) -----
0033C5 7F04              MOV      R7,#04H
0033C7         ?L?COM0022:
0033C7 FE                MOV      R6,A
0033C8 1217F6            LCALL    _CFG_RAM_GET16
0033CB AD07              MOV      R5,AR7
0033CD AC06              MOV      R4,AR6
0033CF 22                RET      
----- FUNCTION ?L?COM0021 (END) -------


----- FUNCTION ?L?COM0027 (BEGIN) -----
0033D0 FD                MOV      R5,A
0033D1 E4                CLR      A
0033D2 3439              ADDC     A,#039H
0033D4 8D82              MOV      DPL,R5
0033D6 F583              MOV      DPH,A
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 113


0033D8 E4                CLR      A
0033D9 93                MOVC     A,@A+DPTR
0033DA F52B              MOV      vData,A
0033DC C3                CLR      C
0033DD 9420              SUBB     A,#020H
0033DF 22                RET      
----- FUNCTION ?L?COM0027 (END) -------


----- FUNCTION ?L?COM0028 (BEGIN) -----
0033E0 EF                MOV      A,R7
0033E1 4B                ORL      A,R3
0033E2 FF                MOV      R7,A
0033E3 EE                MOV      A,R6
0033E4 4A                ORL      A,R2
0033E5 ED                MOV      A,R5
0033E6 49                ORL      A,R1
0033E7 EC                MOV      A,R4
0033E8 48                ORL      A,R0
0033E9 7819              MOV      R0,#019H
0033EB EF                MOV      A,R7
0033EC F2                MOVX     @R0,A
0033ED 22                RET      
----- FUNCTION ?L?COM0028 (END) -------


----- FUNCTION ?L?COM0029 (BEGIN) -----
0033EE FD                MOV      R5,A
0033EF FC                MOV      R4,A
0033F0         ?L?COM002A:
0033F0 AB36              MOV      R3,vTmpData+03H
0033F2 AA35              MOV      R2,vTmpData+02H
0033F4 A934              MOV      R1,vTmpData+01H
0033F6 A833              MOV      R0,vTmpData
0033F8 22                RET      
----- FUNCTION ?L?COM0029 (END) -------


----- FUNCTION ?L?COM002B (BEGIN) -----
0033F9 122000            LCALL    c2m_ReadDR
0033FC EF                MOV      A,R7
0033FD 640D              XRL      A,#0DH
0033FF 22                RET      
----- FUNCTION ?L?COM002B (END) -------


----- FUNCTION ?L?COM002C (BEGIN) -----
003400 43A580            ORL      P1MDOUT,#080H
003403 C297              CLR      IO_DUT_C2M_SCL
003405 7F14              MOV      R7,#014H
003407 7E00              MOV      R6,#00H
003409 121C26            LCALL    _DRV_CPU_DelayUs
00340C D297              SETB     IO_DUT_C2M_SCL
00340E 7F02              MOV      R7,#02H
003410 7E00              MOV      R6,#00H
003412 021C26            LJMP     _DRV_CPU_DelayUs
----- FUNCTION ?L?COM002C (END) -------


----- FUNCTION ?L?COM002D (BEGIN) -----
003415 F583              MOV      DPH,A
003417 7401              MOV      A,#01H
003419 93                MOVC     A,@A+DPTR
00341A FA                MOV      R2,A
00341B 7402              MOV      A,#02H
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 114


00341D 93                MOVC     A,@A+DPTR
00341E F9                MOV      R1,A
00341F 120704            LCALL    ?C?ICALL
003422 052A              INC      i
003424 E52A              MOV      A,i
003426 C3                CLR      C
003427 9403              SUBB     A,#03H
003429 22                RET      
----- FUNCTION ?L?COM002D (END) -------


----- FUNCTION ?L?COM002F (BEGIN) -----
00342A E4                CLR      A
00342B 90004A            MOV      DPTR,#vFrame+0AH
00342E F0                MOVX     @DPTR,A
00342F A3                INC      DPTR
003430 F0                MOVX     @DPTR,A
003431 22                RET      
----- FUNCTION ?L?COM002F (END) -------


----- FUNCTION ?L?COM0030 (BEGIN) -----
003432 D282              SETB     IO_DUT_I2CM_SCL
003434 754101            MOV      _loop,#01H
003437 7542F4            MOV      _loop+01H,#0F4H
00343A 22                RET      
----- FUNCTION ?L?COM0030 (END) -------


----- FUNCTION ?L?COM0031 (BEGIN) -----
00343B 7E38              MOV      R6,#038H
00343D 1218CD            LCALL    _CFG_ROM_GET16
003440 E4                CLR      A
003441 22                RET      
----- FUNCTION ?L?COM0031 (END) -------


----- FUNCTION ?L?COM0032 (BEGIN) -----
003442 D296              SETB     IO_DUT_MDIOM_SCL_OUT
003444 D294              SETB     IO_DUT_MDIOM_SDA_OUT
003446 D283              SETB     IO_DUT_MDIOM_SCL_OEn
003448 D2A1              SETB     IO_DUT_MDIOM_SDA_OEn
00344A 22                RET      
----- FUNCTION ?L?COM0032 (END) -------


----- FUNCTION ?L?COM0034 (BEGIN) -----
00344B 7E04              MOV      R6,#04H
00344D 7F44              MOV      R7,#044H
00344F 7D00              MOV      R5,#00H
003451         ?L?COM0035:
003451 7B01              MOV      R3,#01H
003453 7A00              MOV      R2,#HIGH vFrame
003455 7940              MOV      R1,#LOW vFrame
003457 22                RET      
----- FUNCTION ?L?COM0034 (END) -------


----- FUNCTION ?L?COM0036 (BEGIN) -----
003458 7E38              MOV      R6,#038H
00345A 121FE8            LCALL    _CFG_ROM_GET32
00345D AB47              MOV      R3,vPasswd+03H
00345F AA46              MOV      R2,vPasswd+02H
003461 A945              MOV      R1,vPasswd+01H
003463 A844              MOV      R0,vPasswd
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 115


003465 C3                CLR      C
003466 02061D            LJMP     ?C?ULCMP
----- FUNCTION ?L?COM0036 (END) -------


----- FUNCTION ?L?COM0037 (BEGIN) -----
003469 853482            MOV      DPL,pPayload+01H
00346C 853383            MOV      DPH,pPayload
00346F A3                INC      DPTR
003470 22                RET      
----- FUNCTION ?L?COM0037 (END) -------


----- FUNCTION ?L?COM0038 (BEGIN) -----
003471 9238              MOV      bIntState,C
003473 EF                MOV      A,R7
003474 75F080            MOV      B,#080H
003477 A4                MUL      AB
003478 ACF0              MOV      R4,B
00347A 22                RET      
----- FUNCTION ?L?COM0038 (END) -------


----- FUNCTION ?L?COM0039 (BEGIN) -----
00347B E541              MOV      A,vLen+01H
00347D 1541              DEC      vLen+01H
00347F AE40              MOV      R6,vLen
003481 22                RET      
----- FUNCTION ?L?COM0039 (END) -------


----- FUNCTION ?L?COM003B (BEGIN) -----
003482 8F82              MOV      DPL,R7
003484 8E83              MOV      DPH,R6
003486 A3                INC      DPTR
003487 A3                INC      DPTR
003488 A3                INC      DPTR
003489 E0                MOVX     A,@DPTR
00348A F539              MOV      vReadLen,A
00348C A3                INC      DPTR
00348D E0                MOVX     A,@DPTR
00348E F53A              MOV      vReadLen+01H,A
003490 22                RET      
----- FUNCTION ?L?COM003B (END) -------


----- FUNCTION ?L?COM003C (BEGIN) -----
003491 121D4C            LCALL    _drv_c2m_WriteData
003494 E4                CLR      A
003495 753710            MOV      _timeout+03H,#010H
003498 753627            MOV      _timeout+02H,#027H
00349B F535              MOV      _timeout+01H,A
00349D F534              MOV      _timeout,A
00349F 22                RET      
----- FUNCTION ?L?COM003C (END) -------


----- FUNCTION ?L?COM003D (BEGIN) -----
0034A0 121D4C            LCALL    _drv_c2m_WriteData
0034A3 E4                CLR      A
0034A4 753A10            MOV      _timeout+03H,#010H
0034A7 753927            MOV      _timeout+02H,#027H
0034AA F538              MOV      _timeout+01H,A
0034AC F537              MOV      _timeout,A
0034AE 22                RET      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 116


----- FUNCTION ?L?COM003D (END) -------


----- FUNCTION ?L?COM003E (BEGIN) -----
0034AF AE46              MOV      R6,pSrcAddr
0034B1 AF47              MOV      R7,pSrcAddr+01H
0034B3 AD07              MOV      R5,AR7
0034B5 AC06              MOV      R4,AR6
0034B7 E9                MOV      A,R1
0034B8 FB                MOV      R3,A
0034B9 7A00              MOV      R2,#00H
0034BB C23A              CLR      ?_drv_flash_WriteBytes?BIT
0034BD 22                RET      
----- FUNCTION ?L?COM003E (END) -------


----- FUNCTION ?L?COM003F (BEGIN) -----
0034BE 5401              ANL      A,#01H
0034C0 FF                MOV      R7,A
0034C1 E4                CLR      A
0034C2 7B01              MOV      R3,#01H
0034C4 FA                MOV      R2,A
0034C5 F9                MOV      R1,A
0034C6 F8                MOV      R0,A
0034C7 C3                CLR      C
0034C8 02061D            LJMP     ?C?ULCMP
----- FUNCTION ?L?COM003F (END) -------


----- FUNCTION ?L?COM0040 (BEGIN) -----
0034CB D282              SETB     IO_DUT_I2CM_SCL
0034CD 754001            MOV      _loop,#01H
0034D0 7541F4            MOV      _loop+01H,#0F4H
0034D3 22                RET      
----- FUNCTION ?L?COM0040 (END) -------


----- FUNCTION ?L?COM0041 (BEGIN) -----
0034D4 D282              SETB     IO_DUT_I2CM_SCL
0034D6 753D01            MOV      _loop,#01H
0034D9 753EF4            MOV      _loop+01H,#0F4H
0034DC 22                RET      
----- FUNCTION ?L?COM0041 (END) -------


----- FUNCTION ?L?COM0042 (BEGIN) -----
0034DD 8E3B              MOV      vAddr,R6
0034DF 8F3C              MOV      vAddr+01H,R7
0034E1 8C3D              MOV      pBuf,R4
0034E3 8D3E              MOV      pBuf+01H,R5
0034E5 8B3F              MOV      vCount,R3
0034E7 E53F              MOV      A,vCount
0034E9 22                RET      
----- FUNCTION ?L?COM0042 (END) -------


----- FUNCTION ?L?COM0043 (BEGIN) -----
0034EA E540              MOV      A,pBuf+01H
0034EC 2542              ADD      A,vLoop
0034EE F582              MOV      DPL,A
0034F0 E4                CLR      A
0034F1 353F              ADDC     A,pBuf
0034F3 F583              MOV      DPH,A
0034F5 E0                MOVX     A,@DPTR
0034F6 22                RET      
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 117


----- FUNCTION ?L?COM0043 (END) -------


----- FUNCTION ?L?COM0044 (BEGIN) -----
0034F7 E542              MOV      A,_loop+01H
0034F9 1542              DEC      _loop+01H
0034FB AE41              MOV      R6,_loop
0034FD 22                RET      
----- FUNCTION ?L?COM0044 (END) -------


----- FUNCTION ?L?COM0045 (BEGIN) -----
0034FE 7819              MOV      R0,#019H
003500 E2                MOVX     A,@R0
003501 13                RRC      A
003502 13                RRC      A
003503 543F              ANL      A,#03FH
003505 22                RET      
----- FUNCTION ?L?COM0045 (END) -------


----- FUNCTION ?L?COM0047 (BEGIN) -----
003506 7402              MOV      A,#02H
003508 253C              ADD      A,pDataBuf+01H
00350A F53C              MOV      pDataBuf+01H,A
00350C E4                CLR      A
00350D 353B              ADDC     A,pDataBuf
00350F F53B              MOV      pDataBuf,A
003511 22                RET      
----- FUNCTION ?L?COM0047 (END) -------


----- FUNCTION ?L?COM0048 (BEGIN) -----
003512 E524              MOV      A,vMdioData
003514 F0                MOVX     @DPTR,A
003515 A3                INC      DPTR
003516 E525              MOV      A,vMdioData+01H
003518 F0                MOVX     @DPTR,A
003519 22                RET      
----- FUNCTION ?L?COM0048 (END) -------


----- FUNCTION ?L?COM004A (BEGIN) -----
00351A D3                SETB     C
00351B E541              MOV      A,vPID
00351D 6480              XRL      A,#080H
00351F 9482              SUBB     A,#082H
003521 22                RET      
----- FUNCTION ?L?COM004A (END) -------


----- FUNCTION ?L?COM004B (BEGIN) -----
003522 ED                MOV      A,R5
003523 9F                SUBB     A,R7
003524 EE                MOV      A,R6
003525 6480              XRL      A,#080H
003527 F8                MOV      R0,A
003528 EC                MOV      A,R4
003529 6480              XRL      A,#080H
00352B 98                SUBB     A,R0
00352C 22                RET      
----- FUNCTION ?L?COM004B (END) -------


----- FUNCTION ?L?COM004C (BEGIN) -----
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 118


00352D 2480              ADD      A,#080H
00352F FF                MOV      R7,A
003530 EE                MOV      A,R6
003531 3436              ADDC     A,#036H
003533 FE                MOV      R6,A
003534 7C00              MOV      R4,#00H
003536 EF                MOV      A,R7
003537 22                RET      
----- FUNCTION ?L?COM004C (END) -------


----- FUNCTION ?L?COM004D (BEGIN) -----
003538 C3                CLR      C
003539         ?L?COM004E:
003539 E541              MOV      A,vPID
00353B 6480              XRL      A,#080H
00353D 9481              SUBB     A,#081H
00353F 22                RET      
----- FUNCTION ?L?COM004D (END) -------


----- FUNCTION ?L?COM004F (BEGIN) -----
003540 120262            LCALL    _printf
003543 900048            MOV      DPTR,#vFrame+08H
003546 7403              MOV      A,#03H
003548 F0                MOVX     @DPTR,A
003549 A3                INC      DPTR
00354A 22                RET      
----- FUNCTION ?L?COM004F (END) -------


----- FUNCTION ?L?COM005B (BEGIN) -----
00354B EF                MOV      A,R7
00354C 33                RLC      A
00354D 95E0              SUBB     A,ACC
00354F FE                MOV      R6,A
003550 EF                MOV      A,R7
003551 7807              MOV      R0,#07H
003553 22                RET      
----- FUNCTION ?L?COM005B (END) -------


----- FUNCTION ?L?COM005C (BEGIN) -----
003554 F583              MOV      DPH,A
003556 E4                CLR      A
003557 93                MOVC     A,@A+DPTR
003558 FF                MOV      R7,A
003559 E517              MOV      A,vCfgPwdLevel
00355B C3                CLR      C
00355C 22                RET      
----- FUNCTION ?L?COM005C (END) -------


----- FUNCTION ?L?COM005D (BEGIN) -----
00355D FE                MOV      R6,A
00355E E4                CLR      A
00355F 350F              ADDC     A,vTickCount+01H
003561 FD                MOV      R5,A
003562 E4                CLR      A
003563 350E              ADDC     A,vTickCount
003565 22                RET      
----- FUNCTION ?L?COM005D (END) -------


----- FUNCTION ?L?COM005E (BEGIN) -----
LX51 LINKER/LOCATER V4.66.66.0                                                        10/31/2016  00:36:39  PAGE 119


003566 8E35              MOV      pPayload,R6
003568 8F36              MOV      pPayload+01H,R7
00356A 8F82              MOV      DPL,R7
00356C 8E83              MOV      DPH,R6
00356E 22                RET      
----- FUNCTION ?L?COM005E (END) -------


----- FUNCTION ?L?COM005F (BEGIN) -----
00356F EB                MOV      A,R3
003570 2406              ADD      A,#06H
003572 FB                MOV      R3,A
003573 E4                CLR      A
003574 3A                ADDC     A,R2
003575 FA                MOV      R2,A
003576 22                RET      
----- FUNCTION ?L?COM005F (END) -------


----- FUNCTION ?L?COM0060 (BEGIN) -----
003577 12292B            LCALL    drv_mdiom_TxDataFrame
00357A A238              MOV      C,bIntState
00357C 92AF              MOV      EA,C
00357E 22                RET      
----- FUNCTION ?L?COM0060 (END) -------


----- FUNCTION ?L?COM0061 (BEGIN) -----
00357F AF18              MOV      R7,vFPDAT
003581 121F0B            LCALL    _c2m_WriteAR
003584 7F02              MOV      R7,#02H
003586 22                RET      
----- FUNCTION ?L?COM0061 (END) -------


----- FUNCTION ?L?COM0062 (BEGIN) -----
003587 C3                CLR      C
003588 E53C              MOV      A,vLoop+01H
00358A 953A              SUBB     A,vReadLen+01H
00358C E53B              MOV      A,vLoop
00358E 22                RET      
----- FUNCTION ?L?COM0062 (END) -------


----- FUNCTION ?L?COM0063 (BEGIN) -----
00358F 853682            MOV      DPL,pPayload+01H
003592 853583            MOV      DPH,pPayload
003595 E0                MOVX     A,@DPTR
003596 22                RET      
----- FUNCTION ?L?COM0063 (END) -------


----- FUNCTION ?L?COM0064 (BEGIN) -----
003597 7D40              MOV      R5,#040H
003599 120E12            LCALL    _Block_Read
00359C 8F2E              MOV      vBlockLen,R7
00359E 22                RET      
----- FUNCTION ?L?COM0064 (END) -------


